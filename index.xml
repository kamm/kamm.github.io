<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
      <title>kamm</title>
      <generator uri="https://hugo.spf13.com">Hugo</generator>
    <link>https://kamm.github.io/</link>
    <language>en-us</language>
    <author>Kamil Mtrak</author>
    <copyright>2023 Kamil Mtrak</copyright>
    <updated>Mon, 22 May 2023 21:10:15 &#43;0100</updated>
    
    
    <item>
      <title>Instalacja klastra OKD/Openshift </title>
      <link>https://kamm.github.io/2023/05/okd/</link>
      <pubDate>Mon, 22 May 2023 21:10:15 &#43;0100</pubDate>
      <author>Kamil Mtrak</author>
      <guid>https://kamm.github.io/2023/05/okd/</guid>
      <description>

&lt;h2 id=&#34;wstp&#34;&gt;Wstp&lt;/h2&gt;

&lt;p&gt;Do nauki OpenShifta potrzebowaem jakiej instancji deweloperskiej &amp;ldquo;do psucia&amp;rdquo;. G贸wne zao偶enia - wszystko musi by na maszynach wirtualnych, do uruchomienia na VirtualBoksie lub VMWare Workstation. Klaster ma skada si z 3 wz贸w typu Control Plane (w dalszej czci bd je nazywa master), kt贸re te偶 obsuguj ruch aplikacyjny - czyli nie ma osobnych Compute Node. Takie rozwizanie bdzie odzwierciedlao klaster OpenShifta, na kt贸rym pracuj w firmie, ale ten mog atwiej psu. Poza klasterem bdzie postawiona 1 dodatkowa maszyna - okd-bastion. Poza typowymi dla bastiona funkcjami (dostp do klastra przez oc/kubectl) bdzie te偶 routerem, firewallem, serwerem DHCP, DNS, HTTP (potrzebne tylko na etapie instalacji w celu dostarczenia plik贸w konfiguracyjnych instalatora), HAProxy oraz NFS dla storage&amp;rsquo;u klastra - w skr贸cie maszyn do wszystkiego poza OKD.&lt;/p&gt;

&lt;p&gt;Jeszcze tak na szybko - co to jest OKD? OKD to &amp;ldquo;The Community Distribution of Kubernetes that poerrs Red Hat OpenShift&amp;rdquo; - czyli w zasadzie darmowa wersja OpenShifta, kt贸ra ma kilka ogranicze, ale w wikszoci s to braki oficjalnych i certyfikowanych operator贸w, dostarczanych w ramach OpenShifta. Co ciekawe - dotary do mnie suchy o przynajmniej jednej firmie, kt贸ra migruje si lub ju偶 si zmigrowaa z OpenShifta na OKD w swoich rodowiskach produkcyjnych.&lt;/p&gt;

&lt;h2 id=&#34;postawienie-maszyn-wirtualnych&#34;&gt;Postawienie maszyn wirtualnych&lt;/h2&gt;

&lt;p&gt;Bd u偶ywa VMWare Workstation, ale da si to wszystko zrobi np. na VirtualBoksie. Zaczynamy od wykreowania sieci - uruchamiam Virtual Network Editor i dodaj now sie (VMnet10) typu Host-only, IP podsieci 192.168.64.0, maska 255.255.255.0. Wa偶ne - wyczam DHCP dla tej sieci (bdziemy stawia wasne DHCP). DHCP ze strony VMWare Workstation nie ma mo偶liwoci przypisania trwaych IP dla MAC Adresu.&lt;/p&gt;

&lt;p&gt;Nastpnie tworz 5 maszyn wirtualnych:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;okd-bastion&lt;/li&gt;
&lt;li&gt;okd-bootstrap&lt;/li&gt;
&lt;li&gt;okd-master01&lt;/li&gt;
&lt;li&gt;okd-master02&lt;/li&gt;
&lt;li&gt;okd-master03&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Ka偶da z nich ma 4 rdzenie, 8192 MiB RAM i 120GiB dysku. Ewentualnie, dla maszyny okd-bastion mo偶na da wicej (a nawet sporo wicej) dysku, bo bdzie potrzebny dla NFSa. Ja dodaem drugi dysk (500GiB) p贸藕niej.&lt;/p&gt;

&lt;p&gt;Dla okd-bastion dodaem 2 interfejsy sieciowe - pierwszy jako bridged network, drugi jako host-only ze wskazaniem sieci na VMnet10.&lt;/p&gt;

&lt;p&gt;Na maszynach bootrap i masterach nale偶y podmontowa iso Fedora CoreOS &lt;a href=&#34;https://builds.coreos.fedoraproject.org/prod/streams/stable/builds/38.20230430.3.1/x86_64/fedora-coreos-38.20230430.3.1-live.x86_64.iso&#34;&gt;https://builds.coreos.fedoraproject.org/prod/streams/stable/builds/38.20230430.3.1/x86_64/fedora-coreos-38.20230430.3.1-live.x86_64.iso&lt;/a&gt; - ja odpaliem maszyny i wcisnem TAB na etapie boot loadera - aby system nie startowa, ale maszyna aby bya uruchomiona - bo potrzebuj pobra ich MAC adresy, a te w VMWare s losowane po uruchomieniu.&lt;/p&gt;

&lt;h2 id=&#34;maszyna-okd-bastion&#34;&gt;Maszyna okd-bastion&lt;/h2&gt;

&lt;p&gt;Teraz okd-bastion. Zainstalowaem na niej Oracle Linux 9.2, ale mo偶e by w zasadzie dowolny linux. Bez 偶adnych dziwactw, mo偶e poza tym, 偶e daem cao na 1 FS (czyli dysk podmontowany jako /, bez osobnych dla /home itp).&lt;/p&gt;

&lt;p&gt;Po instalacji nale偶y doinstalowa kilka pakiet贸w:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;epel-release&lt;/li&gt;
&lt;li&gt;bind&lt;/li&gt;
&lt;li&gt;bind-utils&lt;/li&gt;
&lt;li&gt;haproxy&lt;/li&gt;
&lt;li&gt;dhcp-server&lt;/li&gt;
&lt;li&gt;httpd nfs-utils&lt;/li&gt;
&lt;li&gt;git&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Dodatkowo warto zainstalowa jq&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;wget -O jq https://github.com/stedolan/jq/releases/download/jq-1.6/jq-linux64
chmod +x jq
sudo mv jq /usr/local/bin/
jq --version
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;konfiguracja-firewalla&#34;&gt;Konfiguracja firewalla&lt;/h3&gt;

&lt;p&gt;U mnie interfejs zewntrzny bastiona to enp160, kt贸ry ma adres IP nadawany dynamicznie przez m贸j router. Drugim interfejsem jest enp192, kt贸ry ma podany adres statyczny 192.168.64.1.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;nmcli c mod ens192 connection.zone internal
nmcli c mod ens160 connection.zone external
firewall-cmd --permanent --zone=external --add-masquerade
firewall-cmd --permanent --zone=internal --add-masquerade
firewall-cmd --permanent --direct --add-rule ipv4 nat POSTROUTING 0 -o enp160 -j MASQUERADE
firewall-cmd --permanent --direct --add-rule ipv4 filter FORWARD 0 -i enp192 -o enp160 -j ACCEPT
firewall-cmd --permanent --direct --add-rule ipv4 filter FORWARD 0 -i enp160 -o enp192 -m state --state RELATED,ESTABLISHED -j ACCEPT
firewall-cmd --permanent --zone=external --add-port=9000/tcp
firewall-cmd --permanent --zone=external --add-port=80/tcp
firewall-cmd --permanent --zone=external --add-port=443/tcp
firewall-cmd --permanent --zone=trusted --add-source=192.168.64.0/24
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;konfiguracja-dhcp&#34;&gt;Konfiguracja DHCP&lt;/h3&gt;

&lt;p&gt;/etc/dhcp/dhcpd.conf - tu trzeba wstawi wasne MAC adresy dla bootstrapa i master贸w.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;authoritative;
ddns-update-style interim;
default-lease-time 14400;
max-lease-time 14400;

option routers                  192.168.64.1;
option broadcast-address        192.168.64.255;
option subnet-mask              255.255.255.0;
option domain-name-servers      192.168.64.1;
option domain-search            &amp;quot;okd.lab.local&amp;quot;;
option domain-name-servers      192.168.64.1;
option domain-name              &amp;quot;okd.lab.local&amp;quot;;

subnet 192.168.64.0 netmask 255.255.255.0 {
  interface ens192;
  pool {
    range 192.168.64.21 192.168.64.60;
    # Static entries
    host okd-bootstrap { hardware ethernet 00:0C:29:D5:20:56; fixed-address 192.168.64.200; option host-name &amp;quot;okd-bootstrap&amp;quot;;}
    host master01 { hardware ethernet 00:0C:29:08:EB:27; fixed-address 192.168.64.201; option host-name &amp;quot;okd-master01&amp;quot;;}
    host master02 { hardware ethernet 00:0C:29:C0:B8:B3; fixed-address 192.168.64.202; option host-name &amp;quot;okd-master02&amp;quot;;}
    host master03 { hardware ethernet 00:0C:29:AA:CC:72; fixed-address 192.168.64.203; option host-name &amp;quot;okd-master03&amp;quot;;}
    # this will not give out addresses to hosts not listed above
    # deny unknown-clients;
  }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;konfiguracja-dnsa-named&#34;&gt;Konfiguracja DNSa (named)&lt;/h3&gt;

&lt;p&gt;/etc/named.conf&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;options {
        listen-on port 53 { any; };
#       listen-on-v6 port 53 { ::1; };
        directory       &amp;quot;/var/named&amp;quot;;
        dump-file       &amp;quot;/var/named/data/cache_dump.db&amp;quot;;
        statistics-file &amp;quot;/var/named/data/named_stats.txt&amp;quot;;
        memstatistics-file &amp;quot;/var/named/data/named_mem_stats.txt&amp;quot;;
        recursing-file  &amp;quot;/var/named/data/named.recursing&amp;quot;;
        secroots-file   &amp;quot;/var/named/data/named.secroots&amp;quot;;
        allow-query     { any; };

        /*
         - If you are building an AUTHORITATIVE DNS server, do NOT enable recursion.
         - If you are building a RECURSIVE (caching) DNS server, you need to enable
           recursion.
         - If your recursive DNS server has a public IP address, you MUST enable access
           control to limit queries to your legitimate users. Failing to do so will
           cause your server to become part of large scale DNS amplification
           attacks. Implementing BCP38 within your network would greatly
           reduce such attack surface
        */
        recursion yes;
        forwarders {
                8.8.8.8;
                8.8.4.4;
        };

        //dnssec-enable yes;
        //dnssec-validation yes;

        /* Path to ISC DLV key */
        bindkeys-file &amp;quot;/etc/named.root.key&amp;quot;;

        managed-keys-directory &amp;quot;/var/named/dynamic&amp;quot;;

        pid-file &amp;quot;/run/named/named.pid&amp;quot;;
        session-keyfile &amp;quot;/run/named/session.key&amp;quot;;
};

logging {
        channel default_debug {
                file &amp;quot;data/named.run&amp;quot;;
                severity dynamic;
        };
};

zone &amp;quot;.&amp;quot; IN {
        type hint;
        file &amp;quot;named.ca&amp;quot;;
};

include &amp;quot;/etc/named.rfc1912.zones&amp;quot;;
include &amp;quot;/etc/named.root.key&amp;quot;;
include &amp;quot;/etc/named/named.conf.local&amp;quot;;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;/etc/named/named.conf.local&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;zone &amp;quot;okd.lab.local&amp;quot; {
    type master;
    file &amp;quot;/etc/named/zones/db.okd.local&amp;quot;; # zone file path
};


zone &amp;quot;64.168.192.in-addr.arpa&amp;quot; {
    type master;
    file &amp;quot;/etc/named/zones/db.192.168.64&amp;quot;;  # 192.168.64.0/24 subnet
};
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;/etc/named/zones/db.okd.local&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$TTL    604800
@       IN      SOA     okd-bastion.okd.lab.local. admin.okd.lab.local. (
                  2     ; Serial
             604800     ; Refresh
              86400     ; Retry
            2419200     ; Expire
             604800     ; Negative Cache TTL
)

; name servers - NS records
    IN      NS      okd-bastion

; name servers - A records
okd-bastion.okd.lab.local.          IN      A       192.168.64.1

; OpenShift Container Platform Cluster - A records
okd-bootstrap.okd.lab.local.        IN      A      192.168.64.200
okd-master01.okd.lab.local.         IN      A      192.168.64.201
okd-master02.okd.lab.local.         IN      A      192.168.64.202
okd-master03.okd.lab.local.         IN      A      192.168.64.203

; OpenShift internal cluster IPs - A records
api.okd.lab.local.    IN    A    192.168.64.1
api-int.okd.lab.local.    IN    A    192.168.64.1
*.apps.okd.lab.local.    IN    A    192.168.64.1
etcd-0.okd.lab.local.    IN    A     192.168.64.201
etcd-1.okd.lab.local.    IN    A     192.168.64.202
etcd-2.okd.lab.local.    IN    A    192.168.64.203
console-openshift-console.apps.okd.lab.local.     IN     A     192.168.64.1
oauth-openshift.apps.okd.lab.local.     IN     A     192.168.64.1

; OpenShift internal cluster IPs - SRV records
_etcd-server-ssl._tcp.okd.lab.local.    86400     IN    SRV     0    10    2380    etcd-0.lab
_etcd-server-ssl._tcp.okd.lab.local.    86400     IN    SRV     0    10    2380    etcd-1.lab
_etcd-server-ssl._tcp.okd.lab.local.    86400     IN    SRV     0    10    2380    etcd-2.lab
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;/etc/named/zones/db.192.168.64&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$TTL    604800
@       IN      SOA     okd-bastion.okd.lab.local. admin.okd.lab.local. (
                  7     ; Serial
             604800     ; Refresh
              86400     ; Retry
            2419200     ; Expire
             604800     ; Negative Cache TTL
)

; name servers - NS records
       IN    NS     okd-bastion.okd.lab.local.

; name servers - PTR records
1      IN    PTR    okd-services.okd.lab.local.

; OpenShift Container Platform Cluster - PTR records
200    IN    PTR    okd-bootstrap.okd.lab.local.
201    IN    PTR    okd-master01.okd.lab.local.
202    IN    PTR    okd-master02.okd.lab.local.
203    IN    PTR    okd-master03.okd.lab.local.
1      IN    PTR    api.okd.lab.local.
1      IN    PTR    api-int.okd.lab.local.
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;konfiguracja-haproxy&#34;&gt;Konfiguracja haproxy&lt;/h3&gt;

&lt;p&gt;/etc/haproxy/haproxy.cfg&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;# Global settings
#---------------------------------------------------------------------
global
    maxconn     20000
    log         /dev/log local0 info
    chroot      /var/lib/haproxy
    pidfile     /var/run/haproxy.pid
    user        haproxy
    group       haproxy
    daemon

    # turn on stats unix socket
    stats socket /var/lib/haproxy/stats

#---------------------------------------------------------------------
# common defaults that all the &#39;listen&#39; and &#39;backend&#39; sections will
# use if not designated in their block
#---------------------------------------------------------------------
defaults
    mode                    http
    log                     global
    option                  httplog
    option                  dontlognull
    option http-server-close
    option forwardfor       except 127.0.0.0/8
    option                  redispatch
    retries                 3
    timeout http-request    10s
    timeout queue           1m
    timeout connect         10s
    timeout client          300s
    timeout server          300s
    timeout http-keep-alive 10s
    timeout check           10s
    maxconn                 20000

listen stats
    bind :9000
    mode http
    stats enable
    stats uri /
    stats refresh 15s
    monitor-uri /healthz



frontend okd_api_fe_6443
    bind :6443
    default_backend okd_api_be_6443
    mode tcp
    option tcplog

backend okd_api_be_6443
    balance source
    mode tcp
    server      okd-bootstrap 192.168.64.200:6443 check
    server      okd-master01 192.168.64.201:6443 check
    server      okd-master02 192.168.64.202:6443 check
    server      okd-master03 192.168.64.203:6443 check

frontend okd_machine_config_server_fe_22623
    bind :22623
    default_backend okd_machine_config_server_be_22623
    mode tcp
    option tcplog

backend okd_machine_config_server_be_22623
    balance source
    mode tcp
    server      okd-bootstrap 192.168.64.200:22623 check
    server      okd-master01 192.168.64.201:22623 check
    server      okd-master02 192.168.64.202:22623 check
    server      okd-master03 192.168.64.203:22623 check

frontend okd_http_ingress_traffic_fe_80
    bind :80
    default_backend okd_http_ingress_traffic_be_80
    mode tcp
    option tcplog

backend okd_http_ingress_traffic_be_80
    balance source
    mode tcp
    server      okd-bootstrap 192.168.64.200:80 check
    server      okd-master01 192.168.64.201:80 check
    server      okd-master02 192.168.64.202:80 check
    server      okd-master03 192.168.64.203:80 check

frontend okd_https_ingress_traffic_fe_443
    bind *:443
    default_backend okd_https_ingress_traffic_be_443
    mode tcp
    option tcplog

backend okd_https_ingress_traffic_be_443
    balance source
    mode tcp
    server      okd-bootstrap 192.168.64.200:443 check
    server      okd-master01 192.168.64.201:443 check
    server      okd-master02 192.168.64.202:443 check
    server      okd-master03 192.168.64.203:443 check
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;konfiguracja-apache-httpd&#34;&gt;Konfiguracja Apache HTTPD&lt;/h3&gt;

&lt;p&gt;Tu akurat najprociej - wszystko co trzeba zmieni to port serwera HTTP (bo 80 bdzie zajta przez haproxy)&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;sudo sed -i &#39;s/Listen 80/Listen 8080/&#39; /etc/httpd/conf/httpd.conf
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;konfiguracja-nfsa&#34;&gt;Konfiguracja NFSa&lt;/h3&gt;

&lt;pre&gt;&lt;code&gt;sudo systemctl enable nfs-server rpcbind
sudo systemctl start nfs-server rpcbind
sudo mkdir -p /var/nfs
sudo chmod -R 777 /var/nfs
sudo chown -R nobody:nobody /var/nfs
echo &#39;/var/nfs 192.168.64.0/24(rw,sync,no_root_squash,no_all_squash,no_wdelay)&#39; | sudo tee /etc/exports
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;rozpoczcie-instalacji-okd&#34;&gt;Rozpoczcie instalacji OKD&lt;/h2&gt;

&lt;p&gt;Sama instalacja OKD skada si z 2 czci.&lt;/p&gt;

&lt;p&gt;Pierwsz jest przygotowanie plik贸w instalacyjnych. Te pliki bd zawieray ca startow konfiguracj klastra (kt贸r pozostawiam domyln) i wskazanie kluczy SSH do zaadowania na maszynach oraz pull secret贸w do pobrania obraz贸w z registry redhatowych. Z tych plik贸w nastpnie s generowane pliki ignition, kt贸re zawieraj instrukcje dla instalatora Fedora CoreOS, kt贸ry robi ca reszt.&lt;/p&gt;

&lt;p&gt;W drugim etapie najpierw odpalamy instalacj CoreOSa na maszynie okd-bootstrap, gdzie zostaje postawiony minimalistyczny klaster, do kt贸rego nastpnie zostaj dopite wzy master. W momencie, gdy klaster na nodach master bdzie ju偶 w stanie sam dziaa to bootstrap si zo偶y i nie bdzie wicej potrzebny - mo偶na go wyczy i usun. Z tego powodu nawet przy instalacjach typu baremetal maszyna bootstrap jest stawiana jako wirtualna - bo jest potrzebna tylko podczas instalacji.&lt;/p&gt;

&lt;h3 id=&#34;pull-secret&#34;&gt;pull secret&lt;/h3&gt;

&lt;p&gt;Potrzebne bd nam pull secrety do pobrania obraz贸w z registry RedHata. Mo偶na to rozwiza na przynajmniej 2 sposoby - u偶y domylnych lub zao偶y konto w RedHacie i pobra stamtd.
Domylne pull secret to&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;{
	&amp;quot;auths&amp;quot;:{
		&amp;quot;fake&amp;quot;:{&amp;quot;auth&amp;quot;: &amp;quot;bar&amp;quot;}
	}
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Pozwalaj one na instalacj klastra, ale nie daj dostpu do wszystkich operator贸w, dlatego warto pobra sobie pull secrety ze strony RedHata.
&lt;a href=&#34;https://console.redhat.com/openshift/install/pull-secret&#34;&gt;https://console.redhat.com/openshift/install/pull-secret&lt;/a&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;{&amp;quot;auths&amp;quot;:{
	&amp;quot;cloud.openshift.com&amp;quot;:{&amp;quot;auth&amp;quot;:&amp;quot;base64&amp;quot;,&amp;quot;email&amp;quot;:&amp;quot;email@wp.pl&amp;quot;},
	&amp;quot;quay.io&amp;quot;:{&amp;quot;auth&amp;quot;:&amp;quot;BASE64&amp;quot;,&amp;quot;email&amp;quot;:&amp;quot;email@wp.pl&amp;quot;},
	&amp;quot;registry.connect.redhat.com&amp;quot;:{&amp;quot;auth&amp;quot;:&amp;quot;BASE64&amp;quot;,&amp;quot;email&amp;quot;:&amp;quot;email@wp.pl&amp;quot;},
	&amp;quot;registry.redhat.io&amp;quot;:{&amp;quot;auth&amp;quot;:&amp;quot;BASE64&amp;quot;,&amp;quot;email&amp;quot;:&amp;quot;email@wp.pl&amp;quot;}
	}
}
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;klucze-ssh&#34;&gt;Klucze SSH&lt;/h3&gt;

&lt;p&gt;Tu sprawa jest du偶o prostsza - czyli generujemy klucze SSH.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;ssh-keygen
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;pobranie-instalatora-i-klienta&#34;&gt;Pobranie instalatora i klienta&lt;/h3&gt;

&lt;p&gt;Ze strony &lt;a href=&#34;https://github.com/okd-project/okd/releases&#34;&gt;https://github.com/okd-project/okd/releases&lt;/a&gt; pobieramy pliki
- &lt;a href=&#34;https://github.com/okd-project/okd/releases/download/4.12.0-0.okd-2023-04-16-041331/openshift-client-linux-4.12.0-0.okd-2023-04-16-041331.tar.gz&#34;&gt;openshift-client-linux-4.12.0-0.okd-2023-04-16-041331.tar.gz&lt;/a&gt;
- &lt;a href=&#34;https://github.com/okd-project/okd/releases/download/4.12.0-0.okd-2023-04-16-041331/openshift-install-linux-4.12.0-0.okd-2023-04-16-041331.tar.gz&#34;&gt;openshift-install-linux-4.12.0-0.okd-2023-04-16-041331.tar.gz&lt;/a&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;wget https://github.com/okd-project/okd/releases/download/4.12.0-0.okd-2023-04-16-041331/openshift-client-linux-4.12.0-0.okd-2023-04-16-041331.tar.gz
wget https://github.com/okd-project/okd/releases/download/4.12.0-0.okd-2023-04-16-041331/openshift-install-linux-4.12.0-0.okd-2023-04-16-041331.tar.gz
tar -zxvf openshift-client-linux-4.12.0-0.okd-2023-04-16-041331.tar.gz
tar -zxvf openshift-install-linux-4.12.0-0.okd-2023-04-16-041331.tar.gz
sudo mv kubectl oc openshift-install /usr/local/bin/
oc version
openshift-install version
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;przygotowanie-instalacji&#34;&gt;Przygotowanie instalacji&lt;/h3&gt;

&lt;pre&gt;&lt;code&gt;mkdir install_dir
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Tworz plik install_dir/install-config.yaml&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;apiVersion: v1
baseDomain: lab.local
metadata:
  name: okd

compute:
- hyperthreading: Enabled
  name: worker
  replicas: 0

controlPlane:
  hyperthreading: Enabled
  name: master
  replicas: 3

networking:
  clusterNetwork:
  - cidr: 10.128.0.0/14
    hostPrefix: 23
  networkType: OpenShiftSDN
  serviceNetwork:
  - 172.30.0.0/16

platform:
  none: {}

fips: false

pullSecret: &#39;{&amp;quot;auths&amp;quot;:{&amp;quot;fake&amp;quot;:{&amp;quot;auth&amp;quot;: &amp;quot;bar&amp;quot;}}}&#39;
sshKey: &#39;ssh-ed25519 AAAA...&#39;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Wa偶ne informacje - ustawi domen (baseDomain) i nazw klastra (metadata.name) - razem wychodzi okd.lab.local czyli to, co jest skonfigurowane w DNSie.&lt;/p&gt;

&lt;p&gt;Nastpnie nale偶y ustawi klucz SSH i pull secret.&lt;/p&gt;

&lt;p&gt;Jak plik bdzie gotowy najlepiej go zbackupowa - bo nastpne polecenie go usunie&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;cp ./install_dir/install-config.yaml ./install_dir/install-config.yaml.bak`
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Teraz tworzymy manifesty&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;openshift-install create manifests --dir=install_dir/
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Pozostaje nam utworzy pliki ignition&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;openshift-install create ignition-configs --dir=install_dir/
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;hostowanie-plik贸w-ignition&#34;&gt;Hostowanie plik贸w ignition&lt;/h3&gt;

&lt;p&gt;Teraz trzeba wystawi pliki na serwerze http&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;sudo mkdir /var/www/html/okd
sudo cp -R install_dir/* /var/www/html/okd/
sudo chown -R apache: /var/www/html/
sudo chmod -R 755 /var/www/html/
sudo setsebool -P httpd_read_user_content 1
sudo systemctl enable httpd
sudo systemctl start httpd
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;i mo偶na sprawdzi, czy wszystko bangla&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;curl localhost:8080/okd/metadata.json
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;pobranie-obrazu-fedora-coreos&#34;&gt;Pobranie obrazu Fedora CoreOS&lt;/h3&gt;

&lt;p&gt;Ze strony &lt;a href=&#34;https://fedoraproject.org/coreos/download/?stream=stable&#34;&gt;https://fedoraproject.org/coreos/download/?stream=stable&lt;/a&gt; nale偶y pobra 2 pliki: obraz raw Fedora CoreOS i plik sygnatury&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;wget https://builds.coreos.fedoraproject.org/prod/streams/stable/builds/38.20230430.3.1/x86_64/fedora-coreos-38.20230430.3.1-metal.x86_64.raw.xz
wget https://builds.coreos.fedoraproject.org/prod/streams/stable/builds/38.20230430.3.1/x86_64/fedora-coreos-38.20230430.3.1-metal.x86_64.raw.xz.sig
mv fedora-coreos-38.20230430.3.1-metal.x86_64.raw.xz fcos.raw.xz
mv fedora-coreos-38.20230430.3.1-metal.x86_64.raw.xz.sig fcos.raw.xz.sig
mv fcos.raw.* /var/www/html/okd
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;instalacja-bootstrapa&#34;&gt;Instalacja bootstrapa&lt;/h2&gt;

&lt;p&gt;Mamy odpalon maszyn okd-bootstrap, ale zatrzyman na bootloaderze. Trzeba tam dopisa parametry uruchomieniowe - wszystko w jednej linii, ja tu wstawiem znaki nowej linii aby byo atwiej czyta.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;coreos.inst.install_dev=/dev/nvme0n1
coreos.inst.image_url=http://192.168.64.1:8080/okd/fcos.raw.xz
coreos.inst.ignition_url=http://192.168.64.1:8080/okd/bootstrap.ign
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;instalacja-master贸w&#34;&gt;Instalacja master贸w&lt;/h2&gt;

&lt;p&gt;Na masterach analogicznie - dopisujemy parametry uruchomieniowe. Jedyna r贸偶nica to u偶ycie pliku master.ign zamiast bootstrap.ign&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;coreos.inst.install_dev=/dev/nvme0n1
coreos.inst.image_url=http://192.168.64.1:8080/okd/fcos.raw.xz
coreos.inst.ignition_url=http://192.168.64.1:8080/okd/master.ign
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Teraz pozostaje czeka. Najatwiej jest odpali na bastionie&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;openshift-install --dir=install_dir/ wait-for bootstrap-complete --log-level=info
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;W pewnym momencie p贸jdzie komunikat, 偶e bootstrapowanie jest zakoczone i mo偶na si pozby maszyny okd-bootstrap.&lt;/p&gt;

&lt;p&gt;Klaster cay czas si stawia, do pobrania jest sporo obraz贸w. Postpy mo偶na obserwowa narzdziem oc (openshiftowym kubectl)&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;export KUBECONFIG=~/install_dir/auth/kubeconfig
oc get nodes -o wide
oc get csr
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Warto sprawdzi, czy wszystkie CSRy s zatwierdzone - je偶eli nie, to mo偶na je zatwierdzi rcznie (u mnie nie byo potrzeby)&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;oc get csr -ojson | jq -r &#39;.items[] | select(.status == {} ) | .metadata.name&#39; | xargs oc adm certificate approve
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Gdy z polecenia&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;oc get nodes
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;wszystkie nody bd jako Ready to znaczy, 偶e CSRy s prawidowo zatwierdzone. Teraz nale偶y poczeka, a偶 zainstaluj si wszystkie clusteroperatory&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;oc get clusteroperators
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;lub skr贸towo&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;oc get co
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;U mnie to trwao dugo, jakie 2 godziny (mam wolne cze). Warto te偶 obserwowa czy nie ma ErrImagePull, Crash czy innych bd贸w na podach przez&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;oc get pods -A
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Takie pody usuwaem.
Mo偶e jeszcze wystpi problem z machine configiem. Gdy&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;oc get mcp
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;nie zmienia statusu dugo warto sprawdzi co si dzieje. W tym celu zrobiem&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;oc get mcp master -o yaml
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;i pojawia si tam informacja&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;message: &#39;Node okd-master02 is reporting: &amp;quot;getting pending state from journal:
      invalid character &#39;&#39;U&#39;&#39; looking for beginning of value&amp;quot;, Node okd-master03 is
      reporting: &amp;quot;getting pending state from journal: invalid character &#39;&#39;U&#39;&#39; looking
      for beginning of value&amp;quot;&#39;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Jest to problem z journalem. W tym celu zalogowaem si na podane nody&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;ssh core@okd-master02.okd.lab.local
sudo -i
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code&gt;[root@okd-master02 ~]# journalctl --verify
Journal file /var/log/journal/674cc4f6256143379fd7935e328f9d5a/system@0005fc3742709c54-6eca9ce9bfe3ba10.journal~ uses an unsupported feature, ignoring file.
Use SYSTEMD_LOG_LEVEL=debug journalctl --file=/var/log/journal/674cc4f6256143379fd7935e328f9d5a/system@0005fc3742709c54-6eca9ce9bfe3ba10.journal~ to see the details.
PASS: /run/log/journal/b6e26c4db861474baaf198d6ef590c14/system.journal
PASS: /var/log/journal/674cc4f6256143379fd7935e328f9d5a/system@9568609074994ae3930a1fa8619a9c92-0000000000000001-0005fc374221691a.journal
PASS: /var/log/journal/674cc4f6256143379fd7935e328f9d5a/user-1000@ecb0a8ca75ee43acb8fb7aa5b5371224-000000000000847e-0005fc381cd80d81.journal
PASS: /var/log/journal/674cc4f6256143379fd7935e328f9d5a/system@9568609074994ae3930a1fa8619a9c92-00000000000084bf-0005fc381d13973f.journal
PASS: /var/log/journal/674cc4f6256143379fd7935e328f9d5a/user-1000@ecb0a8ca75ee43acb8fb7aa5b5371224-00000000000084c2-0005fc381d16f9f2.journal
PASS: /var/log/journal/674cc4f6256143379fd7935e328f9d5a/system@9568609074994ae3930a1fa8619a9c92-000000000000ad1b-0005fc384862d10e.journal
390c80: Data object references invalid entry at 4e1da0
File corruption detected at /var/log/journal/674cc4f6256143379fd7935e328f9d5a/system.journal:4e19d0 (of 8388608 bytes, 61%).
FAIL: /var/log/journal/674cc4f6256143379fd7935e328f9d5a/system.journal (Bad message)
PASS: /var/log/journal/674cc4f6256143379fd7935e328f9d5a/user-1000@ecb0a8ca75ee43acb8fb7aa5b5371224-000000000000ad1e-0005fc384863d4c7.journal
PASS: /var/log/journal/674cc4f6256143379fd7935e328f9d5a/user-1000.journal
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Tu mamy informacje o problemach z journalami. Usunem wpisy z journali&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;[root@okd-master02 ~]# journalctl --vacuum-time=1m
Journal file /var/log/journal/674cc4f6256143379fd7935e328f9d5a/system@0005fc3742709c54-6eca9ce9bfe3ba10.journal~ uses an unsupported feature, ignoring file.
Use SYSTEMD_LOG_LEVEL=debug journalctl --file=/var/log/journal/674cc4f6256143379fd7935e328f9d5a/system@0005fc3742709c54-6eca9ce9bfe3ba10.journal~ to see the details.
Vacuuming done, freed 0B of archived journals from /run/log/journal.
Vacuuming done, freed 0B of archived journals from /run/log/journal/b6e26c4db861474baaf198d6ef590c14.
Vacuuming done, freed 0B of archived journals from /var/log/journal.
Deleted archived journal /var/log/journal/674cc4f6256143379fd7935e328f9d5a/system@0005fc3742709c54-6eca9ce9bfe3ba10.journal~ (8.0M).
Deleted archived journal /var/log/journal/674cc4f6256143379fd7935e328f9d5a/system@9568609074994ae3930a1fa8619a9c92-0000000000000001-0005fc374221691a.journal (35.3M).
Deleted archived journal /var/log/journal/674cc4f6256143379fd7935e328f9d5a/user-1000@ecb0a8ca75ee43acb8fb7aa5b5371224-000000000000847e-0005fc381cd80d81.journal (3.5M).
Deleted archived journal /var/log/journal/674cc4f6256143379fd7935e328f9d5a/system@9568609074994ae3930a1fa8619a9c92-00000000000084bf-0005fc381d13973f.journal (12.1M).
Deleted archived journal /var/log/journal/674cc4f6256143379fd7935e328f9d5a/user-1000@ecb0a8ca75ee43acb8fb7aa5b5371224-00000000000084c2-0005fc381d16f9f2.journal (3.6M).
Deleted archived journal /var/log/journal/674cc4f6256143379fd7935e328f9d5a/system@9568609074994ae3930a1fa8619a9c92-000000000000ad1b-0005fc384862d10e.journal (22.7M).
Deleted archived journal /var/log/journal/674cc4f6256143379fd7935e328f9d5a/user-1000@ecb0a8ca75ee43acb8fb7aa5b5371224-000000000000ad1e-0005fc384863d4c7.journal (3.7M).
Vacuuming done, freed 89.2M of archived journals from /var/log/journal/674cc4f6256143379fd7935e328f9d5a.
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Ponowna weryfikacja przebiega prawidowo&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;[root@okd-master02 ~]# journalctl --verify
PASS: /run/log/journal/b6e26c4db861474baaf198d6ef590c14/system.journal
PASS: /var/log/journal/674cc4f6256143379fd7935e328f9d5a/system.journal
PASS: /var/log/journal/674cc4f6256143379fd7935e328f9d5a/user-1000.journal
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Teraz Machine config si zakoczy prawidowo.&lt;/p&gt;

&lt;p&gt;Klaster dziaa. Mo偶na si zalogowa do konsoli. Adres konsoli mo偶na odczyta przy u偶yciu oc&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;oc whoami --show-console
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;W tym przypadku jest to &lt;a href=&#34;https://console-openshift-console.apps.okd.lab.local&#34;&gt;https://console-openshift-console.apps.okd.lab.local&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Aby si zalogowa nale偶y poda u偶ytkownika kubeadmin i hasa z pliku install_dir/auth/kubeadmin-password&lt;/p&gt;

&lt;p&gt;Teraz pozostaje utworzenie u偶ytkownika i skonfigurowanie storage&amp;rsquo;u.&lt;/p&gt;

&lt;h2 id=&#34;utworzenie-u偶ytkownik贸w&#34;&gt;Utworzenie u偶ytkownik贸w&lt;/h2&gt;

&lt;p&gt;Czas utworzy u偶ytkownika. Z kubeadmin nie nale偶y bezporednio korzysta, warto potworzy u偶ytkownik贸w imiennych. Najprostszym sposobem jest u偶ycie htpasswd. Najpierw wygenerujmy plik htpasswd&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;htpasswd -c -B -b users.htpasswd testuser testpassword
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Nastpnie mo偶na zaadowa ten plik&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;oc create secret generic htpass-secret --from-file=htpasswd=users.htpasswd -n openshift-config
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Aby z tego korzysta nale偶y utworzy htpasswd_provider. W tym celu nale偶y utworzy plik htpasswd_provider.yaml&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;apiVersion: config.openshift.io/v1
kind: OAuth
metadata:
  name: cluster
spec:
  identityProviders:
  - name: htpasswd_provider
    mappingMethod: claim
    type: HTPasswd
    htpasswd:
      fileData:
        name: htpass-secret
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;i zaadowa go do klastra&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;oc apply -f htpasswd_provider.yaml
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Teraz czas nada uprawnienia. Pierwszemu u偶ytkownikowi warto nada cluster-admin (czyli globalnego admina)&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;oc adm policy add-cluster-role-to-user cluster-admin testuser
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Trzeba poczeka chwil (u mnie ok. minuty) i po wejciu na konsol zostaniemy przekierowani na ekran wybory providera to偶samoci.&lt;/p&gt;

&lt;h2 id=&#34;konfiguracja-storage-u&#34;&gt;Konfiguracja storage&amp;rsquo;u&lt;/h2&gt;

&lt;p&gt;Aby klaster by cakowicie funkcjonalny brakuje ostatniej rzeczy - podczenia storage&amp;rsquo;u. Na okd-bastion mamy skonfigurowany zas贸b NFS /var/nfs udostpniony dla sieci 192.168.64.0/24. Aby z niego skorzysta mo偶emy podej na 2 sposoby. W wariancie prostszym mo偶na konfigurowa Persistent Volume. Konfigurujc PV wskazuje si adres IP serwera i cie偶k do zasobu, np. tak:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;apiVersion: v1
kind: PersistentVolume
metadata:
  name: nfs1-pv
spec:
  capacity:
    storage: 100Gi
  accessModes:
    - ReadWriteMany
  persistentVolumeReclaimPolicy: Retain
  nfs:
    path: /var/nfs/nfs1
    server: 192.168.64.1
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Zalet jest to, 偶e dziaa to bez 偶adnych dodatkowych operator贸w, wad - 偶e musimy definiowa takie woluminy samodzielnie.&lt;/p&gt;

&lt;p&gt;Jest drugie rozwizanie - utworzenie Storage Class. Niestety, kubernetes (ani te偶 OpenShift) nie ma wbudowanej storage classy do obsugi NFS. Jest jednak rozwizanie w postaci zewntrznego provisionera, co prawda niedostpnego przez OperatorHuba w OKD czy OpenShifcie.&lt;/p&gt;

&lt;p&gt;Widziaem przynajmniej 2 takie rozwizania, ja wybraem # Kubernetes NFS Subdir External Provisioner (&lt;a href=&#34;https://github.com/kubernetes-sigs/nfs-subdir-external-provisioner&#34;&gt;https://github.com/kubernetes-sigs/nfs-subdir-external-provisioner&lt;/a&gt;). Na githubie jest adna instrukcja, nawet zawierajca osobn cz dla OpenShifta. W zasadzie cao to przepisanie fragmentu tej instrukcji, ale myl, 偶e warto to zawrze dla kompletnoci instrukcji.&lt;/p&gt;

&lt;p&gt;Zaczynamy od sklonowania repozytorium:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;git clone https://github.com/kubernetes-sigs/nfs-subdir-external-provisioner.git
cd nfs-subdir-external-provisioner
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Nale偶y zacz od utworzenia projektu/namespace&amp;rsquo;u dla provisionera, ja wybraem &amp;ldquo;nfs-provisioner&amp;rdquo;. Zatem najpierw tworzymy projekt:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;oc new-project nfs-provisioner
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Po utworzeniu projektu zostanie on automatycznie wybrany. Teraz jedziemy dokadnie wedug instrukcji:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;NAMESPACE=`oc project -q`
sed -i&#39;&#39; &amp;quot;s/namespace:.*/namespace: $NAMESPACE/g&amp;quot; ./deploy/rbac.yaml ./deploy/deployment.yaml
oc create -f deploy/rbac.yaml
oc adm policy add-scc-to-user hostmount-anyuid system:serviceaccount:$NAMESPACE:nfs-client-provisioner
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Nastpnie w pliku deploy/deployment.yaml nale偶y ustawi adres do serwera NFS&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;apiVersion: apps/v1
kind: Deployment
metadata:
  name: nfs-client-provisioner
  labels:
    app: nfs-client-provisioner
  # replace with namespace where provisioner is deployed
  namespace: nfs-provisioner
spec:
  replicas: 1
  strategy:
    type: Recreate
  selector:
    matchLabels:
      app: nfs-client-provisioner
  template:
    metadata:
      labels:
        app: nfs-client-provisioner
    spec:
      serviceAccountName: nfs-client-provisioner
      containers:
        - name: nfs-client-provisioner
          image: registry.k8s.io/sig-storage/nfs-subdir-external-provisioner:v4.0.2
          volumeMounts:
            - name: nfs-client-root
              mountPath: /persistentvolumes
          env:
            - name: PROVISIONER_NAME
              value: k8s-sigs.io/nfs-subdir-external-provisioner
            - name: NFS_SERVER
              value: 192.168.64.1
            - name: NFS_PATH
              value: /var/nfs
      volumes:
        - name: nfs-client-root
          nfs:
            server: 192.168.64.1
            path: /var/nfs
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Teraz nale偶y zaadowa ten manifest&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;oc apply -f deploy/deployment.yaml
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Majc gotowego provisionera mo偶na utworzy strorageclass. Domylna jest w pliku deploy/class.yaml. Ja zdecydowaem si jednak minimalnie j zmieni - a mianowicie ustawi jako domyl:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  annotations:
    storageclass.kubernetes.io/is-default-class: &amp;quot;true&amp;quot;
  name: nfs-client
parameters:
  onDelete: delete
  pathPattern: ${.PVC.namespace}/${.PVC.annotations.nfs.io/storage-path}
provisioner: k8s-sigs.io/nfs-subdir-external-provisioner
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;podsumowanie&#34;&gt;Podsumowanie&lt;/h2&gt;

&lt;p&gt;To koczy proces instalacji i minimalnej konfiguracji klastra OKD.&lt;/p&gt;

&lt;p&gt;W przypadku &amp;ldquo;penego&amp;rdquo; OpenShifta (patnego) proces instalacji jest identyczny, r贸偶nice to pobranie waciwego instalatora (zamiast OKD z Githuba nale偶y pobra OpenShift od RedHata). Oczywicie, nic nie stoi na przeszkodzie aby w swoim labie postawi taki klaster - istnieje wersja testowa na 60 dni. Cao do pobrania z &lt;a href=&#34;https://console.redhat.com/openshift/downloads&#34;&gt;https://console.redhat.com/openshift/downloads&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Na zakoczenie chciabym jeszcze wskaza 2 ciekawe 藕r贸da - jest to instrukcja instalacji klastra w wersji 4.5 autorstwa Craiga Robinsona &lt;a href=&#34;https://itnext.io/guide-installing-an-okd-4-5-cluster-508a2631cbee&#34;&gt;https://itnext.io/guide-installing-an-okd-4-5-cluster-508a2631cbee&lt;/a&gt; oraz pewnego rodzaju uzupenienie w postaci zapisu streama z instalacji wedug tej instrukcji  &lt;a href=&#34;https://www.youtube.com/watch?v=qh1zYW7BLxE&#34;&gt;https://www.youtube.com/watch?v=qh1zYW7BLxE&lt;/a&gt;. Warto przejrze te偶 inne wpisy na blogu Craiga - jest tam wiele instrukcji dotyczcych instalacji OpenShifta na r贸偶ne sposoby.&lt;/p&gt;

&lt;p&gt;Przy tworzeniu tej instrukcji pomocny te偶 by ocp4-helpernode &lt;a href=&#34;https://github.com/redhat-cop/ocp4-helpernode&#34;&gt;https://github.com/redhat-cop/ocp4-helpernode&lt;/a&gt; - zautomatyzowany ansiblem spos贸b budowy bastiona. Wanie z niego zaczerpnem pomys postawienie wasnego serwera DHCP a nie opieranie si na dodatkowej maszynie z postawionym pfsensem. Helpernode u偶ywa DHCP, jednak jest nastawiony na pozostawienie zewntrznego gatewaya - ja nie chciaem mie 2 serwer贸w DHCP w jednym segmencie sieci wic zdecydowaem si na skonfigurowanie routingu na bastionie.&lt;/p&gt;

&lt;p&gt;Jednak helpernode ma jeszcze jedn bardzo ciekaw funkcjonalno - konfiguruje PXE Boot, co jeszcze bardziej uatwia instalacj kolejnych node贸w - bo wystarczy wybra z menu kt贸rego typu maszyn postawi (bootstrap, master, worker). Jest to ciekawe rozwizanie, ale wedug mnie na potrzeby maego klastra jest to przerost formy nad treci.&lt;/p&gt;
</description>
    </item>
    
    
    
    <item>
      <title>Linux - historia prawdziwa</title>
      <link>https://kamm.github.io/2021/04/linux-historia-prawdziwa/</link>
      <pubDate>Thu, 22 Apr 2021 15:56:15 CEST</pubDate>
      <author>Kamil Mtrak</author>
      <guid>https://kamm.github.io/2021/04/linux-historia-prawdziwa/</guid>
      <description>&lt;p&gt;Tym razem bdzie bardziej blognotka. Wielokrotnie byem okrelany jako &amp;ldquo;ten windowsiarz&amp;rdquo;, co dla os贸b, kt贸re znaj mnie troch du偶ej bdzie zdziwieniem. Ale mo偶e po kolei.&lt;/p&gt;

&lt;p&gt;Gdy zaczem studia najpopularniejszymi systemami byy 2 windowsy - 98 i 2000 (o ME chyba wszyscy chc zapomnie). By to rok 2001, czyli chwila przed pojawieniem si XP. Z linuksem (dobra, GNU/Linux) miaem minimalne dowiadczenie - pr贸bowaem u偶ywa wczeniej RedHata (5.1 Manhattan), Monkey Linux, by te偶 Mandrake Linux, ale tak jako nigdy w ten temat gbiej nie wszedem. G贸wnym problemem bya kwestia kompatybilnoci sprztu.&lt;/p&gt;

&lt;p&gt;Jednak na studiach kumpel pokaza mi Slackware i ten system jako mi si spodoba. Troch hardcorowy, ale ciekawy. Trzeba si byo troch nakombinowa, mo偶e troch taka sztuka dla sztuki, ale udao mi si pozna linuksa i nawet udao mi si na nim normalnie pracowa. Oczywicie, do gier pozosta windows.&lt;/p&gt;

&lt;p&gt;Tak miny jakie 2-3 lata i kupiem pierwszego laptopa. Chciaem tu spr贸bowa czego innego. Slackware by fajny, ale tak troch z zazdroci patrzyem jak np. na debianie wystarcza apt-get install i gotowe, a ja musz si mczy jak jaskiniowiec. Postanowiem na lapku postawi debiana. Moja przygoda wtedy skoczya si dosy szybko - debian, jako system w kt贸rym wszystko jest stabilne czyli troch przestarzae - mia cay czas XFree86, a nie Xorg&amp;rsquo;a. To powodowao, 偶e na moim lapku nie byem w stanie dobrze skonfigurowa grafiki. C贸偶. Bywa. Nie pamitam ju偶 dlaczego nie poszedem w sida, ale dzisiaj to ju偶 nieistotne. Pojawia si wtedy nowa dystrybucja, bazujca na debianie - Ubuntu. Spodobao mi si, 偶e wszystko dziaa out-of-the-box i tak zaczem u偶ywa &lt;em&gt;ubudubu&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;W 2006 roku zaczem prac. W pracy jednak systemem u偶ywanym na serwerach by windows wic aby skonfigurowa u siebie jakie rodowisko deweloperskie potrzebowaem windowsa. I tak po kilku latach u偶ywania pingwina wr贸ciem do okien. A w linuksie byem zdecydowanie poweruserem - wystarczy powiedzie, 偶e zdecydowaem si u偶ywa jako rodowiska graficznego najpierw mocno dostrojonego pod siebie windowmakera, a p贸藕niej FVWM Crystal - chyba najpopularniejszego w tamtych czasach managera okien wr贸d ludzi chwalcych si screenshotami pulpitu.&lt;/p&gt;

&lt;p&gt;Jednak w pracy potrzebowaem windowsa. I tak w niego wsikem. Jedna firma, druga, trzecia&amp;hellip; Ale zawsze mi brakowao troch linuksa - najpierw bya proteza w postaci przynajmniej paru narzdzi terminalowych - zawsze co. Najpierw by MinGW. Potem kr贸tki epizod z MacOSem - wreszcie mogem pracowa z &amp;ldquo;natywnym&amp;rdquo; bashem :) Potem powr贸t do windowsa, odkrycie cygwina i byo ju偶 cakiem fajnie. W kocu zaczem u偶ywa babuna (o kt贸rym pisaem w 2016 roku). W firmie, w kt贸rej aktualnie pracuj nie ma problemu aby u偶ywa linuksa, ale jako si na to nie zdecydowaem.&lt;/p&gt;

&lt;p&gt;Jaki rok temu pr贸bowaem na prywatnym komputerze wr贸ci do linuksa na desktopie - bo u偶ycie na serwerach to dla mnie oczywisto i nie jest to dla mnie trudne, a w konsoli zawsze mi si najlepiej pracowao. Nie mogem jednak sobie poradzi w nowym ubuntu. Co mi cay czas nie pasowao, chocia偶 mo偶e w pewnym sensie przyzwyczaiem si do pewnych udogodnie w windowsie.&lt;/p&gt;

&lt;p&gt;W tym roku stwierdziem, 偶e kupi sobie co ciekawego - thinkpada. Wybraem X230. I oczywicie tu powdruje linux. Pocztkowo chciaem debiana, ale stwierdziem 偶e wypr贸buj co zupenie innego. Dystrybucj o kt贸rej tylko syszaem, ale zawsze chwalon i wielokrotnie por贸wnywan ze slackiem, z kt贸rego kiedy korzystaem - Arch Linux.&lt;/p&gt;

&lt;p&gt;Thinkpad jak to thinkpad - pod pingwinem obsugiwane wszystko bez najmniejszego problemu. Od archa zawsze odrzucao mnie przez pewne lenistwo - kwestia instalacji. Tak, ta dystrybucja nie ma instalatora. Nawet tak podstawowego jak 20 lat temu mia slackware czy debian. Nie - tu wszystko trzeba zrobi samemu. Jednak po przezwyci偶eniu lenistwa i doczytaniu troch w arch wiki postawiem system. Chciaem go mie dosy minimalistyczny i zastanawiaem si nad instalacj w stylu konfiguracji Luke&amp;rsquo;a Smitha, ale nie pasowao mi to. Z powodu wspomnianego lenistwa bazowaem na czyjej konfiguracji i trafiem na fajny zestaw narzdzi - &lt;a href=&#34;https://github.com/addy-dclxvi/dotfiles&#34;&gt;GitHub - addy-dclxvi/dotfiles: My personal backup of my dotfiles on ThinkPad-X230-Debian-Openbox and Aspire-A514-Debian-Fluxbox&lt;/a&gt;. Czyli wybraem openboksa - jako 偶e pamitam jeszcze blackboksa i p贸藕niejszego fluxboksa to mi bardzo podpasowa. Addy u偶ywa debiana - tu musiaem troch rzeczy wykombinowa, bo nie zadziaay od razu, ale to nie problem. Uzupeniem kilkoma pomysami od Luke&amp;rsquo;a Smitha i tak udao mi si wreszcie wr贸ci do u偶ywania linuksa jako daily. I czuj,偶e bya to dobra decyzja.&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://kamm.github.io/images/Cheese_21.04.22_16.18.38.png&#34; alt=&#34;screen&#34; /&gt;&lt;/p&gt;
</description>
    </item>
    
    
    
    <item>
      <title>Suckless po mojemu</title>
      <link>https://kamm.github.io/2021/04/suckless-po-mojemu/</link>
      <pubDate>Tue, 20 Apr 2021 20:18:00 CEST</pubDate>
      <author>Kamil Mtrak</author>
      <guid>https://kamm.github.io/2021/04/suckless-po-mojemu/</guid>
      <description>&lt;p&gt;Tym razem zn贸w o narzdziach z kt贸rych korzystam. Zaczn od tego jak na to trafiem. Ogldaem sobie tak z nud贸w youtuba i wpad mi film Zmaso o tym, 偶e zainstalowa archa. Wtedy jeszcze nie byem przekonany do tej dystrybucji, ale przejrzaem sobie co on tam ma - tiling managery do mnie nie przemawiaj, ale zainteresowa mnie st - simple terminal (lub jak inni wol mowi suckless terminal). Zaczem si interesowa narzdziami suckless i miaem troch mieszane uczucia. Z tego samego filmu dowiedziaem si te偶 o kanale Luke&amp;rsquo;a Smitha. Go opowiada fajne rzeczy o linuksie (czasem og贸lnie, czasem specyficznie o archu), minimalistycznych narzedziach, filozofii wolnego oprogramowania - generalnie polecam.&lt;/p&gt;

&lt;p&gt;Luke Smith udostpni kilka ciekawych modyfikacji do st i spodobay mi si. Niestety, przynajmniej jedna z nich jest atwa do ogarnicia tylko na archu, ale to ju偶 dla mnie nie problem . Tak zaczem korzysta z st w miejsce urxvt.&lt;/p&gt;

&lt;p&gt;Mo偶e troch powiem o suckless. Te narzdzia s dosy specyficzne. Filozofia suckless to narzdzia proste, mo偶liwie przejrzycie napisane, o jak najmniejszej iloci kodu (czyli bez niepotrzebnych funkcjonalnoci). Tu przyadowo o st - xterm ma ok. 65k linii kodu, przedewszystkim ze wzgldu na wsparcie dla emulacji r贸偶nych archaicznych terminali. Rxvt-unicode lub inaczej urxvt ma ok. 32k linii kodu. st ma ok 7k linii kodu. Jednak nie wszystko jest takie pikne. Narzdzia suckless oszczdzaj linie kodu rezygnujc tak偶e z plik贸w konfiguracyjnych. Konfiguracja we wszystkich programach odbywa si poprzez edycj pliku config.h i przebudowanie programu. Z tego wynika kolejny problem - nie da si tego spaczkowa i umieci np. w repozytorium archa lub debiana - bo nie mo偶na tego konfigurowa.&lt;/p&gt;

&lt;p&gt;I tu zaczyna si moje ale do suckless. O ile terminal konfiguruje si w zasadzie raz i tyle, to w pakiecie suckless jest program do prowadzenia prezentacji - sent. Niby fajne, ale aby zmieni kolor ta lub font w prezentacji nale偶y przekompilowa sent. To nie pasuje.&lt;/p&gt;

&lt;p&gt;Suckless ma te藕 swoj manager okien, jednak jest to manager kafelkowy (chyba tak nale偶aoby przetumaczy tiling), ale to mi nie le偶y i na razie zostan przy openboksie.&lt;/p&gt;

&lt;p&gt;Jednak kolejne narzdzie tu ju偶 co innego - dmenu. W skr贸cie - jest to dynamiczne menu, z kt贸rego bardzo mio korzysta si w skryptach. Obsugiwane oczywicie w caoci klawiatur. W kt贸rym nastpnym wpisie opisz skrypty, z kt贸rych korzystam.&lt;/p&gt;

&lt;p&gt;Podsumowujc - cz rozwiza suckless jest rzeczywicie fajnych, a ich minimalizm naprawd fajny. Jednak druga cz tych narzdzi to suckmore - zdecydowanie odbiegajce od reszty, niezbyt przemylane. Mam wra偶enie, 偶e taki sent by napisany po to aby przeprowadzi jedn prezentacj, ewentualnie - programista napisa go tylko dla siebie i pod siebie.&lt;/p&gt;

&lt;p&gt;Tyle&amp;hellip;&lt;/p&gt;
</description>
    </item>
    
    
    
    <item>
      <title>screen - manager okien w terminalu tekstowym</title>
      <link>https://kamm.github.io/2021/04/screen/</link>
      <pubDate>Tue, 13 Apr 2021 16:37:15 CEST</pubDate>
      <author>Kamil Mtrak</author>
      <guid>https://kamm.github.io/2021/04/screen/</guid>
      <description>

&lt;p&gt;Cze.&lt;/p&gt;

&lt;p&gt;Od czasu pojawienia si koronawirusa caa moja praca odbywa si zdalnie. Niestety, wiele os贸b narzeka na stabilno VPNa - tym si nie bd zajmowa ani wnika w powody i propozycje rozwizania. Zaproponuj pewn protez, kt贸ra pomo偶e w tym przypadku a jednoczenie da kilka innych mo偶liwoci pracy na systemach uniksowych.&lt;/p&gt;

&lt;p&gt;Generalnie pomys jest prosty i jest obecny np. przy poczeniu pulpitem zdalnym - czyli gdy zostanie zerwane poczenie sieciowe z serwerem to sesja jest odczana a nie zrywana. Oznacza to tyle, 偶e gdy stracimy poczenie sieciowe to procesy uruchomione na pulpicie zdalnym cay czas dziaaj i po pierwsze mo偶emy je tak zostawi gdy chcemy pozostawi jaki dugo dziaajcy proces albo zabezpieczy si przed wanie takim zerwaniem poczenia - np. wykonujemy jaki update na bazie danych lub budujemy co mavenem. Tak samo jest gdy u偶ywamy VNC. Nie bd wnika w inne rozwizania bo ich nie znam.&lt;/p&gt;

&lt;p&gt;Ale nie zawsze chcemy u偶ywa rodowiska graficznego - do wielu rzeczy wystarcza terminal - czyli wystarczy nam poczenie ssh. Jednak przy poczeniu SSH je偶eli poczenie zostanie zerwane to proces zostanie ubity. Czyli zbudowanie na serwerze aplikacji mavenem, gdzie budowa trwa godzin nigdy si nie uda, gdy VPN zrywa poczenie po 30 minutach.&lt;/p&gt;

&lt;p&gt;I tu wchodzi cay na biao (he he) screen. Oczywicie, kto powie &amp;ldquo;tmux mo偶e to samo i nawet wicej&amp;rdquo;. Tak, ale screen jest du偶o prostszy w u偶yciu i do tego zastosowania wystarczy. Jednoczenie jest on dobrym wstpem do p贸藕niejszego u偶ycia tmuxa.&lt;/p&gt;

&lt;p&gt;Czym jest screen? Jak m贸wi &lt;em&gt;man&lt;/em&gt; jest to penoekranowy manager okien, kt贸ry multipleksuje fizyczny terminal pomidzy kilkoma procesami.&lt;/p&gt;

&lt;p&gt;No dobra, ale to chyba nadal nie rozwizuje problemu?&lt;/p&gt;

&lt;p&gt;Ot贸偶 &lt;em&gt;nic bardziej mylnego&lt;/em&gt;. Taki zestaw okien mo偶na &lt;em&gt;odpi&lt;/em&gt; i rozczy si z SSH, a procesy w nim uruchomione nadal bd dziaa. Gdy sesja, w kt贸rej by uruchomiony screen zostanie zabita to screen si odczy. P贸藕niej mo偶na ponownie takiego screena podczy i kontynuowa prac.&lt;/p&gt;

&lt;p&gt;Najpierw instalacja, wprost z repozytorium odpowiedniego dla u偶ywanej dystrybucji.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;sudo apt-get install screen
sudo pacman -S screen
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Konfigurowa nie ma co - jedynym powodem do utworzenia pliku konfiguracyjnego jaki miaem bya ch zmiany domylnego skr贸tu klawiszowego - Ctrl+a - na co innego. Ale to byo zwizane z tym, 偶e zaczem u偶ywa tmuxa, jego domylny skr贸t mi nie pasowa (Ctrl+b), zmieniem go na ten, do kt贸rego byem przyzwyczajony w screenie wic screena te偶 trzeba byo zmieni, ale to rodzio kolejne problemy i przestaem tak grzeba.&lt;/p&gt;

&lt;p&gt;Teraz czas na uruchomienie. Po prostu wpisujemy&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;screen
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Czyli mamy Ctrl+a, polecenie kt贸re rozpoczyna waciwy skr贸t klawiszowy. Bo w kocu mamy r贸偶ne skr贸ty klawiszowe w r贸偶nych aplikacjach i chcielibymy m贸c z nich korzysta. O ile w vimie to nie problem, to ju偶 w emacsie u偶ywane s skr贸ty z ctrl, a nawet bash ma ich kilka. Dlatego screen u偶ywa takich skr贸t贸w &amp;ldquo;kolejkowanych&amp;rdquo;. Po wciniciu &lt;code&gt;ctrl+a&lt;/code&gt; dajemy waciwy skr贸t (np. &lt;code&gt;c&lt;/code&gt;). Screen przyjmie je w dw贸ch mo偶liwych wariantach i oba obsu偶y tak samo - czyli &lt;code&gt;ctrl+a c&lt;/code&gt; oraz &lt;code&gt;ctrl+a ctrl+c&lt;/code&gt; - chodzi o to, czy pucimy ctrl przed drugim klawiszem czy nie. Dla screena to bez r贸偶nicy.&lt;/p&gt;

&lt;p&gt;Najwa偶niejszym skr贸tem jest &lt;code&gt;ctrl+a d&lt;/code&gt; - jest to odpicie screena, czyli zostawiamy go dziaajcego i wychodzimy do punktu uruchomienia.&lt;/p&gt;

&lt;p&gt;Aby wr贸ci do odpitego screena wywoajmy&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;screen -r
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Je偶eli screen jest gdzie przypity, np. w drugim xtermie to nie pozwoli si przypi. Wywoanie screen bez parametr贸w utworzy za to drugiego screena. Wtedy ju偶 nawet gdy oba bd odpite to screen nie bdzie wiedzia do kt贸rego si podpi i wypisze list - wtedy nale偶y poda PID procesu do kt贸rego chcemy si podpi.&lt;/p&gt;

&lt;p&gt;Aby odpi screena podpitego w innym oknie (lub np. w wiszcej sesji ssh) wywoujemy &lt;code&gt;screen -d&lt;/code&gt;. A je偶eli chcemy od razu zakoczy te偶 proces z kt贸rego zosta uruchomiony screen, kt贸ry odpinamy (czyli np. zamkn tamto okno xterma lub rozczy poczenie SSH) to u偶ywamy &lt;code&gt;screen -D&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Przydatne mo偶e by te偶 &lt;code&gt;screen -R&lt;/code&gt;. Oznacza to, 偶e screen ma si podczy do istniejcej sesji. Je偶eli jest kilka to wypisze mo偶liwe do podczenia. Ale je偶eli nie znajdzie 偶adnej (偶adnej nie ma lub nie ma 偶adnej niepodczonej) to utworzy now. &lt;code&gt;screen -RR&lt;/code&gt; zadziaa podobnie, ale je偶eli znajdzie kilka niepodczonych sesji to podczy si do pierwszej z brzegu.&lt;/p&gt;

&lt;p&gt;Opcje &lt;code&gt;-r&lt;/code&gt;, &lt;code&gt;-R&lt;/code&gt; oraz &lt;code&gt;-RR&lt;/code&gt; mo偶na czy z &lt;code&gt;-d&lt;/code&gt; i z &lt;code&gt;-D&lt;/code&gt;. W takim wypadku uruchomienie &lt;code&gt;screen -D -RR&lt;/code&gt; jest &lt;em&gt;najpot偶niejsze&lt;/em&gt; - bo zawsze da jak sesj.&lt;/p&gt;

&lt;p&gt;Teraz wr贸my do dziaajcej sesji. Je偶eli zakoczymy proces w screenie (ctrl+d, exit, logout, &amp;hellip;) to zamkniemy okno w screenie. Je偶eli zamkniemy ostatnie okno to zamkniemy caego screena.&lt;/p&gt;

&lt;p&gt;Aby utworzy nowe okno wywoujemy &lt;code&gt;ctrl+a c&lt;/code&gt;. Pierwsze okno ma numer 0, nastpne 1 itd. Przeczanie pomidzy oknami osigniemy u偶ywajc &lt;code&gt;ctrl+a 0&lt;/code&gt;, &lt;code&gt;ctrl+a 1&lt;/code&gt; itd. lub &lt;code&gt;ctrl+a n&lt;/code&gt; i &lt;code&gt;ctrl+a p&lt;/code&gt;. Tak samo jak &lt;code&gt;n&lt;/code&gt; zadziaa &lt;code&gt;spacja&lt;/code&gt;, a w miejsce &lt;code&gt;p&lt;/code&gt; mo偶emy u偶y &lt;code&gt;backspace&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;U偶ycie &lt;code&gt;ctrl+a w&lt;/code&gt; poka偶e list dostpnych okien.&lt;/p&gt;

&lt;p&gt;Warto te偶 wiedzie jak zabi okno - czasem jaki proces si zawiesi. W xtermie po prostu zamykamy okno, w screenie jest do tego &lt;code&gt;ctrl+a k&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Tak na prawd to wszystko co potrzeba wiedzie na starcie. No mo偶e jeszcze &lt;code&gt;ctrl+a ?&lt;/code&gt;, kt贸re zwr贸ci przypisanie klawiszy. A, jeszcze - co je偶eli potrzebujemy u偶y &lt;code&gt;ctrl+a&lt;/code&gt; w aplikacji otwartej w screenie? u偶ywamy &lt;code&gt;ctrl+a a&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Z bardziej zaawansowanych rzeczy to zdarzyo mi si jeszcze korzysta z mo偶liwoci kopiowania w screenie przy u偶yciu klawiatury. Nie tyle do kopiowania ale do przewinicia ekranu w g贸r. Su偶y do tego &lt;code&gt;ctrl+a [&lt;/code&gt;, nastpnie przesuwamy ekran strzakami i wciskamy &lt;code&gt;enter&lt;/code&gt; aby rozpocz kopiowanie. Zaznaczamy obszar u偶ywajc zn贸w strzaek i wciskamy ponownie &lt;code&gt;enter&lt;/code&gt;. Teraz tekst jest skopiowany do schowka (ale screenowego, nie tego dostpnego przez np. xclip). do wklejenia su偶y &lt;code&gt;ctrl+a ]&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Innych funkcji chyba nie zdarzyo mi si u偶ywa, ale polecam mana do screena - jest chyba jednym z lepszych.&lt;/p&gt;

&lt;h2 id=&#34;przenoszenie-procesu-do-screena&#34;&gt;Przenoszenie procesu do screena&lt;/h2&gt;

&lt;p&gt;Teraz co troch trudniejszego - jak przenie dziaajcy proces do screena? Czasem okazuje si, 偶e jednak proces bdzie dziaa du偶ej. Jak to zrobi? Bdzie potrzebne dodatkowe narzdzie - &lt;code&gt;reptyr&lt;/code&gt;. Czyli&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;sudo apt-get install reptyr
sudo pacman -S reptyr
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;czy co tam macie u siebie. Teraz po kolei:&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;&lt;p&gt;Zatrzymujemy proces (nie koczymy!!!) &lt;code&gt;Ctrl+z&lt;/code&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Wznawiamy go w tle &lt;code&gt;bg&lt;/code&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Odpinamy go od terminala &lt;code&gt;disown %1&lt;/code&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Odpalamy screena &lt;code&gt;screen&lt;/code&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Znajdujemy PID procesu (pojawi si wczeniej na ekranie albo szukamy przy uzyciu ps, pstree, pgrep, czegokolwiek)&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Przypinamy proces do bie偶cego terminala &lt;code&gt;reptyr &amp;lt;pid&amp;gt;&lt;/code&gt;&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;Reptyr mo偶e nie zadziaa - poleci komunikat&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;Unable to attach to pid 52543: Operation not permitted
The kernel denied permission while attaching. If your uid matches
the target&#39;s, check the value of /proc/sys/kernel/yama/ptrace_scope.
For more information, see /etc/sysctl.d/10-ptrace.conf
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Generalnie to jest to zabezpieczenie, aby nie-root nie m贸g robi ptrace na procesach nie-potomnych. Aby wyczy to zabezpieczenie odpalamy&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;echo 0 | sudo tee /proc/sys/kernel/yama/ptrace_scope
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;co pozwoli na odpalenie reptyra, a po odpiciu screena mo偶emy przywr贸ci domylne ustawienie&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;echo 1 | sudo tee /proc/sys/kernel/yama/ptrace_scope
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Tym sposobem mamy proces przeniesiony do screena. Oczywicie atwiej jest proces normalnie uruchomi w screenie, ale czasem nie bardzo mo偶emy ubi proces i odpali go na nowo, wtedy trzeba si troch bardziej narobi&amp;hellip;&lt;/p&gt;

&lt;p&gt;Miego screenowania!&lt;/p&gt;
</description>
    </item>
    
    
    
    <item>
      <title>Programowanie kart inteligentnych - cz 2 - komunikacja</title>
      <link>https://kamm.github.io/2018/05/javacard-2/</link>
      <pubDate>Fri, 25 May 2018 08:54:15 CEST</pubDate>
      <author>Kamil Mtrak</author>
      <guid>https://kamm.github.io/2018/05/javacard-2/</guid>
      <description>&lt;p&gt;W poprzednim odcinku utworzyem bardzo prosty aplet na karcie i wywoaem go z poziomu gpshell. Jednak to jest dobre do test贸w. W kocu karta ma by wykorzystywana w kryptografii w konkretnej aplikacji.&lt;/p&gt;

&lt;p&gt;Stworzyem bardzo prostego klienta do apletu - &lt;a href=&#34;https://github.com/kamm/jcapp1client&#34;&gt;jcapp1client&lt;/a&gt;. Aplikacja czy si z pierwszy z brzegu czytnikiem, wybiera kart do niego wo偶on, wybiera aplet i wywouje instrukcj B0 01. Nawet bez 偶adnego sprawdzania bd贸w, kod贸w wyjcia, nic. Prociej si chyba nieda.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;public static void main( String[] args )
    {
        try {
            byte[] appletId = {(byte) 0xbb, (byte) 0xbb, (byte) 0xcc, (byte) 0xdd, (byte) 0xee, (byte) 0x01, (byte) 0x01};
            TerminalFactory factory = TerminalFactory.getDefault();
            CardTerminal terminal = factory.terminals().list().get(0);
            
            Card card = terminal.connect(&amp;quot;*&amp;quot;);
            CardChannel channel = card.getBasicChannel();

            CommandAPDU apdu = null;
            ResponseAPDU rapdu = null;
            apdu = new CommandAPDU(0x00, 0xA4, 0x04, 0x00, appletId);
            rapdu = channel.transmit(apdu);
            apdu = new CommandAPDU(0xB0, 0x01, 0x00, 0x00, 13);
            rapdu = channel.transmit(apdu);

            System.out.println(new String(rapdu.getData()));

            card.disconnect(false);
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Najpierw to uruchomiem pod windowsem. Dziaa od rki, 偶adnych zgrzyt贸w. No mo偶e poza sytuacj gdy miaem podczony drugi czytnik (jeden jest wbudowany w laptopa, drugi podczyem po USB). Wtedy lista zwracana przez factory.terminals().list() jest w kolejnoci raczej losowej.&lt;/p&gt;

&lt;p&gt;P贸藕niej spr贸bowaem to uruchomi pod linuksem. Wa偶ne - czytnik mi dziaa pod linuksem, go potwierdziem u偶ywaniem gpshell czy pcsc_scan. Jednak po uruchomieniu dostaem&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ java -cp target/jcappclient-1.0-SNAPSHOT.jar pl.kamm.jcapp1client.App
java.lang.IndexOutOfBoundsException: Index: 0
        at java.util.Collections$EmptyList.get(Collections.java:4454)
        at pl.kamm.jcapp1client.App.main(App.java:18)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Szukaem, szukaem i znalazem. Trzeba doda namiary na bibliotek libpcsclite&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ java -Dsun.security.smartcardio.library=/usr/lib/x86_64-linux-gnu/libpcsclite.so.1 -cp target/jcappclient-1.0-SNAPSHOT.jar pl.kamm.jcapp1client.App
Hello, world!
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;i zaczyna dziaa. Tyle na dzisiaj. Kr贸tko.&lt;/p&gt;
</description>
    </item>
    
    
    
    <item>
      <title>Programowanie kart inteligentnych - cz 1 - pierwszy program</title>
      <link>https://kamm.github.io/2018/05/javacard-1/</link>
      <pubDate>Wed, 23 May 2018 10:52:15 CEST</pubDate>
      <author>Kamil Mtrak</author>
      <guid>https://kamm.github.io/2018/05/javacard-1/</guid>
      <description>&lt;p&gt;Czas zacz programowa. Karty, kt贸re mnie intereuj i kt贸re zam贸wiem programuje si w Javie. S te偶 inne, chyba dotnetowe, ale si nie znam. Zajm si tylko kartami javoskimi, a dokadniej bd uzywa Java Card Kit w wersji 2.2.2. Do pobrania ze strony Oracla: &lt;a href=&#34;http://www.oracle.com/technetwork/java/embedded/javacard/downloads/javacard-sdk-2043229.html&#34;&gt;JavaCard SDK&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Programy wgrane na kart s apletami, ale nie ma to nic (poza nazw) zwizku z java.applet.Applet. Tu mamy javacard.framework.Applet. Generalnie - javacard jest mocno ograniczon jav. Nie ma longa, nie ma double&amp;rsquo;a, nie ma stringa. cznie javadoc do wersji 2.2.2 podaje, 偶e istniej 93 klasy, a w zasadzie to 60 klas i 33 interfejsy zdefiniowane w ramach biblioteki standardowej. Troch mao. Dodatkowo ogranicza nas maa pami karty i wymagania aby dziaao to mo偶liwie najszybciej. W efekcie programy wygldaj jak kod pisany dla mikrokontroler贸w 8 bitowych.&lt;/p&gt;

&lt;p&gt;Do napisania i skompilowania kodu apletu bdzie potrzeba:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Java Card Kit, wersja 2.2.2&lt;/li&gt;
&lt;li&gt;Java SDK (wersja praktycznie dowolna, dokadniej &amp;gt;= 1.3)&lt;/li&gt;
&lt;li&gt;Apache Ant - co prawda mozna by si pobawi z mavenem, ale to sztuka dla sztuki&lt;/li&gt;
&lt;li&gt;gpshell w cie偶ce uruchamiania (dla wygody)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Przyjrzyjmy si najprostszemu appletowi&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;package pl.kamm;

import javacard.framework.Applet;
import javacard.framework.APDU;
import javacard.framework.ISO7816;
import javacard.framework.ISOException;
import javacard.framework.Util;


public class HelloWorldApplet extends Applet {
    
    //Definicja klasy instrukcji
    protected static final byte CLA = (byte) 0xb0;

    //Definiacja identyfikatora instrukcji
    protected static final byte INS_HELLO = (byte) 0x01;

    //Obsuga instrukcji HELLO
    private void processHello(APDU apdu){
        byte buffer[] = apdu.getBuffer();

        //Sprawdzenie czy argumenty P1 i P2 s r贸wne 0x00
        if (Util.getShort(buffer, ISO7816.OFFSET_P1) != (short) 0x0000){ 
            ISOException.throwIt(ISO7816.SW_INCORRECT_P1P2);
        }

        // Zbudowanie tablicy bajt贸w &amp;quot;Hello, world!&amp;quot;
        byte [] b = {0x48, 0x65, 0x6c, 0x6c, 0x6f, 0x2c, 0x20, 0x77, 0x6f, 0x72, 0x6c, 0x64, 0x21};

        //Skopiowanie do bufora
        Util.arrayCopy(b,(byte)0,buffer,(byte)0,(byte)b.length); 

        //Wysanie bufora
        apdu.setOutgoingAndSend((short) 0, (short) b.length); 
    }

    public void process(APDU apdu) {
        //W przypadku operacji wybierania apletu nie r贸b nic
        if (selectingApplet()){
            return;
        }

        //Pobranie bufora danych
        byte buffer[] = apdu.getBuffer();

        //Obsugujemy tylko jedn, okrelon klas instrukcji
        if (buffer[ISO7816.OFFSET_CLA] != (CLA)){
            ISOException.throwIt(ISO7816.SW_CLA_NOT_SUPPORTED);
        }

        //Na podstawie identyfikatora instrukcji wywoujemy obsugujc j funkcj
        switch (buffer[ISO7816.OFFSET_INS]){ 
            case INS_HELLO:
                processHello(apdu);
                break;
            default:
                ISOException.throwIt(ISO7816.SW_INS_NOT_SUPPORTED);
                break;
        }
    }

    private HelloWorldApplet(byte bArray[], short bOffset, byte bLength) {
    }

    public static void install(byte bArray[], short bOffset, byte bLength) {
        HelloWorldApplet ai = new HelloWorldApplet(bArray, bOffset, bLength);

        if (bArray[bOffset] == 0) {
            ai.register();
        } else {
            ai.register(bArray, (short) (bOffset + 1), bArray[bOffset]);
        }
    }
}

&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Najwa偶niejsz funkcj appletu jest metoda process. Zajmuje si ona obsug komendy APDU wysanej z terminala. W tym wypadku jest obsugiwana jedna komenda APDU - o klasie 0xb0 i identyfikatorze instrukcji 0x01. Ta instrukcja wymaga jako parametr贸w P1 i P2 wartoci 0x00 (s one wartociami jednobajtowymi, ale sprawdzenie odbywa si poprzez sprawdzenie wartoci dwubajtowej, zawierajcej zar贸wno P1 jak i P2). Nie potrzebuje ona dodatkowych danych, ale nie jest to sprawdzane - s one ignorowane. Po wywoaniu prawidowym zachowanie jest zwr贸cenie tablicy bajt贸w, kt贸re w reprezentacji ASCII daj &amp;ldquo;Hello, world!&amp;rdquo;.&lt;/p&gt;

&lt;p&gt;Teraz trzeba to skompilowa. Kompilacja jest cakiem normalna, trzeba tylko pamita o dodaniu jar贸w z JavaCard Kit (javacardframework.jar, api.jar).&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;  &amp;lt;path id=&amp;quot;classpath.jcapi&amp;quot;&amp;gt;
    &amp;lt;pathelement location=&amp;quot;${env.JC_HOME}/api_export_files&amp;quot; /&amp;gt;
    &amp;lt;pathelement location=&amp;quot;${env.JC_HOME}/lib/javacardframework.jar&amp;quot; /&amp;gt;
    &amp;lt;pathelement location=&amp;quot;${env.JC_HOME}/lib/api.jar&amp;quot; /&amp;gt;
  &amp;lt;/path&amp;gt;
....
    &amp;lt;javac srcdir=&amp;quot;${src.dir}&amp;quot;
      destdir=&amp;quot;${build.dir}/bin&amp;quot;
      debug=&amp;quot;true&amp;quot;
      optimize=&amp;quot;true&amp;quot;
      includeantruntime=&amp;quot;false&amp;quot;
      target=&amp;quot;1.1&amp;quot;
      source=&amp;quot;1.3&amp;quot;&amp;gt;
      &amp;lt;classpath&amp;gt;
        &amp;lt;pathelement path=&amp;quot;${build.dir}/bin&amp;quot;/&amp;gt;
      &amp;lt;/classpath&amp;gt;
      &amp;lt;classpath refid=&amp;quot;classpath.jcapi&amp;quot; /&amp;gt;
    &amp;lt;/javac&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Nastpnie trzeba przekonwertowa pliki class do archiwum cap. cap jest zipem, podobnie do jara i ma podobn struktur, ale przechowuje pliki przetworzone (nota bene te偶 z rozszerzeniem cap, kt贸re ju偶 zipami nie s). S to przetworzone pliki class. Taki plik juz mo偶na wgra na kart przy uzyciu np gpshell.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;  &amp;lt;path id=&amp;quot;classpath.jctools&amp;quot;&amp;gt;
    &amp;lt;pathelement location=&amp;quot;${env.JC_HOME}/lib/converter.jar&amp;quot; /&amp;gt;
    &amp;lt;pathelement location=&amp;quot;${env.JC_HOME}/lib/offcardverifier.jar&amp;quot; /&amp;gt;
    &amp;lt;pathelement location=&amp;quot;${env.JC_HOME}/lib/scriptgen.jar&amp;quot; /&amp;gt;
    &amp;lt;pathelement location=&amp;quot;${env.JC_HOME}/lib/apdutool.jar&amp;quot; /&amp;gt;
    &amp;lt;pathelement location=&amp;quot;${env.JC_HOME}/lib/apduio.jar&amp;quot; /&amp;gt;
    &amp;lt;pathelement location=&amp;quot;${env.JC_HOME}/lib/tools.jar&amp;quot; /&amp;gt; &amp;lt;!-- 3.0 --&amp;gt;
  &amp;lt;/path&amp;gt;
....
    &amp;lt;java classname=&amp;quot;com.sun.javacard.converter.Converter&amp;quot; fork=&amp;quot;true&amp;quot; failonerror=&amp;quot;true&amp;quot;&amp;gt;
      &amp;lt;classpath refid=&amp;quot;classpath.jcapi&amp;quot; /&amp;gt;
      &amp;lt;classpath refid=&amp;quot;classpath.jctools&amp;quot; /&amp;gt;
      &amp;lt;arg value=&amp;quot;-verbose&amp;quot; /&amp;gt;
      &amp;lt;arg value=&amp;quot;-classdir&amp;quot; /&amp;gt;
      &amp;lt;arg value=&amp;quot;${build.dir}/bin/&amp;quot; /&amp;gt;
      &amp;lt;arg value=&amp;quot;-out&amp;quot; /&amp;gt;
      &amp;lt;arg value=&amp;quot;JCA&amp;quot; /&amp;gt;
      &amp;lt;arg value=&amp;quot;CAP&amp;quot; /&amp;gt;
      &amp;lt;arg value=&amp;quot;EXP&amp;quot; /&amp;gt;
      &amp;lt;arg value=&amp;quot;-applet&amp;quot; /&amp;gt;
      &amp;lt;arg value=&amp;quot;${javacard.applet.aid}&amp;quot; /&amp;gt;
      &amp;lt;arg value=&amp;quot;${javacard.applet.name}&amp;quot; /&amp;gt;
      &amp;lt;arg value=&amp;quot;${javacard.package.name}&amp;quot; /&amp;gt;
      &amp;lt;arg value=&amp;quot;${javacard.package.aid}&amp;quot; /&amp;gt;
      &amp;lt;arg value=&amp;quot;${javacard.major.version}.${javacard.minor.version}&amp;quot; /&amp;gt;
    &amp;lt;/java&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Aby uatwi sobie robot mam utworzony skrypt w ancie, kt贸ry odwala kompilacj, konwersj, wygenerowanie skrypt贸w wgrywajcych czy te偶 samo wgranie na kart lub do emulatora (o emulatorze kiedy indziej).&lt;/p&gt;

&lt;p&gt;Aby wrzuci plik cap na kart nale偶y wyda kilka pojece. Jak kilka to najlepiej opakowa to w skrypt, np taki&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;# gpshell script for jcop 2.4.1 applet load (default keys)
mode_211
enable_trace
establish_context
card_connect
select -AID A0000000030000
open_sc -security 1 -mac_key 404142434445464748494a4b4c4d4e4f -enc_key 404142434445464748494a4b4c4d4e4f
delete -AID bbbbccddee0101
delete -AID bbbbccddee01
install -file jcapp_1.cap -instParam 31323334 -sdAID a000000003000000 -priv 2
card_disconnect
card_connect
select -AID bbbbccddee0101
card_disconnect
release_context 
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Kilka uwag - klucz do makowania i szysforwania (404142434445464748494a4b4c4d4e4f) zosta dla karty ustalony podczas inicjalizacji. Najpierw wybieramy aplet JCOS (JavaCardOparatingSystem), czyli A0000000030000. Kasujemy stary applet (bbbbccddee01) i jego instancj (bbbbccddee0101). Nastpnie instalujemy plik jcapp_1.cap. Po rozczeniu i ponownym poczeniu wybieramy ten aplet aby go uruchomi.&lt;/p&gt;

&lt;p&gt;No dobra, ale czy to dziaa? Aby to sprawdzi potrzebujemy kolejnego skryptu gpsh.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;mode_211
enable_trace
establish_context
card_connect

#Wybranie apletu
#send_apdu -sc 0 -APDU 00A4040007bbbbccddee010100
select -AID bbbbccddee0101

#Wysanie komendy CLA=B0, INS=01, P1=00, P2=00, brak danych, spodziewamy si 13 bajt贸w
send_apdu -sc 0 -APDU B00100000D

card_disconnect
release_context
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;W tym skrypcie wybieramy aplet (zakomentowany jest drugi spos贸b) a nastpnie wywoujemy instrukcj CLA=B0, INS=01.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;mode_211
enable_trace
establish_context
card_connect
select -AID bbbbccddee0101
Command --&amp;gt; 00A4040007BBBBCCDDEE0101
Wrapped command --&amp;gt; 00A4040007BBBBCCDDEE0101
Response &amp;lt;-- 9000
send_apdu -sc 0 -APDU B00100000D
Command --&amp;gt; B00100000D
Wrapped command --&amp;gt; B00100000D
Response &amp;lt;-- 48656C6C6F2C20776F726C64219000
send_APDU() returns 0x80209000 (9000: Success. No error.)
card_disconnect
release_context
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Domylnie gpshell ma wczone echo wic wszystkie polecenia s widoczne. Najwa偶niejsza linia to&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;Response &amp;lt;-- 48656C6C6F2C20776F726C64219000
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Jest to zwrotna warto APDU. Ta akurat ma 15 bajt贸w. Pierwsze 13 to &amp;ldquo;Hello, world!&amp;rdquo; z karty. Nastpnie s dwa bajty kodu bdu. s to 90 00, co w przypadku kart oznacz brak bdu. Fajnie, dziaa.&lt;/p&gt;

&lt;p&gt;W nastpnych czciach napisz may program kliencki w javie oraz om贸wi APDU.&lt;/p&gt;

&lt;p&gt;Cay projekt dostpny na github &lt;a href=&#34;http://github.com/kamm/jcapp_1&#34;&gt;http://github.com/kamm/jcapp_1&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
    
    
    <item>
      <title>Programowanie kart inteligentnych - cz 0 - inicjalizacja</title>
      <link>https://kamm.github.io/2018/05/javacard-0/</link>
      <pubDate>Tue, 22 May 2018 11:02:15 &#43;0100</pubDate>
      <author>Kamil Mtrak</author>
      <guid>https://kamm.github.io/2018/05/javacard-0/</guid>
      <description>&lt;p&gt;Zaczynam nauk programowania kart inteligentnych. S to karty do przechowywania kluczy kryptograficznych, certyfikat贸w a tak偶e innych danych. Do tego celu potrzebowaem zam贸wi kilka takich kart.&lt;/p&gt;

&lt;p&gt;&lt;/p&gt;

&lt;p&gt;Po wpisaniu na aliexpress J2A040 znajdziemy ich wiele i w ka偶dym ogloszeniu jest co w stylu&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;We can only provide the TK default value (Transport key) ,like: .
Before you use JCOP Card,you need 2 commands for opening the JCOP21-40K card.
here is :
APDU:00A4040010( TK - KEY )
APDU:00F00000 ( open for Initialize )
If you dont know how to use it ,please dont order it! Otherwise, we will not be responsible for the return.
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Dobra, rozumiem, 偶e tak si zabezpieczaj przed osobami, kt贸re myl, 偶e to od razu bedzie dziaa &amp;ldquo;automagicznie&amp;rdquo;. Nie ma tak atwo.&lt;/p&gt;

&lt;p&gt;Po pierwsze karta jest zabezpieczona kluczem transportowym. Jest on na doczonej pycie CD. Fajnie, chocia偶 poprawnie to klucz transportowy (dalej bd go po prostu nazywa TK) powinien by wysany innym kanaem (np. mailem), ale mniejsza z tym - kart nie bd u偶ywa produkcyjnie, a bardziej do cel贸w deweloperskich i testowych.&lt;/p&gt;

&lt;p&gt;Po drugie karta jest niezainicjalizowana - chocia偶 tego nie jestem pewien, bo przedtawiaa si jako Nigerian ID. Mniejsza z tym - kasujemy wszystko.&lt;/p&gt;

&lt;p&gt;Do zabawy potrzebne s:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;czytnik kart - to akurat wiadome&lt;/li&gt;
&lt;li&gt;narzdzie gpshell &lt;a href=&#34;https://sourceforge.net/projects/globalplatform/&#34;&gt;https://sourceforge.net/projects/globalplatform/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Peny skrypt do inicjalizacji:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;mode_211
enable_trace
establish_context
card_connect

#Oblokowanie z klucza transportowego
send_apdu -sc 0 -APDU 00A4040010&amp;lt;TK&amp;gt;

#Wyczyszczenie karty
send_apdu -sc 0 -APDU 00F00000

#Ustawienie protokou transmisji T=1
send_apdu -sc 0 -APDU C0D6012301DA
send_apdu -sc 0 -APDU C0D6014601DA
send_apdu -sc 0 -APDU C0D6012201FE
send_apdu -sc 0 -APDU C0D60124010F
send_apdu -sc 0 -APDU C0D60147010F

#Ustawienie ATR jako J 2 A 0 8 1 , T = 1
send_apdu -sc 0 -APDU c0d601370b0a4a32413038312C543D31
send_apdu -sc 0 -APDU c0d6015A0b0a4a32413038312C543D31

#Ustawienie klucza zarzdczego na domyln warto 404142434445464748494a4b4c4d4e4f (tylko na potrzebny testowe/deweloperskie)
send_apdu -sc 0 -APDU c0d6030510404142434445464748494a4b4c4d4e4f
send_apdu -sc 0 -APDU c0d6032110404142434445464748494a4b4c4d4e4f
send_apdu -sc 0 -APDU c0d6033D10404142434445464748494a4b4c4d4e4f
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Zapisujemy plik jako initialize.gpsh i uruchamiamy&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;gpshell initialize.gpsh
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Teraz mo偶na zacz si bawi. Taka karta nie zostanie zablokowana - zawsze mo偶na wsyztsko skasowa i wgra ponownie.&lt;/p&gt;

&lt;p&gt;Na podstawie &lt;a href=&#34;https://www.curriegrad2004.ca/2017/02/dealing-with-unfused-jcop-java-cards-sold-from-aliexpress-or-ebay/&#34;&gt;https://www.curriegrad2004.ca/2017/02/dealing-with-unfused-jcop-java-cards-sold-from-aliexpress-or-ebay/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;W nastpnym wpisie bdzie prosty aplet na kart, a p贸藕niej troch kodu w &amp;ldquo;normalnej&amp;rdquo; javie - czyli komunikacja z apletem.&lt;/p&gt;</description>
    </item>
    
    
    
    <item>
      <title>ack</title>
      <link>https://kamm.github.io/2016/12/ack/</link>
      <pubDate>Tue, 27 Dec 2016 21:10:15 CET</pubDate>
      <author>Kamil Mtrak</author>
      <guid>https://kamm.github.io/2016/12/ack/</guid>
      <description>&lt;p&gt;Przeszukiwanie kodu z konsoli jest problemem. Ja najczciej u偶ywaem dziwnej skadni&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;find . -type f | while read l; do grep -Ri &amp;quot;System.err&amp;quot; $l &amp;amp;&amp;amp; echo $l; done
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Dziaa dziaa, ale jest nieeleganckie, nieefektywne, ma brzydkie wyjcie, du偶o bdnych wystpie (pliki binarne, pliki gita/svna). Sowem - szybki hack.&lt;/p&gt;

&lt;p&gt;Ze wzgldu na moje lenistwo nie chciao mi si szuka niczego innego, a okazao si 偶e byo warto. O acku dowiedziaem si z prezentacji babuna.&lt;/p&gt;

&lt;p&gt;Teraz kilka kr贸tkich informacji:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;pomija pliki niebdce kodem (jak np. pliki gita czy svna)&lt;/li&gt;
&lt;li&gt;jest szybki&lt;/li&gt;
&lt;li&gt;jest nastawiony na przeszukiwanie kodu - ale nie &amp;ldquo;promuje&amp;rdquo; 偶adnego jzyka&lt;/li&gt;
&lt;li&gt;jest przenony - napisany w perlu, ja go uzywam na linuksie i widzie i nie mam problemu&lt;/li&gt;
&lt;li&gt;uatwia przeszukiwanie tylko okrelonych zasob贸w - tu mo偶e kilka s贸w wicej.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Generalnie - rzadko kiedy mamy projekt robiony tylko u偶ywajc jednej technologii. Do projektu javowego dodany SQL czy te偶 moje najczstsze poczenie ostatnimi czasy czyli xsl + xsl. Do tego wystarczy doda prarametr&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;ack --java System.err
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Co takiego znajdzie wystpienia System.err w plikach java, ale ju偶 pliki tekstowe odrzuci.&lt;/p&gt;

&lt;p&gt;W razie czego - wiem 偶e istnieje silver searcher (ag), ale jeszcze nie miaem czasu go sprawdzi :)&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://beyondgrep.com/&#34;&gt;http://beyondgrep.com/&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
    
    
    <item>
      <title>Babun - windowsowy shell w kt贸rym si zakochasz</title>
      <link>https://kamm.github.io/2016/11/babun-shell-w-ktorym-sie-zakochasz/</link>
      <pubDate>Tue, 29 Nov 2016 19:30:51 CET</pubDate>
      <author>Kamil Mtrak</author>
      <guid>https://kamm.github.io/2016/11/babun-shell-w-ktorym-sie-zakochasz/</guid>
      <description>&lt;p&gt;Shell jest narzdziem potrzebnym w pracy chyba ka偶demu programicie. Oczywicie, wiele IDE ju偶 pr贸bowao zmieni to podejcie integrujc narzdzia do postaci klikanych rozwiza, integracji gita czy mavena do edytora, ale nadal stary, poczciwy shell ma si dobrze. Jednak pojawia si pewne &amp;ldquo;ale&amp;rdquo;. U偶ywanie w windowsie cmd jest problematyczne - kopiowanie i wklejanie jest bardzo utrudnione, zaznaczenie tekstu jeszcze bardziej a obsuga historii wywoa jest na szcztkowym poziomie. Podobno powershell wiele z tych rzeczy rozwizuje, ale i tak - unixowy shell jest tym, co programici lubi.&lt;/p&gt;

&lt;p&gt;Od czasu mojego powrotu do wiata windowsa mino ju偶 11 lat - wczsniej przez kilka lat u偶ywaem tylko linuksa. Miaem epizod na macu, ale to inna sprawa. Pocztkowo u偶ywaem kilku narzdzi przeniesionych do wita windowsowego, czyli miaem ls, wget i takie tam pod windowsem. P贸藕niej odkryem cygwina. Byo lepiej, ale nadal ogranicza mnie sam emulator terminala - bo w kocu miaem wszystkie narzdzia, ale samo okienko byo nadal toporne. U偶ywaem przez pewien czas console2, a偶 trafiem na puttycyg, czyli fork putty&amp;rsquo;iego, ale z mo偶liwoci dziaania jako emulator terminala do cygwina. Niestety, projekt przesta by rozwijany, ale i tak u偶ywaem go przez kilka lat.&lt;/p&gt;

&lt;p&gt;Ostatnio trafiem w firmie na szkolenie. Jednym z element贸w by git. To co prawda znam (mo偶e nei rewelacyjnie, ale i tak poziom by podstawowy) i u偶ywam, ale byo kilka os贸b &amp;ldquo;wie偶ych&amp;rdquo;. Potrzeboway one zainstalowa sibie gita na windowsie. Prowadzcy poleci babuna. Sam te偶 si nim zainteresowaem i po instalacji zakochaem si w nim. Ale po kolei.&lt;/p&gt;

&lt;p&gt;Czym jest babun? Jest to cygwin instalowany w katalogu u偶ytkownika (nie wymaga nawet uprawnie administracyjnych) z mas dodatk贸w. Przychodzi domylnie z zainstalowan ju偶 du偶 liczb pakiet贸w, jak chocia偶by git, wget, curl. Z domylnie zainstalowanym zsh razem z oh-my-zsh. Z mened偶erem pakiet贸w obsugiwanym z wiersza polece. Kr贸tko m贸wic jest to cygwin na sterydach.&lt;/p&gt;

&lt;p&gt;Najlepiej obejrze sobie filmy&lt;/p&gt;

&lt;p&gt;
&lt;div style=&#34;position: relative; padding-bottom: 56.25%; padding-top: 30px; height: 0; overflow: hidden;&#34;&gt;
  &lt;iframe src=&#34;//player.vimeo.com/video/95045348&#34; style=&#34;position: absolute; top: 0; left: 0; width: 100%; height: 100%;&#34; webkitallowfullscreen mozallowfullscreen allowfullscreen&gt;&lt;/iframe&gt;
 &lt;/div&gt;


&lt;div style=&#34;position: relative; padding-bottom: 56.25%; padding-top: 30px; height: 0; overflow: hidden;&#34;&gt;
  &lt;iframe src=&#34;//www.youtube.com/embed/5YbE07aDDDc&#34; style=&#34;position: absolute; top: 0; left: 0; width: 100%; height: 100%;&#34; allowfullscreen frameborder=&#34;0&#34; title=&#34;YouTube Video&#34;&gt;&lt;/iframe&gt;
 &lt;/div&gt;
&lt;/p&gt;

&lt;p&gt;Jeszcze jedna sprawa - Projekt jest stworzony przez polak贸w, co przynajmniej dla mnie jest jego kolejnym plusem :)&lt;/p&gt;
</description>
    </item>
    
    
    
    
    
    <item>
      <title>Deweloperski Datapower</title>
      <link>https://kamm.github.io/2016/11/deweloperski-datapower/</link>
      <pubDate>Wed, 23 Nov 2016 22:35:52 CET</pubDate>
      <author>Kamil Mtrak</author>
      <guid>https://kamm.github.io/2016/11/deweloperski-datapower/</guid>
      <description>&lt;p&gt;Datapower to XML Appliance. Zreszt mniejsza z tym co to jest, bo sam pewnie nie ogarniam wszystkich jego zastosowa i mo偶liwoci. Z mojej strony jest wykorzystywany jako rodowisko do tworzenia wydajnych usug w oparciu o XSLT. Wszystko fajnie, ale pozostaje kwestia uruchomienia. Na maszynie fizycznej? Marnie - tam jest m. in. produkcja i nikt mi nie pozwoli robi tam developmentu. Na maszynie wirtualnej - spoko, mamy jedn sztuk licencji na wirtualk. Ale - ju偶 par razy miaem problem z innymi osobami. A to kto zmieni mi w czasie test贸w datasource&amp;rsquo;a, a to kto wywali port http.&lt;/p&gt;

&lt;p&gt;Ze wzgldu na licencj nie mogem sobie postawi lokalnego DP na lapku. A nawet gdybym postawi - to maszyna wirtualna startowaa kilka minut, zajmowaa sporo ramu i nie mo偶na na niej byo zrobi i tak nic innego.&lt;/p&gt;

&lt;p&gt;I tak si mczyem a偶 poszedem na szkolenie :) Szkolenie byo nt. devops - co to jest, z czym to si je, jakie s u偶ywane narzdzia itp. Jednym z pokazanych narzdzi by docker. Nie rozumiaem jak on dziaa i generalnie nie miaem do niego przekonania - jestem zawsze sceptycznie nastawiony do &amp;ldquo;nowinek&amp;rdquo;. W pewnej chwili kumpel wpisa sobie w konsoli&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ docker search datapower
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;i pojawia si lista.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;NAME                              DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED
ibmcom/datapower                  IBM DataPower Gateway                           36
ramakrishnasanku/datapower_demo                                                   1
garytu/datapower                  Enable WebGUI for ibmcom/datapower              0
patrocinio/datapower                                                              0

&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Nie do koca rozumiaem co to ma by. Po chwili zostaem wyrwany ze szkolenia i musiaem co z kim pogada. Trafiem do nowych architekt贸w i tam dziewczyna mi pokazuje odpalonego u siebie datapowera. Z dockera. Zebraem szczk z podogi, wr贸cim na szkolenie, tym razem dajc dockerowi szans. Wszystko piknie - jest ostpny na dockerze obraz zawierajcy datapowera. Najnowsz wersj - nowsz ni偶 aktualnie mamy na produkcji.&lt;/p&gt;

&lt;p&gt;Pierwszy raz od lat przeczytaem licencj - obraz jest typowo do zastosowa deweloperskich i test贸w jednostkowych - czyli wszystko co mi jest potrzebne.&lt;/p&gt;

&lt;p&gt;Oczywicie, jako 偶e pracuj na window$ie to docker mi nie zadziaa bezporednio - musz mie wirtualk z linuksem - jednak w takim rozwizaniu ejst to znacznie l偶ejsze ni偶 wirtualny DP. Nie jest to ju偶 wirtualka tylko na DP, ale te偶 na wszystko co wymaga linuksa, a nie wystarcza tu cygwin.&lt;/p&gt;

&lt;p&gt;Tak偶e jest to dosy prosta i szybka opcja na postawienie sobie deweloperskiego datapowera na kt贸rym mo偶na sobie psu do woli. Na dodatek nie mog popsu za du偶o - w kocu gdy co za bardzo napsuj to po prostu stawiam obraz od nowa. Z wirtualnymi jest troch wicej zabawy i z reguy wpywa to na innych dew贸w, a wrcz dotyka admina rodowiska dev. Na fizycznych to boj si myle - podobno by ju偶 przypadek, 偶e jeden go tak napsu, 偶e trzeba byo wzywa serwis z IBMa. Zatem bezpieczniej mie swoje rodowisko u siebie :)&lt;/p&gt;
</description>
    </item>
    
    
    
    <item>
      <title>Zaczynamy</title>
      <link>https://kamm.github.io/2016/11/zaczynamy/</link>
      <pubDate>Wed, 23 Nov 2016 21:06:00 UTC</pubDate>
      <author>Kamil Mtrak</author>
      <guid>https://kamm.github.io/2016/11/zaczynamy/</guid>
      <description>&lt;p&gt;A w zasadzie to ponownie zaczynam. Postanowiem ponownie utworzy tego bloga i zacz wreszcie co pisa. Brakowao mi miejsca gdzie m贸gbym co napisa, a miaem co wic tak wyszo. Bd stara si pisa technicznie, ale nie mog tego zagwarantowa - czasem mo偶e wyj co z 偶ycia innego ni偶 tylko kodowanie :)&lt;/p&gt;
</description>
    </item>
    
    
    
    
    
    
  </channel>
</rss>