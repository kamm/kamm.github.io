<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
      <title>kamm</title>
      <generator uri="https://hugo.spf13.com">Hugo</generator>
    <link>https://kamm.github.io/</link>
    <language>en-us</language>
    <author>Kamil MÄ™trak</author>
    <copyright>2023 Kamil MÄ™trak</copyright>
    <updated>Mon, 22 May 2023 21:10:15 &#43;0100</updated>
    
    
    <item>
      <title>Instalacja klastra OKD/Openshift </title>
      <link>https://kamm.github.io/2023/05/okd/</link>
      <pubDate>Mon, 22 May 2023 21:10:15 &#43;0100</pubDate>
      <author>Kamil MÄ™trak</author>
      <guid>https://kamm.github.io/2023/05/okd/</guid>
      <description>

&lt;h2 id=&#34;wstÄ™p&#34;&gt;WstÄ™p&lt;/h2&gt;

&lt;p&gt;Do nauki OpenShifta potrzebowaÅ‚em jakiejÅ› instacji deweloperskiej &amp;ldquo;do psucia&amp;rdquo;. GÅ‚owne zaÅ‚oÅ¼enia - wsyztko musi byÄ‡ na maszynach wirtualnych, do uruchomienia na VirtualBoksie lub VMWare Workstation. Klaster ma skÅ‚adaÄ‡ siÄ™ z 3 wezÅ‚Ã³w typu Control Plane (w dalszej czÄ™Å›ci bÄ™dÄ™ je nazywaÅ‚ master), ktÃ³re teÅ¼ obsÅ‚uguja ruch aplikacyjny - czyli nie ma osobnych Compute Node. Takie rozwiÄ…zanie bÄ™dzie odzwierciedlaÅ‚o klaster OpenShifta, na ktÃ³rym pracujÄ™ w firmie, ale ten mogÄ™ Å‚atwiej psuÄ‡. Poza klasterem bedzie postawiona 1 dodatkowa maszyna - okd-bastion. Poza typowymi dla bastiona funkcjami (dostÄ™p do klastra przez oc/kubectl) bÄ™dzie teÅ¼ routerem, firewallem, serwerem DHCP, DNS, HTTP (potrzebne tylko na etapie instalacji w celu dostarczenia plikÃ³w konfiguracyjnych instalatora), HAProxy oraz NFS dla storage&amp;rsquo;u klastra - w skrÃ³cie maszynÄ… do wszystkiego poza OKD.&lt;/p&gt;

&lt;p&gt;Jeszcze tak na szybko - co to jest OKD? OKD to &amp;ldquo;The Community Distribution of Kubernetes that powersRed Hat OpenShift&amp;rdquo; - czyli w zasadzie darmowa wersja OpenShifta, ktÃ³ra ma kilka ograniczeÅ„, ale w wiekszoÅ›ci sÄ… to braki oficjalnych i certyfikowanych operatorÃ³w, dostarczanych w ramach OpenShifta. Co ciekawe - dotarÅ‚y do mnie sÅ‚uchy o przynajmniej jednej firmie, ktÃ³ra migruje siÄ™ lub luÅ¼ siÄ™ przemigrowaÅ‚a z OpenShifta na OKD w swoich Å›rodowiskach produkcyjnych.&lt;/p&gt;

&lt;h2 id=&#34;postawienie-maszyn-wirtualnych&#34;&gt;Postawienie maszyn wirtualnych&lt;/h2&gt;

&lt;p&gt;BÄ™dÄ™ uzywaÅ‚ VMWare Workstation, ale da siÄ™ to wszystko zrobiÄ‡ np. na VirtualBoksie. Zaczynamy od wykreowania sieci - uruchamiam Virtual Network Editor i dodajÄ™ nowÄ… sieÄ‡ (VMnet10) typu Host-only, IP podsieci 192.168.64.0, maska 255.255.255.0. WaÅ¼ne - wyÅ‚Ä…czam DHCP dla tej sieci (bÄ™dziemy stawiaÄ‡ wÅ‚asne DHCP). DHCP ze strony VMWare Workstation nie ma moÅ¼liwoÅ›ci przypisania trwaÅ‚ych IP dla MAC Adresu.&lt;/p&gt;

&lt;p&gt;NastÄ™pnie tworzÄ™ 5 maszyn wirtualnych:
* okd-bastion
* okd-bootstrap
* okd-master01
* okd-master02
* okd-master03
KaÅ¼da z nich ma 4 rdzenie, 8192 MiB RAM i 120GiB dysku. Ewentualnie, dla maszyny okd-bastion moÅ¼na daÄ‡ wiÄ™cej (a nawet sporo wiÄ™cej) dysku, bo bÄ™dzie potrzebny dla NFSa. Ja dodaÅ‚em drugi dysk (500GiB) pÃ³Åºniej.&lt;/p&gt;

&lt;p&gt;Dla okd-bastion dodaÅ‚em 2 interfejsy sieciowe - pierwszy jako bridged network, drugi jako host-only ze wskazaniem sieci na VMnet10.&lt;/p&gt;

&lt;p&gt;Na maszynach bootrap i masterach naleÅ¼y podmontowaÄ‡ iso Fedora CoreOS &lt;a href=&#34;https://builds.coreos.fedoraproject.org/prod/streams/stable/builds/38.20230430.3.1/x86_64/fedora-coreos-38.20230430.3.1-live.x86_64.iso&#34;&gt;https://builds.coreos.fedoraproject.org/prod/streams/stable/builds/38.20230430.3.1/x86_64/fedora-coreos-38.20230430.3.1-live.x86_64.iso&lt;/a&gt; - ja odpaliÅ‚em maszyny i wciÅ›nÄ…Å‚em TAB na etapie boot loadera - aby system nie startowaÅ‚, ale maszyna aby byÅ‚a uruchomiona - bo potrzebujÄ™ pobraÄ‡ ich MAC adresy, a te w VMWare sÄ… losowane po uruchomieniu.&lt;/p&gt;

&lt;h2 id=&#34;maszyna-okd-bastion&#34;&gt;Maszyna okd-bastion&lt;/h2&gt;

&lt;p&gt;Teraz okd-bastion. ZainstalowaÅ‚em na niej Oracle Linux 9.2, ale moÅ¼e byÄ‡ w zasadzie dowolny linux. Bez Å¼adnych dziwactw, moÅ¼e poza tym, Å¼e daÅ‚em caÅ‚oÅ›Ä‡ na 1 FS (czyli dysk podmontowany jako /, bez osobnych dla /home itp).&lt;/p&gt;

&lt;p&gt;Po instalacji naleÅ¼y doinstalowaÄ‡ kilka pakietÃ³w:
- epel-release
- bind
- bind-utils
- haproxy
- dhcp-server
- httpd nfs-utils
- git&lt;/p&gt;

&lt;p&gt;Dodatkowo warto zainstalowaÄ‡ jq&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;wget -O jq https://github.com/stedolan/jq/releases/download/jq-1.6/jq-linux64
chmod +x jq
sudo mv jq /usr/local/bin/
jq --version
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;konfiguracja-firewalla&#34;&gt;Konfiguracja firewalla&lt;/h3&gt;

&lt;p&gt;U mnie interfejs zewnÄ™trzny bastiona to enp160, ktÃ³ry ma adres IP nadawany dynamicznie przez mÃ³j router. Drugim interfejsem jest enp192, ktÃ³ry ma podany adres statyczny 192.168.64.1.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;nmcli c mod ens192 connection.zone internal
nmcli c mod ens160 connection.zone external
firewall-cmd --permanent --zone=external --add-masquerade
firewall-cmd --permanent --zone=internal --add-masquerade
firewall-cmd --permanent --direct --add-rule ipv4 nat POSTROUTING 0 -o enp160 -j MASQUERADE
firewall-cmd --permanent --direct --add-rule ipv4 filter FORWARD 0 -i enp192 -o enp160 -j ACCEPT
firewall-cmd --permanent --direct --add-rule ipv4 filter FORWARD 0 -i enp160 -o enp192 -m state --state RELATED,ESTABLISHED -j ACCEPT
firewall-cmd --permanent --zone=external --add-port=9000/tcp
firewall-cmd --permanent --zone=external --add-port=80/tcp
firewall-cmd --permanent --zone=external --add-port=443/tcp
firewall-cmd --permanent --zone=trusted --add-source=192.168.64.0/24
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;konfiguracja-dhcp&#34;&gt;Konfiguracja DHCP&lt;/h3&gt;

&lt;p&gt;/etc/dhcp/dhcpd.conf - tu trzeba wstawiÄ‡ wÅ‚asne MAC adresy dla bootstrapa i masterÃ³w.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;authoritative;
ddns-update-style interim;
default-lease-time 14400;
max-lease-time 14400;

option routers                  192.168.64.1;
option broadcast-address        192.168.64.255;
option subnet-mask              255.255.255.0;
option domain-name-servers      192.168.64.1;
option domain-search            &amp;quot;okd.lab.local&amp;quot;;
option domain-name-servers      192.168.64.1;
option domain-name              &amp;quot;okd.lab.local&amp;quot;;

subnet 192.168.64.0 netmask 255.255.255.0 {
  interface ens192;
  pool {
    range 192.168.64.21 192.168.64.60;
    # Static entries
    host okd-bootstrap { hardware ethernet 00:0C:29:D5:20:56; fixed-address 192.168.64.200; option host-name &amp;quot;okd-bootstrap&amp;quot;;}
    host master01 { hardware ethernet 00:0C:29:08:EB:27; fixed-address 192.168.64.201; option host-name &amp;quot;okd-master01&amp;quot;;}
    host master02 { hardware ethernet 00:0C:29:C0:B8:B3; fixed-address 192.168.64.202; option host-name &amp;quot;okd-master02&amp;quot;;}
    host master03 { hardware ethernet 00:0C:29:AA:CC:72; fixed-address 192.168.64.203; option host-name &amp;quot;okd-master03&amp;quot;;}
    # this will not give out addresses to hosts not listed above
    # deny unknown-clients;
  }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;konfiguracja-dnsa-named&#34;&gt;Konfiguracja DNSa (named)&lt;/h3&gt;

&lt;p&gt;/etc/named.conf&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;options {
        listen-on port 53 { any; };
#       listen-on-v6 port 53 { ::1; };
        directory       &amp;quot;/var/named&amp;quot;;
        dump-file       &amp;quot;/var/named/data/cache_dump.db&amp;quot;;
        statistics-file &amp;quot;/var/named/data/named_stats.txt&amp;quot;;
        memstatistics-file &amp;quot;/var/named/data/named_mem_stats.txt&amp;quot;;
        recursing-file  &amp;quot;/var/named/data/named.recursing&amp;quot;;
        secroots-file   &amp;quot;/var/named/data/named.secroots&amp;quot;;
        allow-query     { any; };

        /*
         - If you are building an AUTHORITATIVE DNS server, do NOT enable recursion.
         - If you are building a RECURSIVE (caching) DNS server, you need to enable
           recursion.
         - If your recursive DNS server has a public IP address, you MUST enable access
           control to limit queries to your legitimate users. Failing to do so will
           cause your server to become part of large scale DNS amplification
           attacks. Implementing BCP38 within your network would greatly
           reduce such attack surface
        */
        recursion yes;
        forwarders {
                8.8.8.8;
                8.8.4.4;
        };

        //dnssec-enable yes;
        //dnssec-validation yes;

        /* Path to ISC DLV key */
        bindkeys-file &amp;quot;/etc/named.root.key&amp;quot;;

        managed-keys-directory &amp;quot;/var/named/dynamic&amp;quot;;

        pid-file &amp;quot;/run/named/named.pid&amp;quot;;
        session-keyfile &amp;quot;/run/named/session.key&amp;quot;;
};

logging {
        channel default_debug {
                file &amp;quot;data/named.run&amp;quot;;
                severity dynamic;
        };
};

zone &amp;quot;.&amp;quot; IN {
        type hint;
        file &amp;quot;named.ca&amp;quot;;
};

include &amp;quot;/etc/named.rfc1912.zones&amp;quot;;
include &amp;quot;/etc/named.root.key&amp;quot;;
include &amp;quot;/etc/named/named.conf.local&amp;quot;;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;/etc/named/named.conf.local&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;zone &amp;quot;okd.lab.local&amp;quot; {
    type master;
    file &amp;quot;/etc/named/zones/db.okd.local&amp;quot;; # zone file path
};


zone &amp;quot;64.168.192.in-addr.arpa&amp;quot; {
    type master;
    file &amp;quot;/etc/named/zones/db.192.168.64&amp;quot;;  # 192.168.64.0/24 subnet
};
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;/etc/named/zones/db.okd.local&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$TTL    604800
@       IN      SOA     okd-bastion.okd.lab.local. admin.okd.lab.local. (
                  2     ; Serial
             604800     ; Refresh
              86400     ; Retry
            2419200     ; Expire
             604800     ; Negative Cache TTL
)

; name servers - NS records
    IN      NS      okd-bastion

; name servers - A records
okd-bastion.okd.lab.local.          IN      A       192.168.64.1

; OpenShift Container Platform Cluster - A records
okd-bootstrap.okd.lab.local.        IN      A      192.168.64.200
okd-master01.okd.lab.local.         IN      A      192.168.64.201
okd-master02.okd.lab.local.         IN      A      192.168.64.202
okd-master03.okd.lab.local.         IN      A      192.168.64.203

; OpenShift internal cluster IPs - A records
api.okd.lab.local.    IN    A    192.168.64.1
api-int.okd.lab.local.    IN    A    192.168.64.1
*.apps.okd.lab.local.    IN    A    192.168.64.1
etcd-0.okd.lab.local.    IN    A     192.168.64.201
etcd-1.okd.lab.local.    IN    A     192.168.64.202
etcd-2.okd.lab.local.    IN    A    192.168.64.203
console-openshift-console.apps.okd.lab.local.     IN     A     192.168.64.1
oauth-openshift.apps.okd.lab.local.     IN     A     192.168.64.1

; OpenShift internal cluster IPs - SRV records
_etcd-server-ssl._tcp.okd.lab.local.    86400     IN    SRV     0    10    2380    etcd-0.lab
_etcd-server-ssl._tcp.okd.lab.local.    86400     IN    SRV     0    10    2380    etcd-1.lab
_etcd-server-ssl._tcp.okd.lab.local.    86400     IN    SRV     0    10    2380    etcd-2.lab
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;/etc/named/zones/db.192.168.64&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$TTL    604800
@       IN      SOA     okd-bastion.okd.lab.local. admin.okd.lab.local. (
                  7     ; Serial
             604800     ; Refresh
              86400     ; Retry
            2419200     ; Expire
             604800     ; Negative Cache TTL
)

; name servers - NS records
       IN    NS     okd-bastion.okd.lab.local.

; name servers - PTR records
1      IN    PTR    okd-services.okd.lab.local.

; OpenShift Container Platform Cluster - PTR records
200    IN    PTR    okd-bootstrap.okd.lab.local.
201    IN    PTR    okd-master01.okd.lab.local.
202    IN    PTR    okd-master02.okd.lab.local.
203    IN    PTR    okd-master03.okd.lab.local.
1      IN    PTR    api.okd.lab.local.
1      IN    PTR    api-int.okd.lab.local.
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;konfiguracja-haproxy&#34;&gt;Konfiguracja haproxy&lt;/h3&gt;

&lt;p&gt;/etc/haproxy/haproxy.cfg&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;# Global settings
#---------------------------------------------------------------------
global
    maxconn     20000
    log         /dev/log local0 info
    chroot      /var/lib/haproxy
    pidfile     /var/run/haproxy.pid
    user        haproxy
    group       haproxy
    daemon

    # turn on stats unix socket
    stats socket /var/lib/haproxy/stats

#---------------------------------------------------------------------
# common defaults that all the &#39;listen&#39; and &#39;backend&#39; sections will
# use if not designated in their block
#---------------------------------------------------------------------
defaults
    mode                    http
    log                     global
    option                  httplog
    option                  dontlognull
    option http-server-close
    option forwardfor       except 127.0.0.0/8
    option                  redispatch
    retries                 3
    timeout http-request    10s
    timeout queue           1m
    timeout connect         10s
    timeout client          300s
    timeout server          300s
    timeout http-keep-alive 10s
    timeout check           10s
    maxconn                 20000

listen stats
    bind :9000
    mode http
    stats enable
    stats uri /
    stats refresh 15s
    monitor-uri /healthz



frontend okd_api_fe_6443
    bind :6443
    default_backend okd_api_be_6443
    mode tcp
    option tcplog

backend okd_api_be_6443
    balance source
    mode tcp
    server      okd-bootstrap 192.168.64.200:6443 check
    server      okd-master01 192.168.64.201:6443 check
    server      okd-master02 192.168.64.202:6443 check
    server      okd-master03 192.168.64.203:6443 check

frontend okd_machine_config_server_fe_22623
    bind :22623
    default_backend okd_machine_config_server_be_22623
    mode tcp
    option tcplog

backend okd_machine_config_server_be_22623
    balance source
    mode tcp
    server      okd-bootstrap 192.168.64.200:22623 check
    server      okd-master01 192.168.64.201:22623 check
    server      okd-master02 192.168.64.202:22623 check
    server      okd-master03 192.168.64.203:22623 check

frontend okd_http_ingress_traffic_fe_80
    bind :80
    default_backend okd_http_ingress_traffic_be_80
    mode tcp
    option tcplog

backend okd_http_ingress_traffic_be_80
    balance source
    mode tcp
    server      okd-bootstrap 192.168.64.200:80 check
    server      okd-master01 192.168.64.201:80 check
    server      okd-master02 192.168.64.202:80 check
    server      okd-master03 192.168.64.203:80 check

frontend okd_https_ingress_traffic_fe_443
    bind *:443
    default_backend okd_https_ingress_traffic_be_443
    mode tcp
    option tcplog

backend okd_https_ingress_traffic_be_443
    balance source
    mode tcp
    server      okd-bootstrap 192.168.64.200:443 check
    server      okd-master01 192.168.64.201:443 check
    server      okd-master02 192.168.64.202:443 check
    server      okd-master03 192.168.64.203:443 check
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;konfiguracja-apache-httpd&#34;&gt;Konfiguracja Apache HTTPD&lt;/h3&gt;

&lt;p&gt;Tu akurat najproÅ›ciej - wszystko co trzeba zmieniÄ‡ to port serwera HTTP (bo 80 bÄ™dzie zajÄ™ta przez haproxy)&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;sudo sed -i &#39;s/Listen 80/Listen 8080/&#39; /etc/httpd/conf/httpd.conf
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;konfiguracja-nfsa&#34;&gt;Konfiguracja NFSa&lt;/h3&gt;

&lt;pre&gt;&lt;code&gt;sudo systemctl enable nfs-server rpcbind
sudo systemctl start nfs-server rpcbind
sudo mkdir -p /var/nfs
sudo chmod -R 777 /var/nfs
sudo chown -R nobody:nobody /var/nfs
echo &#39;/var/nfs 192.168.64.0/24(rw,sync,no_root_squash,no_all_squash,no_wdelay)&#39; | sudo tee /etc/exports
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;rozpoczÄ™cie-instalacji-okd&#34;&gt;RozpoczÄ™cie instalacji OKD&lt;/h2&gt;

&lt;p&gt;Sama instalacja OKD skÅ‚ada siÄ™ z 2 czÄ™Å›ci.&lt;/p&gt;

&lt;p&gt;PierwszÄ… jest przygotowanie plikÃ³w instalacyjnych. Te pliki bÄ™dÄ… zawieraÅ‚y caÅ‚Ä… startowÄ… konfiguracjÄ™ klastra (ktÃ³rÄ… pozostawiam domyÅ›lnÄ…) i wskazanie kluczy SSH do zaÅ‚adowania na maszynach oraz pull secretÃ³w do pobrania obrazÃ³w z registry redhatowych. Z tych plikÃ³w nastÄ™pnie sÄ… generowane pliki ignition, ktÃ³re zawierajÄ… instrukcje dla instalatora Fedora CoreOS, ktÃ³ry robi caÅ‚Ä… resztÄ™.&lt;/p&gt;

&lt;p&gt;W drugim etapie nejpierw odpalamy instalacjÄ™ CoreOSa na maszynie okd-bootstrap, gdzie zostaje postawiony minimalistyczny klaster, do ktÃ³rego nastÄ™pnie zostajÄ… dopiÄ™te wÄ™zÅ‚y master. W momencie, gdy klaster na nodach master bÄ™dzie juz w stanie sam dziaÅ‚aÄ‡ to bootstrap siÄ™ zÅ‚ozy i nie bÄ™dzie wiÄ™cej potrzebny - moÅ¼na go wyÅ‚Ä…czyÄ‡ i usunÄ…Ä‡. Z tego powodu nawet przy instalacjach typu baremetal maszyna bootstrap jest stawiana jako wirtualna - bo jest potrzebna tylko podczas instalacji.&lt;/p&gt;

&lt;h3 id=&#34;pull-secret&#34;&gt;pull secret&lt;/h3&gt;

&lt;p&gt;Potrzebne bÄ™dÄ… nam pull secrety do pobrania obrazÃ³w z registry RedHata. MoÅ¼na to rozwiÄ…zaÄ‡ na przynajmniej 2 sposoby - uÅ¼yÄ‡ domyÅ›lnych lub zaÅ‚oÅ¼yÄ‡ konto w RedHacie i pobraÄ‡ stamtÄ…d.
DomyÅ›lne pull secret to&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;{
	â€œauthsâ€:{
		â€œfakeâ€:{â€œauthâ€: â€œbarâ€}
	}
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;PozwalajÄ… one na instalacjÄ™ klastra, ale nie dajÄ… dostÄ™pu do wszystkich operatorÃ³w, dlatego warto pobraÄ‡ sobie pull secrety ze strony RedHata.
&lt;a href=&#34;https://console.redhat.com/openshift/install/pull-secret&#34;&gt;https://console.redhat.com/openshift/install/pull-secret&lt;/a&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;{&amp;quot;auths&amp;quot;:{
	&amp;quot;cloud.openshift.com&amp;quot;:{&amp;quot;auth&amp;quot;:&amp;quot;base64&amp;quot;,&amp;quot;email&amp;quot;:&amp;quot;email@wp.pl&amp;quot;},
	&amp;quot;quay.io&amp;quot;:{&amp;quot;auth&amp;quot;:&amp;quot;BASE64&amp;quot;,&amp;quot;email&amp;quot;:&amp;quot;email@wp.pl&amp;quot;},
	&amp;quot;registry.connect.redhat.com&amp;quot;:{&amp;quot;auth&amp;quot;:&amp;quot;BASE64&amp;quot;,&amp;quot;email&amp;quot;:&amp;quot;email@wp.pl&amp;quot;},
	&amp;quot;registry.redhat.io&amp;quot;:{&amp;quot;auth&amp;quot;:&amp;quot;BASE64&amp;quot;,&amp;quot;email&amp;quot;:&amp;quot;email@wp.pl&amp;quot;}
	}
}
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;klucze-ssh&#34;&gt;Klucze SSH&lt;/h3&gt;

&lt;p&gt;Tu sprawa jest duÅ¼o prostsza - czyli generujemy klucze SSH.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;ssh-keygen
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;pobranie-instalatora-i-klienta&#34;&gt;Pobranie instalatora i klienta&lt;/h3&gt;

&lt;p&gt;Ze strony &lt;a href=&#34;https://github.com/okd-project/okd/releases&#34;&gt;https://github.com/okd-project/okd/releases&lt;/a&gt; pobieramy pliki
- &lt;a href=&#34;https://github.com/okd-project/okd/releases/download/4.12.0-0.okd-2023-04-16-041331/openshift-client-linux-4.12.0-0.okd-2023-04-16-041331.tar.gz&#34;&gt;openshift-client-linux-4.12.0-0.okd-2023-04-16-041331.tar.gz&lt;/a&gt;
- &lt;a href=&#34;https://github.com/okd-project/okd/releases/download/4.12.0-0.okd-2023-04-16-041331/openshift-install-linux-4.12.0-0.okd-2023-04-16-041331.tar.gz&#34;&gt;openshift-install-linux-4.12.0-0.okd-2023-04-16-041331.tar.gz&lt;/a&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;wget https://github.com/okd-project/okd/releases/download/4.12.0-0.okd-2023-04-16-041331/openshift-client-linux-4.12.0-0.okd-2023-04-16-041331.tar.gz
wget https://github.com/okd-project/okd/releases/download/4.12.0-0.okd-2023-04-16-041331/openshift-install-linux-4.12.0-0.okd-2023-04-16-041331.tar.gz
tar -zxvf openshift-client-linux-4.12.0-0.okd-2023-04-16-041331.tar.gz
tar -zxvf openshift-install-linux-4.12.0-0.okd-2023-04-16-041331.tar.gz
sudo mv kubectl oc openshift-install /usr/local/bin/
oc version
openshift-install version
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;przygotowanie-instalacji&#34;&gt;Przygotowanie instalacji&lt;/h3&gt;

&lt;pre&gt;&lt;code&gt;mkdir install_dir
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;TworzÄ™ plik install_dir/install-config.yaml&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;apiVersion: v1
baseDomain: lab.local
metadata:
  name: okd

compute:
- hyperthreading: Enabled
  name: worker
  replicas: 0

controlPlane:
  hyperthreading: Enabled
  name: master
  replicas: 3

networking:
  clusterNetwork:
  - cidr: 10.128.0.0/14
    hostPrefix: 23
  networkType: OpenShiftSDN
  serviceNetwork:
  - 172.30.0.0/16

platform:
  none: {}

fips: false

pullSecret: &#39;{&amp;quot;auths&amp;quot;:{&amp;quot;fake&amp;quot;:{&amp;quot;auth&amp;quot;: &amp;quot;bar&amp;quot;}}}&#39;
sshKey: &#39;ssh-ed25519 AAAA...&#39;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;WaÅ¼ne informacje - usrtawiÄ‡ domenÄ™ (baseDomain) i nazwÄ™ klastra (metadata.name) - razem wychodzi okd.lab.local czyli to, co jest skonfigurowane w DNSie.&lt;/p&gt;

&lt;p&gt;NastÄ™pnie naleÅ¼y usatwiÄ‡ klucz SSH i pull secret.&lt;/p&gt;

&lt;p&gt;Jak plik bÄ™dzie gotowy najlepiej go zbackupowaÄ‡ - bo nastÄ™pne polecenie go usunie&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;cp ./install_dir/install-config.yaml ./install_dir/install-config.yaml.bak`
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Teraz tworzymy manifesty&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;openshift-install create manifests --dir=install_dir/
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Pozostaje nam utworzyÄ‡ pliki ignition&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;openshift-install create ignition-configs --dir=install_dir/
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;hostowanie-plikÃ³w-ignition&#34;&gt;Hostowanie plikÃ³w ignition&lt;/h3&gt;

&lt;p&gt;Teraz trzeba wystawiÄ‡ pliki na serwerze http&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;sudo mkdir /var/www/html/okd
sudo cp -R install_dir/* /var/www/html/okd/
sudo chown -R apache: /var/www/html/
sudo chmod -R 755 /var/www/html/
sudo setsebool -P httpd_read_user_content 1
sudo systemctl enable httpd
sudo systemctl start httpd
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;i moÅ¼na sprawdziÄ‡, czy wszystko bangla&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;curl localhost:8080/okd/metadata.json
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;pobranie-obrazu-fedora-coreos&#34;&gt;Pobranie obrazu Fedora CoreOS&lt;/h3&gt;

&lt;p&gt;Ze strony &lt;a href=&#34;https://fedoraproject.org/coreos/download/?stream=stable&#34;&gt;https://fedoraproject.org/coreos/download/?stream=stable&lt;/a&gt; naleÅ¼y pobraÄ‡ 2 pliki: obraz raw Fedora CoreOS i plik sygnatury&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;wget https://builds.coreos.fedoraproject.org/prod/streams/stable/builds/38.20230430.3.1/x86_64/fedora-coreos-38.20230430.3.1-metal.x86_64.raw.xz
wget https://builds.coreos.fedoraproject.org/prod/streams/stable/builds/38.20230430.3.1/x86_64/fedora-coreos-38.20230430.3.1-metal.x86_64.raw.xz.sig
mv fedora-coreos-38.20230430.3.1-metal.x86_64.raw.xz fcos.raw.xz
mv fedora-coreos-38.20230430.3.1-metal.x86_64.raw.xz.sig fcos.raw.xz.sig
mv fcos.raw.* /var/www/html/okd
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;instalacja-bootstrapa&#34;&gt;Instalacja bootstrapa&lt;/h2&gt;

&lt;p&gt;Mamy odpalonÄ… mszynÄ™ okd-bootstrap, ale zatrzymanÄ… na bootloaderze. Trzeba tam dopisaÄ‡ parametry uruchomieniowe - wszystko w jednej linii, ja tu wstawiÅ‚em znaki nowej linii aby byÅ‚o Å‚atwiej czytaÄ‡.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;coreos.inst.install_dev=/dev/nvme0n1
coreos.inst.image_url=http://192.168.64.1:8080/okd/fcos.raw.xz
coreos.inst.ignition_url=http://192.168.64.1:8080/okd/bootstrap.ign
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;instalacja-masterÃ³w&#34;&gt;Instalacja masterÃ³w&lt;/h2&gt;

&lt;p&gt;Na masterach analogicznie - dopisujemy parametry uruchomieniowe. Jedyna rÃ³Å¼nica to uzycie pliku master.ign zamiast bootstrap.ign&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;coreos.inst.install_dev=/dev/nvme0n1
coreos.inst.image_url=http://192.168.64.1:8080/okd/fcos.raw.xz
coreos.inst.ignition_url=http://192.168.64.1:8080/okd/master.ign
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Teraz pozostaje czekaÄ‡. NajÅ‚atwiej jest odpaliÄ‡ na bastionie&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;openshift-install --dir=install_dir/ wait-for bootstrap-complete --log-level=info
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;W pewnym momencie pÃ³jdzie komunikat, Å¼e bootstrapowanie jest zakoÅ„czone i moÅ¼na siÄ™ pozbyÄ‡ maszyny okd-bootstrap.&lt;/p&gt;

&lt;p&gt;Klaster caÅ‚y czas siÄ™ stawia, do pobrania jest sporo obrazÃ³w. PostÄ™py moÅ¼na obserwowaÄ‡ narzÄ™dziem oc (openshiftowym kubectl)&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;export KUBECONFIG=~/install_dir/auth/kubeconfig
oc get nodes -o wide
oc get csr
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Warto sprawdziÄ‡, czy wszystkie CSRy sÄ… zatwierdzone - jeÅ¼eli nie, to moÅ¼na je zatwierdziÄ‡ rÄ™cznie (u mnie nie byÅ‚o potrzeby)&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;oc get csr -ojson | jq -r &#39;.items[] | select(.status == {} ) | .metadata.name&#39; | xargs oc adm certificate approve
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Gdy z polecenia&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;oc get nodes
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;wszystkie nody bÄ™dÄ… jako Ready to znaczy, Å¼e CSRy sÄ… prawidÅ‚owo zatwierdzone. Teraz naleÅ¼y poczekaÄ‡, aÅ¼ zainstalujÄ… siÄ™ wszystkie clusteroperatory&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;oc get clusteroperators
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;lub skrÃ³towo&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;oc get co
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;U mnie to trwaÅ‚o dÅ‚ugo, jakieÅ› 2 godziny (mam wolne Å‚Ä…cze). Warto teÅ¼ obserwowaÄ‡ czy nie ma ErrImagePull, Crash czy innych bÅ‚Ä™dÃ³w na podach przez&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;oc get pods -A
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Takie pody usuwaÅ‚em.
MoÅ¼e jeszcze wystÄ…piÄ‡ problem z machine configiem. Gdy&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;oc get mcp
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;nie zmienia statusu dÅ‚ugo warto sprawdziÄ‡ co siÄ™ dzieje. W tym celu zrobiÅ‚em&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;oc get mcp master -o yaml
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;i pojawiÅ‚a siÄ™ tam informacja&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;message: &#39;Node okd-master02 is reporting: &amp;quot;getting pending state from journal:
      invalid character &#39;&#39;U&#39;&#39; looking for beginning of value&amp;quot;, Node okd-master03 is
      reporting: &amp;quot;getting pending state from journal: invalid character &#39;&#39;U&#39;&#39; looking
      for beginning of value&amp;quot;&#39;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Jest to problem z journalem. W tym celu zalogowaÅ‚em sie na podane nody&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;ssh core@okd-master02.okd.lab.local
sudo -i
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code&gt;[root@okd-master02 ~]# journalctl --verify
Journal file /var/log/journal/674cc4f6256143379fd7935e328f9d5a/system@0005fc3742709c54-6eca9ce9bfe3ba10.journal~ uses an unsupported feature, ignoring file.
Use SYSTEMD_LOG_LEVEL=debug journalctl --file=/var/log/journal/674cc4f6256143379fd7935e328f9d5a/system@0005fc3742709c54-6eca9ce9bfe3ba10.journal~ to see the details.
PASS: /run/log/journal/b6e26c4db861474baaf198d6ef590c14/system.journal
PASS: /var/log/journal/674cc4f6256143379fd7935e328f9d5a/system@9568609074994ae3930a1fa8619a9c92-0000000000000001-0005fc374221691a.journal
PASS: /var/log/journal/674cc4f6256143379fd7935e328f9d5a/user-1000@ecb0a8ca75ee43acb8fb7aa5b5371224-000000000000847e-0005fc381cd80d81.journal
PASS: /var/log/journal/674cc4f6256143379fd7935e328f9d5a/system@9568609074994ae3930a1fa8619a9c92-00000000000084bf-0005fc381d13973f.journal
PASS: /var/log/journal/674cc4f6256143379fd7935e328f9d5a/user-1000@ecb0a8ca75ee43acb8fb7aa5b5371224-00000000000084c2-0005fc381d16f9f2.journal
PASS: /var/log/journal/674cc4f6256143379fd7935e328f9d5a/system@9568609074994ae3930a1fa8619a9c92-000000000000ad1b-0005fc384862d10e.journal
390c80: Data object references invalid entry at 4e1da0
File corruption detected at /var/log/journal/674cc4f6256143379fd7935e328f9d5a/system.journal:4e19d0 (of 8388608 bytes, 61%).
FAIL: /var/log/journal/674cc4f6256143379fd7935e328f9d5a/system.journal (Bad message)
PASS: /var/log/journal/674cc4f6256143379fd7935e328f9d5a/user-1000@ecb0a8ca75ee43acb8fb7aa5b5371224-000000000000ad1e-0005fc384863d4c7.journal
PASS: /var/log/journal/674cc4f6256143379fd7935e328f9d5a/user-1000.journal
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Tu mamy informacje o problemach z journalami. UsunÄ…Å‚em wpisy z journali&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;[root@okd-master02 ~]# journalctl --vacuum-time=1m
Journal file /var/log/journal/674cc4f6256143379fd7935e328f9d5a/system@0005fc3742709c54-6eca9ce9bfe3ba10.journal~ uses an unsupported feature, ignoring file.
Use SYSTEMD_LOG_LEVEL=debug journalctl --file=/var/log/journal/674cc4f6256143379fd7935e328f9d5a/system@0005fc3742709c54-6eca9ce9bfe3ba10.journal~ to see the details.
Vacuuming done, freed 0B of archived journals from /run/log/journal.
Vacuuming done, freed 0B of archived journals from /run/log/journal/b6e26c4db861474baaf198d6ef590c14.
Vacuuming done, freed 0B of archived journals from /var/log/journal.
Deleted archived journal /var/log/journal/674cc4f6256143379fd7935e328f9d5a/system@0005fc3742709c54-6eca9ce9bfe3ba10.journal~ (8.0M).
Deleted archived journal /var/log/journal/674cc4f6256143379fd7935e328f9d5a/system@9568609074994ae3930a1fa8619a9c92-0000000000000001-0005fc374221691a.journal (35.3M).
Deleted archived journal /var/log/journal/674cc4f6256143379fd7935e328f9d5a/user-1000@ecb0a8ca75ee43acb8fb7aa5b5371224-000000000000847e-0005fc381cd80d81.journal (3.5M).
Deleted archived journal /var/log/journal/674cc4f6256143379fd7935e328f9d5a/system@9568609074994ae3930a1fa8619a9c92-00000000000084bf-0005fc381d13973f.journal (12.1M).
Deleted archived journal /var/log/journal/674cc4f6256143379fd7935e328f9d5a/user-1000@ecb0a8ca75ee43acb8fb7aa5b5371224-00000000000084c2-0005fc381d16f9f2.journal (3.6M).
Deleted archived journal /var/log/journal/674cc4f6256143379fd7935e328f9d5a/system@9568609074994ae3930a1fa8619a9c92-000000000000ad1b-0005fc384862d10e.journal (22.7M).
Deleted archived journal /var/log/journal/674cc4f6256143379fd7935e328f9d5a/user-1000@ecb0a8ca75ee43acb8fb7aa5b5371224-000000000000ad1e-0005fc384863d4c7.journal (3.7M).
Vacuuming done, freed 89.2M of archived journals from /var/log/journal/674cc4f6256143379fd7935e328f9d5a.
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Ponowna weryfikacja przebiegÅ‚a prawidÅ‚owo&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;[root@okd-master02 ~]# journalctl --verify
PASS: /run/log/journal/b6e26c4db861474baaf198d6ef590c14/system.journal
PASS: /var/log/journal/674cc4f6256143379fd7935e328f9d5a/system.journal
PASS: /var/log/journal/674cc4f6256143379fd7935e328f9d5a/user-1000.journal
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Teraz Machine config siÄ™ zakoÅ„czyÅ‚ prawidÅ‚owo.&lt;/p&gt;

&lt;p&gt;Klaster dziaÅ‚a. MoÅ¼na siÄ™ zalogowaÄ‡ do konsoli. Adres konsoli mozna odczytaÄ‡ przy uzyciu oc&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;oc whoami --show-console
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;W tym przypadku jest to &lt;a href=&#34;https://console-openshift-console.apps.okd.lab.local&#34;&gt;https://console-openshift-console.apps.okd.lab.local&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Aby suiÄ™ zalogowaÄ‡ nalezy podaÄ‡ uzytkownika kubeadmin i hasÅ‚a z pliku install_dir/auth/kubeadmin-password&lt;/p&gt;

&lt;p&gt;Teraz pozostaje utworzenie uzytkonika i skonfigurowanie storage&amp;rsquo;u.&lt;/p&gt;

&lt;h2 id=&#34;utworzenie-uÅ¼ytkownikÃ³w&#34;&gt;Utworzenie uÅ¼ytkownikÃ³w&lt;/h2&gt;

&lt;p&gt;Czas utworzyÄ‡ uzytkownika. Z kubeadmin nie naleÅ¼y bezpoÅ›rednio korzystaÄ‡, warto potworzyÄ‡ uÅ¼ytkownikÃ³w imiennych. Najprostszym sposobem jest uzycie htpasswd. Najpierw wygenerujmy plik htpasswd&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;htpasswd -c -B -b users.htpasswd testuser testpassword
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;NastÄ™pnie moÅ¼na zaÅ‚adowaÄ‡ ten plik&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;oc create secret generic htpass-secret --from-file=htpasswd=users.htpasswd -n openshift-config
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Aby z tego korzystaÄ‡ naleÅ¼y utworzyÄ‡ htpasswd_provider. W tym celu naleÅ¼y tuworzyÄ‡ plik htpasswd_provider.yaml&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;apiVersion: config.openshift.io/v1
kind: OAuth
metadata:
  name: cluster
spec:
  identityProviders:
  - name: htpasswd_provider
    mappingMethod: claim
    type: HTPasswd
    htpasswd:
      fileData:
        name: htpass-secret
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;i zaÅ‚adowaÄ‡ go do klastra&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;oc apply -f htpasswd_provider.yaml
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Teraz czas nadaÄ‡ uprawnienia. Pierwszemu uzytkownikowi warto nadaÄ‡ cluster-admin (czyli globalnego admina)&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;oc adm policy add-cluster-role-to-user cluster-admin testuser
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Trzeba poczekaÄ‡ chwilÄ™ (u mnie ok. minuty) i po wejÅ›ciu na konsolÄ™ zostaniemy przekirowani na ekran wybory providera toÅ¼samoÅ›ci.&lt;/p&gt;

&lt;h2 id=&#34;konfiguracja-storage-u&#34;&gt;Konfiguracja storage&amp;rsquo;u&lt;/h2&gt;

&lt;p&gt;Aby klaster byÅ‚ caÅ‚kowicie funkcjonalny brakuje ostatniej rzeczy - podÅ‚Ä…czenia storage&amp;rsquo;u. Na okd-bastion mamy skonfigurowany zasÃ³b NFS /var/nfs udostÄ™pniony dla sieci 192.168.64.0/24. Aby z niego skorzystaÄ‡ moÅ¼emy podejÅ›Ä‡ na 2 sposoby. W wariancie prostszym moÅ¼na konfigurowaÄ‡ Persistent Volume. KonfigurujÄ…c PV wskazuje siÄ™ adres IP serwera i Å›cieÅ¼kÄ™ do zasobu, np. tak:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;apiVersion: v1
kind: PersistentVolume
metadata:
  name: nfs1-pv
spec:
  capacity:
    storage: 100Gi
  accessModes:
    - ReadWriteMany
  persistentVolumeReclaimPolicy: Retain
  nfs:
    path: /var/nfs/nfs1
    server: 192.168.64.1
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ZaletÄ… jest to, Å¼e dziaÅ‚a to bez Å¼adnych dodatkowych operatorÃ³w, wadÄ… - Å¼e musimy definiowaÄ‡ takie woluminy samodzielnie.&lt;/p&gt;

&lt;p&gt;Jest drugie rozwiÄ…zanie - utworzenie Storage Class. Niestety, kubernetes (ani teÅ¼ OpenShift) nie ma wbudowanej storage classy do obsÅ‚ugi NFS. Jest jednak rozwiÄ…zanie w postaci zewnÄ™trznego provisionera, co prawda niedostÄ™pnego przez OperatorHuba w OKD czy OpenShifcie.&lt;/p&gt;

&lt;p&gt;WidziaÅ‚em przynajmniej 2 takie rozwiÄ…zania, ja wybraÅ‚em # Kubernetes NFS Subdir External Provisioner (&lt;a href=&#34;https://github.com/kubernetes-sigs/nfs-subdir-external-provisioner&#34;&gt;https://github.com/kubernetes-sigs/nfs-subdir-external-provisioner&lt;/a&gt;). Na githubie jest Å‚adna instrukcja, nawet zawierajÄ…ca osobnÄ… czÄ™Å›Ä‡ dla OpenShifta. W zasadzie caÅ‚oÅ›Ä‡ to przepisanie fragmentu tej instrukcji, ale myÅ›lÄ™, Å¼e warto to zawrzeÄ‡ dla kompletnoÅ›ci instrukcji.&lt;/p&gt;

&lt;p&gt;Zaczynamy od sklonowania repozytorium:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;git clone https://github.com/kubernetes-sigs/nfs-subdir-external-provisioner.git
cd nfs-subdir-external-provisioner
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;NaleÅ¼y zaczÄ…Ä‡ od utworzenia projektu/namespace&amp;rsquo;u dla provisionera, ja wybraÅ‚em &amp;ldquo;nfs-provisioner&amp;rdquo;. Zatem najpierw tworzymy projekt:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;oc new-project nfs-provisioner
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Po utrozeniu projektu zostanie on automatycznie wybrany. Teraz jedziemy dokÅ‚adnie wedÅ‚ug instrukcji:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;NAMESPACE=`oc project -q`
sed -i&#39;&#39; &amp;quot;s/namespace:.*/namespace: $NAMESPACE/g&amp;quot; ./deploy/rbac.yaml ./deploy/deployment.yaml
oc create -f deploy/rbac.yaml
oc adm policy add-scc-to-user hostmount-anyuid system:serviceaccount:$NAMESPACE:nfs-client-provisioner
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;NastÄ™pnie w pliku deplo/deployment.yaml naleÅ¼y ustawiÄ‡ adres do serwera NFS&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;apiVersion: apps/v1
kind: Deployment
metadata:
  name: nfs-client-provisioner
  labels:
    app: nfs-client-provisioner
  # replace with namespace where provisioner is deployed
  namespace: nfs-provisioner
spec:
  replicas: 1
  strategy:
    type: Recreate
  selector:
    matchLabels:
      app: nfs-client-provisioner
  template:
    metadata:
      labels:
        app: nfs-client-provisioner
    spec:
      serviceAccountName: nfs-client-provisioner
      containers:
        - name: nfs-client-provisioner
          image: registry.k8s.io/sig-storage/nfs-subdir-external-provisioner:v4.0.2
          volumeMounts:
            - name: nfs-client-root
              mountPath: /persistentvolumes
          env:
            - name: PROVISIONER_NAME
              value: k8s-sigs.io/nfs-subdir-external-provisioner
            - name: NFS_SERVER
              value: 192.168.64.1
            - name: NFS_PATH
              value: /var/nfs
      volumes:
        - name: nfs-client-root
          nfs:
            server: 192.168.64.1
            path: /var/nfs
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Teraz naleÅ¼y zaÅ‚adowaÄ‡ ten manifest&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;oc apply -f deploy/deployment.yaml
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;MajÄ…c gotowego provisionera mozna utworzyÄ‡ strorageclass. DomyÅ›lna jest w pliku deploy/class.yaml. Ja zdecydowaÅ‚em siÄ™ jednak minimalnie jÄ… zmieniÄ‡ - a mianowicie ustawiÄ‡ jako domyÅ›lÄ…:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  annotations:
    storageclass.kubernetes.io/is-default-class: &amp;quot;true&amp;quot;
  name: nfs-client
parameters:
  onDelete: delete
  pathPattern: ${.PVC.namespace}/${.PVC.annotations.nfs.io/storage-path}
provisioner: k8s-sigs.io/nfs-subdir-external-provisioner
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;podsumowanie&#34;&gt;Podsumowanie&lt;/h2&gt;

&lt;p&gt;To koÅ„czy proces instalacji i minimalnej konfiguracji klastra OKD.&lt;/p&gt;

&lt;p&gt;W przypadku &amp;ldquo;peÅ‚nego&amp;rdquo; OpenShifta (platnego) proces instalacji jest identyczny, rÃ³Å¼nice to pobranie wÅ‚aÅ›ciwego instalatora (zamiast OKD z Githuba naleÅ¼y pobraÄ‡ OpenShift od RedHata). OczywiÅ›cie, nic nmie stoi na przeszkodzie aby w swoim labie postawiÄ‡ taki klaster - istnieje wersja testowa na 60 dni. CaÅ‚oÅ›Ä‡ do pobrania z &lt;a href=&#34;https://console.redhat.com/openshift/downloads&#34;&gt;https://console.redhat.com/openshift/downloads&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Na zakoÅ„czenie chciaÅ‚bym jeszcze wskazaÄ‡ 2 ciekawe ÅºrodÅ‚a - jest to instrukcja instalacji klastra w wersji 4.5 autorstwa Craiga Robinsona &lt;a href=&#34;https://itnext.io/guide-installing-an-okd-4-5-cluster-508a2631cbee&#34;&gt;https://itnext.io/guide-installing-an-okd-4-5-cluster-508a2631cbee&lt;/a&gt; oraz pewnego rodzaju uzupeÅ‚nienie w postaci zapisu streama z instalacji wedÅ‚ug tej instukcji  &lt;a href=&#34;https://www.youtube.com/watch?v=qh1zYW7BLxE&#34;&gt;https://www.youtube.com/watch?v=qh1zYW7BLxE&lt;/a&gt;. Warto przejrzeÄ‡ teÅ¼ inne wpisy na blogu Craiga - jest tam wiele instrukcji dotyczÄ…cych instalacji OpenShifta na rÃ³Å¼ne sposoby.&lt;/p&gt;

&lt;p&gt;Przy tworzeniu tej istrukcji pomocny teÅ¼ byÅ‚ ocp4-helpernode &lt;a href=&#34;https://github.com/redhat-cop/ocp4-helpernode&#34;&gt;https://github.com/redhat-cop/ocp4-helpernode&lt;/a&gt; - zautomatyzowany ansiblem sposÃ³b budowy bastiona. WÅ‚aÅ›nie z niego zaczerpnÄ…Å‚em pomysÅ‚ postawienie wÅ‚asnego serwera DHCP a nie opieranie siÄ™ na dodatkowej maszynie z postawionym pfsensem. Helpernode uÅ¼ywa DHCP, jednak jest nastawiony na pozostawienie zewnÄ™trznego gatewaya - ja nie chciaÅ‚m mieÄ‡ 2 serwerÃ³w DHCP w jednym segmencie sieci wiÄ™c zdecydowaÅ‚em siÄ™ na skonfigurowanie routingu na bastionie.&lt;/p&gt;

&lt;p&gt;Jednak helpernode ma jeszcze jednÄ… bardzo cieawÄ… funkcjonalniÅ›Ä‡ - konfiguruje PXE Boot, co jeszcze bardziej uÅ‚atwia instalacjÄ™ kolejnych nodeÃ³w - bo wystarczy wybraÄ‡ z menu krotego typu maszynÄ™ postawiÄ‡ (bootstrap, master, worker). Jest to ciekawe rowiazanie, ale wedÅ‚ug mnie na potrzeby maÅ‚ego klastra jest to przerost formy nad treÅ›ciÄ….&lt;/p&gt;
</description>
    </item>
    
    
    
    <item>
      <title>Linux - historia prawdziwa</title>
      <link>https://kamm.github.io/2021/04/linux-historia-prawdziwa/</link>
      <pubDate>Thu, 22 Apr 2021 15:56:15 CEST</pubDate>
      <author>Kamil MÄ™trak</author>
      <guid>https://kamm.github.io/2021/04/linux-historia-prawdziwa/</guid>
      <description>&lt;p&gt;Tym razem bÄ™dzie bardziej blognotka. Wielokrotnie byÅ‚em okreÅ›lany jako &amp;ldquo;ten windowsiarz&amp;rdquo;, co dla osÃ³b, ktÃ³re znajÄ… mnie trochÄ™ dÅ‚uÅ¼ej bÄ™dzie zdziwieniem. Ale moÅ¼e po kolei.&lt;/p&gt;

&lt;p&gt;Gdy zaczÄ…Å‚em studia najpopularniejszymi systemami byÅ‚y 2 windowsy - 98 i 2000 (o ME chyba wszyscy chcÄ… zapomnieÄ‡). ByÅ‚ to rok 2001, czyli chwila przed pojawieniem siÄ™ XP. Z linuksem (dobra, GNU/Linux) miaÅ‚em minimalne doÅ›wiadczenie - prÃ³bowaÅ‚em uÅ¼ywaÄ‡ wczeÅ›niej RedHata (5.1 Manhattan), Monkey Linux, byÅ‚ teÅ¼ Mandrake Linux, ale tak jakoÅ› nigdy w ten temat gÅ‚Ä™biej nie wszedÅ‚em. GÅ‚Ã³wnym problemem byÅ‚a kwestia kompatybilnoÅ›ci sprzÄ™tu.&lt;/p&gt;

&lt;p&gt;Jednak na studiach kumpel pokazaÅ‚ mi Slackware i ten system jakoÅ› mi siÄ™ spodobaÅ‚. TrochÄ™ hardcorowy, ale ciekawy. Trzeba siÄ™ byÅ‚o trochÄ™ nakombinowaÄ‡, moÅ¼e trochÄ™ taka sztuka dla sztuki, ale udaÅ‚o mi siÄ™ poznaÄ‡ linuksa i nawet udaÅ‚o mi siÄ™ na nim normalnie pracowaÄ‡. OczywiÅ›cie, do gier pozostaÅ‚ windows.&lt;/p&gt;

&lt;p&gt;Tak minÄ™Å‚y jakieÅ› 2-3 lata i kupiÅ‚em pierwszego laptopa. ChciaÅ‚em tu sprÃ³bowaÄ‡ czegoÅ› innego. Slackware byÅ‚ fajny, ale tak trochÄ™ z zazdroÅ›ciÄ… patrzyÅ‚em jak np. na debianie wystarcza apt-get install i gotowe, a ja muszÄ™ siÄ™ mÄ™czyÄ‡ jak jaskiniowiec. PostanowiÅ‚em na lapku postawiÄ‡ debiana. Moja przygoda wtedy skoÅ„czyÅ‚a siÄ™ dosyÄ‡ szybko - debian, jako system w ktÃ³rym wszystko jest stabilne czyli trochÄ™ przestarzaÅ‚e - miaÅ‚ caÅ‚y czas XFree86, a nie Xorg&amp;rsquo;a. To powodowaÅ‚o, Å¼e na moim lapku nie byÅ‚em w stanie dobrze skonfigurowaÄ‡ grafiki. CÃ³Å¼. Bywa. Nie pamiÄ™tam juÅ¼ dlaczego nie poszedÅ‚em w sida, ale dzisiaj to juÅ¼ nieistotne. PojawiÅ‚a siÄ™ wtedy nowa dystrybucja, bazujÄ…ca na debianie - Ubuntu. SpodobaÅ‚o mi siÄ™, Å¼e wszystko dziaÅ‚a out-of-the-box i tak zaczÄ…Å‚em uÅ¼ywaÄ‡ &lt;em&gt;Å‚ubudubu&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;W 2006 roku zaczÄ…Å‚em pracÄ™. W pracy jednak systemem uÅ¼ywanym na serwerach byÅ‚ windows wiÄ™c aby skonfigurowaÄ‡ u siebie jakieÅ› Å›rodowisko deweloperskie potrzebowaÅ‚em windowsa. I tak po kilku latach uÅ¼ywania pingwina wrÃ³ciÅ‚em do okien. A w linuksie byÅ‚em zdecydowanie poweruserem - wystarczy powiedzieÄ‡, Å¼e zdecydowaÅ‚em siÄ™ uÅ¼ywaÄ‡ jako Å›rodowiska graficznego najpierw mocno dostrojonego pod siebie windowmakera, a pÃ³Åºniej FVWM Crystal - chyba najpopularniejszego w tamtych czasach managera okien wÅ›rÃ³d ludzi chwalÄ…cych siÄ™ screenshotami pulpitu.&lt;/p&gt;

&lt;p&gt;Jednak w pracy potrzebowaÅ‚em windowsa. I tak w niego wsiÄ…kÅ‚em. Jedna firma, druga, trzecia&amp;hellip; Ale zawsze mi brakowaÅ‚o trochÄ™ linuksa - najpierw byÅ‚a proteza w postaci przynajmniej paru narzÄ™dzi terminalowych - zawsze coÅ›. Najpierw byÅ‚ MinGW. Potem krÃ³tki epizod z MacOSem - wreszcie mogÅ‚em pracowaÄ‡ z &amp;ldquo;natywnym&amp;rdquo; bashem :) Potem powrÃ³t do windowsa, odkrycie cygwina i byÅ‚o juÅ¼ caÅ‚kiem fajnie. W koÅ„cu zaczÄ…Å‚em uÅ¼ywaÄ‡ babuna (o ktÃ³rym pisaÅ‚em w 2016 roku). W firmie, w ktÃ³rej aktualnie pracujÄ™ nie ma problemu aby uÅ¼ywaÄ‡ linuksa, ale jakoÅ› siÄ™ na to nie zdecydowaÅ‚em.&lt;/p&gt;

&lt;p&gt;JakiÅ› rok temu prÃ³bowaÅ‚em na prywatnym komputerze wrÃ³ciÄ‡ do linuksa na desktopie - bo uÅ¼ycie na serwerach to dla mnie oczywistoÅ›Ä‡ i nie jest to dla mnie trudne, a w konsoli zawsze mi siÄ™ najlepiej pracowaÅ‚o. Nie mogÅ‚em jednak sobie poradziÄ‡ w nowym ubuntu. CoÅ› mi caÅ‚y czas nie pasowaÅ‚o, chociaÅ¼ moÅ¼e w pewnym sensie przyzwyczaiÅ‚em siÄ™ do pewnych udogodnieÅ„ w windowsie.&lt;/p&gt;

&lt;p&gt;W tym roku stwierdziÅ‚em, Å¼e kupiÄ™ sobie coÅ› ciekawego - thinkpada. WybraÅ‚em X230. I oczywiÅ›cie tu powÄ™druje linux. PoczÄ…tkowo chciaÅ‚em debiana, ale stwierdziÅ‚em Å¼e wyprÃ³bujÄ™ coÅ› zupeÅ‚nie innego. DystrybucjÄ™ o ktÃ³rej tylko sÅ‚yszaÅ‚em, ale zawsze chwalonÄ… i wielokrotnie porÃ³wnywanÄ… ze slackiem, z ktÃ³rego kiedyÅ› korzystaÅ‚em - Arch Linux.&lt;/p&gt;

&lt;p&gt;Thinkpad jak to thinkpad - pod pingwinem obsÅ‚ugiwane wszystko bez najmniejszego problemu. Od archa zawsze odrzucaÅ‚o mnie przez pewne lenistwo - kwestia instalacji. Tak, ta dystrybucja nie ma instalatora. Nawet tak podstawowego jak 20 lat temu miaÅ‚ slackware czy debian. Nie - tu wszystko trzeba zrobiÄ‡ samemu. Jednak po przezwyciÄ™Å¼eniu lenistwa i doczytaniu trochÄ™ w arch wiki postawiÅ‚em system. ChciaÅ‚em go mieÄ‡ dosyÄ‡ minimalistyczny i zastanawiaÅ‚em siÄ™ nad instalacjÄ… w stylu konfiguracji Luke&amp;rsquo;a Smitha, ale nie pasowaÅ‚o mi to. Z powodu wspomnianego lenistwa bazowaÅ‚em na czyjejÅ› konfiguracji i trafiÅ‚em na fajny zestaw narzÄ™dzi - &lt;a href=&#34;https://github.com/addy-dclxvi/dotfiles&#34;&gt;GitHub - addy-dclxvi/dotfiles: My personal backup of my dotfiles on ThinkPad-X230-Debian-Openbox and Aspire-A514-Debian-Fluxbox&lt;/a&gt;. Czyli wybraÅ‚em openboksa - jako Å¼e pamiÄ™tam jeszcze blackboksa i pÃ³Åºniejszego fluxboksa to mi bardzo podpasowaÅ‚. Addy uÅ¼ywa debiana - tu musiaÅ‚em trochÄ™ rzeczy wykombinowaÄ‡, bo nie zadziaÅ‚aÅ‚y od razu, ale to nie problem. UzupeÅ‚niÅ‚em kilkoma pomysÅ‚ami od Luke&amp;rsquo;a Smitha i tak udaÅ‚o mi siÄ™ wreszcie wrÃ³ciÄ‡ do uÅ¼ywania linuksa jako daily. I czujÄ™,Å¼e byÅ‚a to dobra decyzja.&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://kamm.github.io/images/Cheese_21.04.22_16.18.38.png&#34; alt=&#34;screen&#34; /&gt;&lt;/p&gt;
</description>
    </item>
    
    
    
    <item>
      <title>Suckless po mojemu</title>
      <link>https://kamm.github.io/2021/04/suckless-po-mojemu/</link>
      <pubDate>Tue, 20 Apr 2021 20:18:00 CEST</pubDate>
      <author>Kamil MÄ™trak</author>
      <guid>https://kamm.github.io/2021/04/suckless-po-mojemu/</guid>
      <description>&lt;p&gt;Tym razem znÃ³w o narzÄ™dziach z ktÃ³rych korzystam. ZacznÄ™ od tego jak na to trafiÅ‚em. OglÄ…daÅ‚em sobie tak z nudÃ³w youtuba i wpadÅ‚ mi film ZmasÅ‚o o tym, Å¼e zainstalowaÅ‚ archa. Wtedy jeszcze nie byÅ‚em przekonany do tej dystrybucji, ale przejrzaÅ‚em sobie co on tam ma - tiling managery do mnie nie przemawiajÄ…, ale zainteresowaÅ‚ mnie st - simple terminal (lub jak inni wolÄ… mowiÄ‡ suckless terminal). ZaczÄ…Å‚em siÄ™ interesowaÄ‡ narzÄ™dziami suckless i miaÅ‚em trochÄ™ mieszane uczucia. Z tego samego filmu dowiedziaÅ‚em siÄ™ teÅ¼ o kanale Luke&amp;rsquo;a Smitha. GoÅ›Ä‡ opowiada fajne rzeczy o linuksie (czasem ogÃ³lnie, czasem specyficznie o archu), minimalistycznych narzedziach, filozofii wolnego oprogramowania - generalnie polecam.&lt;/p&gt;

&lt;p&gt;Luke Smith udostÄ™pniÅ‚ kilka ciekawych modyfikacji do st i spodobaÅ‚y mi siÄ™. Niestety, przynajmniej jedna z nich jest Å‚atwa do ogarniÄ™cia tylko na archu, ale to juÅ¼ dla mnie nie problem ğŸ˜€. Tak zaczÄ…Å‚em korzystaÄ‡ z st w miejsce urxvt.&lt;/p&gt;

&lt;p&gt;MoÅ¼e trochÄ™ powiem o suckless. Te narzÄ™dzia sÄ… dosyÄ‡ specyficzne. Filozofia suckless to narzÄ™dzia proste, moÅ¼liwie przejrzyÅ›cie napisane, o jak najmniejszej iloÅ›ci kodu (czyli bez niepotrzebnych funkcjonalnoÅ›ci). Tu przyÅ‚adowo o st - xterm ma ok. 65k linii kodu, przedewszystkim ze wzglÄ™du na wsparcie dla emulacji rÃ³Å¼nych archaicznych terminali. Rxvt-unicode lub inaczej urxvt ma ok. 32k linii kodu. st ma ok 7k linii kodu. Jednak nie wszystko jest takie piÄ™kne. NarzÄ™dzia suckless oszczÄ™dzajÄ… linie kodu rezygnujÄ…c takÅ¼e z plikÃ³w konfiguracyjnych. Konfiguracja we wszystkich programach odbywa siÄ™ poprzez edycjÄ™ pliku config.h i przebudowanie programu. Z tego wynika kolejny problem - nie da siÄ™ tego spaczkowaÄ‡ i umieÅ›ciÄ‡ np. w repozytorium archa lub debiana - bo nie moÅ¼na tego konfigurowaÄ‡.&lt;/p&gt;

&lt;p&gt;I tu zaczyna siÄ™ moje ale do suckless. O ile terminal konfiguruje siÄ™ w zasadzie raz i tyle, to w pakiecie suckless jest program do prowadzenia prezentacji - sent. Niby fajne, ale aby zmieniÄ‡ kolor tÅ‚a lub font w prezentacji naleÅ¼y przekompilowaÄ‡ sent. To nie pasuje.&lt;/p&gt;

&lt;p&gt;Suckless ma teÅº swoj manager okien, jednak jest to manager kafelkowy (chyba tak naleÅ¼aÅ‚oby przetÅ‚umaczyÄ‡ tiling), ale to mi nie leÅ¼y i na razie zostanÄ™ przy openboksie.&lt;/p&gt;

&lt;p&gt;Jednak kolejne narzÄ™dzie tu juÅ¼ co innego - dmenu. W skrÃ³cie - jest to dynamiczne menu, z ktÃ³rego bardzo miÅ‚o korzysta siÄ™ w skryptach. ObsÅ‚ugiwane oczywiÅ›cie w caÅ‚oÅ›ci klawiaturÄ…. W ktÃ³rymÅ› nastÄ™pnym wpisie opiszÄ™ skrypty, z ktÃ³rych korzystam.&lt;/p&gt;

&lt;p&gt;PodsumowujÄ…c - czÄ™Å›Ä‡ rozwiÄ…zaÅ„ suckless jest rzeczywiÅ›cie fajnych, a ich minimalizm naprawdÄ™ fajny. Jednak druga czÄ™Å›Ä‡ tych narzÄ™dzi to suckmore - zdecydowanie odbiegajÄ…ce od reszty, niezbyt przemyÅ›lane. Mam wraÅ¼enie, Å¼e taki sent byÅ‚ napisany po to aby przeprowadziÄ‡ jednÄ… prezentacjÄ™, ewentualnie - programista napisaÅ‚ go tylko dla siebie i pod siebie.&lt;/p&gt;

&lt;p&gt;Tyle&amp;hellip;&lt;/p&gt;
</description>
    </item>
    
    
    
    <item>
      <title>screen - manager okien w terminalu tekstowym</title>
      <link>https://kamm.github.io/2021/04/screen/</link>
      <pubDate>Tue, 13 Apr 2021 16:37:15 CEST</pubDate>
      <author>Kamil MÄ™trak</author>
      <guid>https://kamm.github.io/2021/04/screen/</guid>
      <description>

&lt;p&gt;CzeÅ›Ä‡.&lt;/p&gt;

&lt;p&gt;Od czasu pojawienia siÄ™ koronawirusa caÅ‚a moja praca odbywa siÄ™ zdalnie. Niestety, wiele osÃ³b narzeka na stabilnoÅ›Ä‡ VPNa - tym siÄ™ nie bÄ™dÄ™ zajmowaÅ‚ ani wnikaÅ‚ w powody i propozycje rozwiÄ…zania. ZaproponujÄ™ pewnÄ… protezÄ™, ktÃ³ra pomoÅ¼e w tym przypadku a jednoczeÅ›nie da kilka innych moÅ¼liwoÅ›ci pracy na systemach uniksowych.&lt;/p&gt;

&lt;p&gt;Generalnie pomysÅ‚ jest prosty i jest obecny np. przy poÅ‚Ä…czeniu pulpitem zdalnym - czyli gdy zostanie zerwane poÅ‚Ä…czenie sieciowe z serwerem to sesja jest odÅ‚Ä…czana a nie zrywana. Oznacza to tyle, Å¼e gdy stracimy poÅ‚Ä…czenie sieciowe to procesy uruchomione na pulpicie zdalnym caÅ‚y czas dziaÅ‚ajÄ… i po pierwsze moÅ¼emy je tak zostawiÄ‡ gdy chcemy pozostawiÄ‡ jakiÅ› dÅ‚ugo dziaÅ‚ajÄ…cy proces albo zabezpieczyÄ‡ siÄ™ przed wÅ‚aÅ›nie takim zerwaniem poÅ‚Ä…czenia - np. wykonujemy jakiÅ› update na bazie danych lub budujemy coÅ› mavenem. Tak samo jest gdy uÅ¼ywamy VNC. Nie bÄ™dÄ™ wnikaÅ‚ w inne rozwiÄ…zania bo ich nie znam.&lt;/p&gt;

&lt;p&gt;Ale nie zawsze chcemy uÅ¼ywaÄ‡ Å›rodowiska graficznego - do wielu rzeczy wystarcza terminal - czyli wystarczy nam poÅ‚Ä…czenie ssh. Jednak przy poÅ‚Ä…czeniu SSH jeÅ¼eli poÅ‚Ä…czenie zostanie zerwane to proces zostanie ubity. Czyli zbudowanie na serwerze aplikacji mavenem, gdzie budowa trwa godzinÄ™ nigdy siÄ™ nie uda, gdy VPN zrywa poÅ‚Ä…czenie po 30 minutach.&lt;/p&gt;

&lt;p&gt;I tu wchodzi caÅ‚y na biaÅ‚o (he he) screen. OczywiÅ›cie, ktoÅ› powie &amp;ldquo;tmux moÅ¼e to samo i nawet wiÄ™cej&amp;rdquo;. Tak, ale screen jest duÅ¼o prostszy w uÅ¼yciu i do tego zastosowania wystarczy. JednoczeÅ›nie jest on dobrym wstÄ™pem do pÃ³Åºniejszego uÅ¼ycia tmuxa.&lt;/p&gt;

&lt;p&gt;Czym jest screen? Jak mÃ³wi &lt;em&gt;man&lt;/em&gt; jest to peÅ‚noekranowy manager okien, ktÃ³ry multipleksuje fizyczny terminal pomiÄ™dzy kilkoma procesami.&lt;/p&gt;

&lt;p&gt;No dobra, ale to chyba nadal nie rozwiÄ…zuje problemu?&lt;/p&gt;

&lt;p&gt;OtÃ³Å¼ &lt;em&gt;nic bardziej mylnego&lt;/em&gt;. Taki zestaw okien moÅ¼na &lt;em&gt;odpiÄ…Ä‡&lt;/em&gt; i rozÅ‚Ä…czyÄ‡ siÄ™ z SSH, a procesy w nim uruchomione nadal bÄ™dÄ… dziaÅ‚aÄ‡. Gdy sesja, w ktÃ³rej byÅ‚ uruchomiony screen zostanie zabita to screen siÄ™ odÅ‚Ä…czy. PÃ³Åºniej moÅ¼na ponownie takiego screena podÅ‚Ä…czyÄ‡ i kontynuowaÄ‡ pracÄ™.&lt;/p&gt;

&lt;p&gt;Najpierw instalacja, wprost z repozytorium odpowiedniego dla uÅ¼ywanej dystrybucji.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;sudo apt-get install screen
sudo pacman -S screen
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;KonfigurowaÄ‡ nie ma co - jedynym powodem do utworzenia pliku konfiguracyjnego jaki miaÅ‚em byÅ‚a chÄ™Ä‡ zmiany domyÅ›lnego skrÃ³tu klawiszowego - Ctrl+a - na coÅ› innego. Ale to byÅ‚o zwiÄ…zane z tym, Å¼e zaczÄ…Å‚em uÅ¼ywaÄ‡ tmuxa, jego domyÅ›lny skrÃ³t mi nie pasowaÅ‚ (Ctrl+b), zmieniÅ‚em go na ten, do ktÃ³rego byÅ‚em przyzwyczajony w screenie wiÄ™c screena teÅ¼ trzeba byÅ‚o zmieniÄ‡, ale to rodziÅ‚o kolejne problemy i przestaÅ‚em tak grzebaÄ‡.&lt;/p&gt;

&lt;p&gt;Teraz czas na uruchomienie. Po prostu wpisujemy&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;screen
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Czyli mamy Ctrl+a, polecenie ktÃ³re rozpoczyna wÅ‚aÅ›ciwy skrÃ³t klawiszowy. Bo w koÅ„cu mamy rÃ³Å¼ne skrÃ³ty klawiszowe w rÃ³Å¼nych aplikacjach i chcielibyÅ›my mÃ³c z nich korzystaÄ‡. O ile w vimie to nie problem, to juÅ¼ w emacsie uÅ¼ywane sÄ… skrÃ³ty z ctrl, a nawet bash ma ich kilka. Dlatego screen uÅ¼ywa takich skrÃ³tÃ³w &amp;ldquo;kolejkowanych&amp;rdquo;. Po wciÅ›niÄ™ciu &lt;code&gt;ctrl+a&lt;/code&gt; dajemy wÅ‚aÅ›ciwy skrÃ³t (np. &lt;code&gt;c&lt;/code&gt;). Screen przyjmie je w dwÃ³ch moÅ¼liwych wariantach i oba obsÅ‚uÅ¼y tak samo - czyli &lt;code&gt;ctrl+a c&lt;/code&gt; oraz &lt;code&gt;ctrl+a ctrl+c&lt;/code&gt; - chodzi o to, czy puÅ›cimy ctrl przed drugim klawiszem czy nie. Dla screena to bez rÃ³Å¼nicy.&lt;/p&gt;

&lt;p&gt;NajwaÅ¼niejszym skrÃ³tem jest &lt;code&gt;ctrl+a d&lt;/code&gt; - jest to odpiÄ™cie screena, czyli zostawiamy go dziaÅ‚ajÄ…cego i wychodzimy do punktu uruchomienia.&lt;/p&gt;

&lt;p&gt;Aby wrÃ³ciÄ‡ do odpiÄ™tego screena wywoÅ‚ajmy&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;screen -r
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;JeÅ¼eli screen jest gdzieÅ› przypiÄ™ty, np. w drugim xtermie to nie pozwoli siÄ™ przypiÄ…Ä‡. WywoÅ‚anie screen bez parametrÃ³w utworzy za to drugiego screena. Wtedy juÅ¼ nawet gdy oba bÄ™dÄ… odpiÄ™te to screen nie bÄ™dzie wiedziaÅ‚ do ktÃ³rego siÄ™ podpiÄ…Ä‡ i wypisze listÄ™ - wtedy naleÅ¼y podaÄ‡ PID procesu do ktÃ³rego chcemy siÄ™ podpiÄ…Ä‡.&lt;/p&gt;

&lt;p&gt;Aby odpiÄ…Ä‡ screena podpiÄ™tego w innym oknie (lub np. w wiszÄ…cej sesji ssh) wywoÅ‚ujemy &lt;code&gt;screen -d&lt;/code&gt;. A jeÅ¼eli chcemy od razu zakoÅ„czyÄ‡ teÅ¼ proces z ktÃ³rego zostaÅ‚ uruchomiony screen, ktÃ³ry odpinamy (czyli np. zamknÄ…Ä‡ tamto okno xterma lub rozÅ‚Ä…czyÄ‡ poÅ‚Ä…czenie SSH) to uÅ¼ywamy &lt;code&gt;screen -D&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Przydatne moÅ¼e byÄ‡ teÅ¼ &lt;code&gt;screen -R&lt;/code&gt;. Oznacza to, Å¼e screen ma siÄ™ podÅ‚Ä…czyÄ‡ do istniejÄ…cej sesji. JeÅ¼eli jest kilka to wypisze moÅ¼liwe do podÅ‚Ä…czenia. Ale jeÅ¼eli nie znajdzie Å¼adnej (Å¼adnej nie ma lub nie ma Å¼adnej niepodÅ‚Ä…czonej) to utworzy nowÄ…. &lt;code&gt;screen -RR&lt;/code&gt; zadziaÅ‚a podobnie, ale jeÅ¼eli znajdzie kilka niepodÅ‚Ä…czonych sesji to podÅ‚Ä…czy siÄ™ do pierwszej z brzegu.&lt;/p&gt;

&lt;p&gt;Opcje &lt;code&gt;-r&lt;/code&gt;, &lt;code&gt;-R&lt;/code&gt; oraz &lt;code&gt;-RR&lt;/code&gt; moÅ¼na Å‚Ä…czyÄ‡ z &lt;code&gt;-d&lt;/code&gt; i z &lt;code&gt;-D&lt;/code&gt;. W takim wypadku uruchomienie &lt;code&gt;screen -D -RR&lt;/code&gt; jest &lt;em&gt;najpotÄ™Å¼niejsze&lt;/em&gt; - bo zawsze da jakÄ…Å› sesjÄ™.&lt;/p&gt;

&lt;p&gt;Teraz wrÃ³Ä‡my do dziaÅ‚ajÄ…cej sesji. JeÅ¼eli zakoÅ„czymy proces w screenie (ctrl+d, exit, logout, &amp;hellip;) to zamkniemy okno w screenie. JeÅ¼eli zamkniemy ostatnie okno to zamkniemy caÅ‚ego screena.&lt;/p&gt;

&lt;p&gt;Aby utworzyÄ‡ nowe okno wywoÅ‚ujemy &lt;code&gt;ctrl+a c&lt;/code&gt;. Pierwsze okno ma numer 0, nastÄ™pne 1 itd. PrzeÅ‚Ä…czanie pomiÄ™dzy oknami osiÄ…gniemy uÅ¼ywajÄ…c &lt;code&gt;ctrl+a 0&lt;/code&gt;, &lt;code&gt;ctrl+a 1&lt;/code&gt; itd. lub &lt;code&gt;ctrl+a n&lt;/code&gt; i &lt;code&gt;ctrl+a p&lt;/code&gt;. Tak samo jak &lt;code&gt;n&lt;/code&gt; zadziaÅ‚a &lt;code&gt;spacja&lt;/code&gt;, a w miejsce &lt;code&gt;p&lt;/code&gt; moÅ¼emy uÅ¼yÄ‡ &lt;code&gt;backspace&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;UÅ¼ycie &lt;code&gt;ctrl+a w&lt;/code&gt; pokaÅ¼e listÄ™ dostÄ™pnych okien.&lt;/p&gt;

&lt;p&gt;Warto teÅ¼ wiedzieÄ‡ jak zabiÄ‡ okno - czasem jakiÅ› proces siÄ™ zawiesi. W xtermie po prostu zamykamy okno, w screenie jest do tego &lt;code&gt;ctrl+a k&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Tak na prawdÄ™ to wszystko co potrzeba wiedzieÄ‡ na starcie. No moÅ¼e jeszcze &lt;code&gt;ctrl+a ?&lt;/code&gt;, ktÃ³re zwrÃ³ci przypisanie klawiszy. A, jeszcze - co jeÅ¼eli potrzebujemy uÅ¼yÄ‡ &lt;code&gt;ctrl+a&lt;/code&gt; w aplikacji otwartej w screenie? uÅ¼ywamy &lt;code&gt;ctrl+a a&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Z bardziej zaawansowanych rzeczy to zdarzyÅ‚o mi siÄ™ jeszcze korzystaÄ‡ z moÅ¼liwoÅ›ci kopiowania w screenie przy uÅ¼yciu klawiatury. Nie tyle do kopiowania ale do przewiniÄ™cia ekranu w gÃ³rÄ™. SÅ‚uÅ¼y do tego &lt;code&gt;ctrl+a [&lt;/code&gt;, nastÄ™pnie przesuwamy ekran strzaÅ‚kami i wciskamy &lt;code&gt;enter&lt;/code&gt; aby rozpoczÄ…Ä‡ kopiowanie. Zaznaczamy obszar uÅ¼ywajÄ…c znÃ³w strzaÅ‚ek i wciskamy ponownie &lt;code&gt;enter&lt;/code&gt;. Teraz tekst jest skopiowany do schowka (ale screenowego, nie tego dostÄ™pnego przez np. xclip). do wklejenia sÅ‚uÅ¼y &lt;code&gt;ctrl+a ]&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Innych funkcji chyba nie zdarzyÅ‚o mi siÄ™ uÅ¼ywaÄ‡, ale polecam mana do screena - jest chyba jednym z lepszych.&lt;/p&gt;

&lt;h2 id=&#34;przenoszenie-procesu-do-screena&#34;&gt;Przenoszenie procesu do screena&lt;/h2&gt;

&lt;p&gt;Teraz coÅ› trochÄ™ trudniejszego - jak przenieÅ›Ä‡ dziaÅ‚ajÄ…cy proces do screena? Czasem okazuje siÄ™, Å¼e jednak proces bÄ™dzie dziaÅ‚aÅ‚ dÅ‚uÅ¼ej. Jak to zrobiÄ‡? BÄ™dzie potrzebne dodatkowe narzÄ™dzie - &lt;code&gt;reptyr&lt;/code&gt;. Czyli&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;sudo apt-get install reptyr
sudo pacman -S reptyr
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;czy co tam macie u siebie. Teraz po kolei:&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;&lt;p&gt;Zatrzymujemy proces (nie koÅ„czymy!!!) &lt;code&gt;Ctrl+z&lt;/code&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Wznawiamy go w tle &lt;code&gt;bg&lt;/code&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Odpinamy go od terminala &lt;code&gt;disown %1&lt;/code&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Odpalamy screena &lt;code&gt;screen&lt;/code&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Znajdujemy PID procesu (pojawiÅ‚ siÄ™ wczeÅ›niej na ekranie albo szukamy przy uzyciu ps, pstree, pgrep, czegokolwiek)&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Przypinamy proces do bieÅ¼Ä…cego terminala &lt;code&gt;reptyr &amp;lt;pid&amp;gt;&lt;/code&gt;&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;Reptyr moÅ¼e nie zadziaÅ‚aÄ‡ - poleci komunikat&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;Unable to attach to pid 52543: Operation not permitted
The kernel denied permission while attaching. If your uid matches
the target&#39;s, check the value of /proc/sys/kernel/yama/ptrace_scope.
For more information, see /etc/sysctl.d/10-ptrace.conf
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Generalnie to jest to zabezpieczenie, aby nie-root nie mÃ³gÅ‚ robiÄ‡ ptrace na procesach nie-potomnych. Aby wyÅ‚Ä…czyÄ‡ to zabezpieczenie odpalamy&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;echo 0 | sudo tee /proc/sys/kernel/yama/ptrace_scope
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;co pozwoli na odpalenie reptyra, a po odpiÄ™ciu screena moÅ¼emy przywrÃ³ciÄ‡ domyÅ›lne ustawienie&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;echo 1 | sudo tee /proc/sys/kernel/yama/ptrace_scope
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Tym sposobem mamy proces przeniesiony do screena. OczywiÅ›cie Å‚atwiej jest proces normalnie uruchomiÄ‡ w screenie, ale czasem nie bardzo moÅ¼emy ubiÄ‡ proces i odpaliÄ‡ go na nowo, wtedy trzeba siÄ™ trochÄ™ bardziej narobiÄ‡&amp;hellip;&lt;/p&gt;

&lt;p&gt;MiÅ‚ego screenowania!&lt;/p&gt;
</description>
    </item>
    
    
    
    <item>
      <title>Programowanie kart inteligentnych - czÄ™Å›Ä‡ 2 - komunikacja</title>
      <link>https://kamm.github.io/2018/05/javacard-2/</link>
      <pubDate>Fri, 25 May 2018 08:54:15 CEST</pubDate>
      <author>Kamil MÄ™trak</author>
      <guid>https://kamm.github.io/2018/05/javacard-2/</guid>
      <description>&lt;p&gt;W poprzednim odcinku utworzyÅ‚em bardzo prosty aplet na karcie i wywoÅ‚aÅ‚em go z poziomu gpshell. Jednak to jest dobre do testÃ³w. W koÅ„cu karta ma byÄ‡ wykorzystywana w kryptografii w konkretnej aplikacji.&lt;/p&gt;

&lt;p&gt;StworzyÅ‚em bardzo prostego klienta do apletu - &lt;a href=&#34;https://github.com/kamm/jcapp1client&#34;&gt;jcapp1client&lt;/a&gt;. Aplikacja Å‚Ä…czy siÄ™ z pierwszy z brzegu czytnikiem, wybiera kartÄ™ do niego wÅ‚oÅ¼onÄ…, wybiera aplet i wywoÅ‚uje instrukcjÄ™ B0 01. Nawet bez Å¼adnego sprawdzania bÅ‚Ä™dÃ³w, kodÃ³w wyjÅ›cia, nic. ProÅ›ciej siÄ™ chyba nieda.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;public static void main( String[] args )
    {
        try {
            byte[] appletId = {(byte) 0xbb, (byte) 0xbb, (byte) 0xcc, (byte) 0xdd, (byte) 0xee, (byte) 0x01, (byte) 0x01};
            TerminalFactory factory = TerminalFactory.getDefault();
            CardTerminal terminal = factory.terminals().list().get(0);
            
            Card card = terminal.connect(&amp;quot;*&amp;quot;);
            CardChannel channel = card.getBasicChannel();

            CommandAPDU apdu = null;
            ResponseAPDU rapdu = null;
            apdu = new CommandAPDU(0x00, 0xA4, 0x04, 0x00, appletId);
            rapdu = channel.transmit(apdu);
            apdu = new CommandAPDU(0xB0, 0x01, 0x00, 0x00, 13);
            rapdu = channel.transmit(apdu);

            System.out.println(new String(rapdu.getData()));

            card.disconnect(false);
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Najpierw to uruchomiÅ‚em pod windowsem. DziaÅ‚a od rÄ™ki, Å¼adnych zgrzytÃ³w. No moÅ¼e poza sytuacjÄ… gdy miaÅ‚em podÅ‚Ä…czony drugi czytnik (jeden jest wbudowany w laptopa, drugi podÅ‚Ä…czyÅ‚em po USB). Wtedy lista zwracana przez factory.terminals().list() jest w kolejnoÅ›ci raczej losowej.&lt;/p&gt;

&lt;p&gt;PÃ³Åºniej sprÃ³bowaÅ‚em to uruchomiÄ‡ pod linuksem. WaÅ¼ne - czytnik mi dziaÅ‚a pod linuksem, go potwierdziÅ‚em uÅ¼ywaniem gpshell czy pcsc_scan. Jednak po uruchomieniu dostaÅ‚em&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ java -cp target/jcappclient-1.0-SNAPSHOT.jar pl.kamm.jcapp1client.App
java.lang.IndexOutOfBoundsException: Index: 0
        at java.util.Collections$EmptyList.get(Collections.java:4454)
        at pl.kamm.jcapp1client.App.main(App.java:18)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;SzukaÅ‚em, szukaÅ‚em i znalazÅ‚em. Trzeba dodaÄ‡ namiary na bibliotekÄ™ libpcsclite&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ java -Dsun.security.smartcardio.library=/usr/lib/x86_64-linux-gnu/libpcsclite.so.1 -cp target/jcappclient-1.0-SNAPSHOT.jar pl.kamm.jcapp1client.App
Hello, world!
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;i zaczyna dziaÅ‚aÄ‡. Tyle na dzisiaj. KrÃ³tko.&lt;/p&gt;
</description>
    </item>
    
    
    
    <item>
      <title>Programowanie kart inteligentnych - czÄ™Å›Ä‡ 1 - pierwszy program</title>
      <link>https://kamm.github.io/2018/05/javacard-1/</link>
      <pubDate>Wed, 23 May 2018 10:52:15 CEST</pubDate>
      <author>Kamil MÄ™trak</author>
      <guid>https://kamm.github.io/2018/05/javacard-1/</guid>
      <description>&lt;p&gt;Czas zaczÄ…Ä‡ programowaÄ‡. Karty, ktÃ³re mnie intereujÄ… i ktÃ³re zamÃ³wiÅ‚em programuje siÄ™ w Javie. SÄ… teÅ¼ inne, chyba dotnetowe, ale siÄ™ nie znam. ZajmÄ™ siÄ™ tylko kartami javoskimi, a dokÅ‚adniej bÄ™dÄ™ uzywaÅ‚ Java Card Kit w wersji 2.2.2. Do pobrania ze strony Oracla: &lt;a href=&#34;http://www.oracle.com/technetwork/java/embedded/javacard/downloads/javacard-sdk-2043229.html&#34;&gt;JavaCard SDK&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Programy wgrane na kartÄ™ sÄ… apletami, ale nie ma to nic (poza nazwÄ…) zwiÄ…zku z java.applet.Applet. Tu mamy javacard.framework.Applet. Generalnie - javacard jest mocno ograniczonÄ… javÄ…. Nie ma longa, nie ma double&amp;rsquo;a, nie ma stringa. ÅÄ…cznie javadoc do wersji 2.2.2 podaje, Å¼e istniejÄ… 93 klasy, a w zasadzie to 60 klas i 33 interfejsy zdefiniowane w ramach biblioteki standardowej. TrochÄ™ maÅ‚o. Dodatkowo ogranicza nas maÅ‚a pamiÄ™Ä‡ karty i wymagania aby dziaÅ‚aÅ‚o to moÅ¼liwie najszybciej. W efekcie programy wyglÄ…dajÄ… jak kod pisany dla mikrokontrolerÃ³w 8 bitowych.&lt;/p&gt;

&lt;p&gt;Do napisania i skompilowania kodu apletu bÄ™dzie potrzeba:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Java Card Kit, wersja 2.2.2&lt;/li&gt;
&lt;li&gt;Java SDK (wersja praktycznie dowolna, dokÅ‚adniej &amp;gt;= 1.3)&lt;/li&gt;
&lt;li&gt;Apache Ant - co prawda mozna by siÄ™ pobawiÄ‡ z mavenem, ale to sztuka dla sztuki&lt;/li&gt;
&lt;li&gt;gpshell w Å›cieÅ¼ce uruchamiania (dla wygody)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Przyjrzyjmy siÄ™ najprostszemu appletowi&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;package pl.kamm;

import javacard.framework.Applet;
import javacard.framework.APDU;
import javacard.framework.ISO7816;
import javacard.framework.ISOException;
import javacard.framework.Util;


public class HelloWorldApplet extends Applet {
    
    //Definicja klasy instrukcji
    protected static final byte CLA = (byte) 0xb0;

    //Definiacja identyfikatora instrukcji
    protected static final byte INS_HELLO = (byte) 0x01;

    //ObsÅ‚uga instrukcji HELLO
    private void processHello(APDU apdu){
        byte buffer[] = apdu.getBuffer();

        //Sprawdzenie czy argumenty P1 i P2 sÄ… rÃ³wne 0x00
        if (Util.getShort(buffer, ISO7816.OFFSET_P1) != (short) 0x0000){ 
            ISOException.throwIt(ISO7816.SW_INCORRECT_P1P2);
        }

        // Zbudowanie tablicy bajtÃ³w &amp;quot;Hello, world!&amp;quot;
        byte [] b = {0x48, 0x65, 0x6c, 0x6c, 0x6f, 0x2c, 0x20, 0x77, 0x6f, 0x72, 0x6c, 0x64, 0x21};

        //Skopiowanie do bufora
        Util.arrayCopy(b,(byte)0,buffer,(byte)0,(byte)b.length); 

        //WysÅ‚anie bufora
        apdu.setOutgoingAndSend((short) 0, (short) b.length); 
    }

    public void process(APDU apdu) {
        //W przypadku operacji wybierania apletu nie rÃ³b nic
        if (selectingApplet()){
            return;
        }

        //Pobranie bufora danych
        byte buffer[] = apdu.getBuffer();

        //ObsÅ‚ugujemy tylko jednÄ…, okreÅ›lonÄ… klasÄ™ instrukcji
        if (buffer[ISO7816.OFFSET_CLA] != (CLA)){
            ISOException.throwIt(ISO7816.SW_CLA_NOT_SUPPORTED);
        }

        //Na podstawie identyfikatora instrukcji wywoÅ‚ujemy obsÅ‚ugujÄ…cÄ… jÄ… funkcjÄ™
        switch (buffer[ISO7816.OFFSET_INS]){ 
            case INS_HELLO:
                processHello(apdu);
                break;
            default:
                ISOException.throwIt(ISO7816.SW_INS_NOT_SUPPORTED);
                break;
        }
    }

    private HelloWorldApplet(byte bArray[], short bOffset, byte bLength) {
    }

    public static void install(byte bArray[], short bOffset, byte bLength) {
        HelloWorldApplet ai = new HelloWorldApplet(bArray, bOffset, bLength);

        if (bArray[bOffset] == 0) {
            ai.register();
        } else {
            ai.register(bArray, (short) (bOffset + 1), bArray[bOffset]);
        }
    }
}

&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;NajwaÅ¼niejszÄ… funkcjÄ… appletu jest metoda process. Zajmuje siÄ™ ona obsÅ‚ugÄ… komendy APDU wysÅ‚anej z terminala. W tym wypadku jest obsÅ‚ugiwana jedna komenda APDU - o klasie 0xb0 i identyfikatorze instrukcji 0x01. Ta instrukcja wymaga jako parametrÃ³w P1 i P2 wartoÅ›ci 0x00 (sÄ… one wartoÅ›ciami jednobajtowymi, ale sprawdzenie odbywa siÄ™ poprzez sprawdzenie wartoÅ›ci dwubajtowej, zawierajÄ…cej zarÃ³wno P1 jak i P2). Nie potrzebuje ona dodatkowych danych, ale nie jest to sprawdzane - sÄ… one ignorowane. Po wywoÅ‚aniu prawidÅ‚owym zachowanie jest zwrÃ³cenie tablicy bajtÃ³w, ktÃ³re w reprezentacji ASCII dajÄ… &amp;ldquo;Hello, world!&amp;rdquo;.&lt;/p&gt;

&lt;p&gt;Teraz trzeba to skompilowaÄ‡. Kompilacja jest caÅ‚kiem normalna, trzeba tylko pamiÄ™taÄ‡ o dodaniu jarÃ³w z JavaCard Kit (javacardframework.jar, api.jar).&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;  &amp;lt;path id=&amp;quot;classpath.jcapi&amp;quot;&amp;gt;
    &amp;lt;pathelement location=&amp;quot;${env.JC_HOME}/api_export_files&amp;quot; /&amp;gt;
    &amp;lt;pathelement location=&amp;quot;${env.JC_HOME}/lib/javacardframework.jar&amp;quot; /&amp;gt;
    &amp;lt;pathelement location=&amp;quot;${env.JC_HOME}/lib/api.jar&amp;quot; /&amp;gt;
  &amp;lt;/path&amp;gt;
....
    &amp;lt;javac srcdir=&amp;quot;${src.dir}&amp;quot;
      destdir=&amp;quot;${build.dir}/bin&amp;quot;
      debug=&amp;quot;true&amp;quot;
      optimize=&amp;quot;true&amp;quot;
      includeantruntime=&amp;quot;false&amp;quot;
      target=&amp;quot;1.1&amp;quot;
      source=&amp;quot;1.3&amp;quot;&amp;gt;
      &amp;lt;classpath&amp;gt;
        &amp;lt;pathelement path=&amp;quot;${build.dir}/bin&amp;quot;/&amp;gt;
      &amp;lt;/classpath&amp;gt;
      &amp;lt;classpath refid=&amp;quot;classpath.jcapi&amp;quot; /&amp;gt;
    &amp;lt;/javac&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;NastÄ™pnie trzeba przekonwertowaÄ‡ pliki class do archiwum cap. cap jest zipem, podobnie do jara i ma podobnÄ… strukturÄ™, ale przechowuje pliki przetworzone (nota bene teÅ¼ z rozszerzeniem cap, ktÃ³re juÅ¼ zipami nie sÄ…). SÄ… to przetworzone pliki class. Taki plik juz moÅ¼na wgraÄ‡ na kartÄ™ przy uzyciu np gpshell.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;  &amp;lt;path id=&amp;quot;classpath.jctools&amp;quot;&amp;gt;
    &amp;lt;pathelement location=&amp;quot;${env.JC_HOME}/lib/converter.jar&amp;quot; /&amp;gt;
    &amp;lt;pathelement location=&amp;quot;${env.JC_HOME}/lib/offcardverifier.jar&amp;quot; /&amp;gt;
    &amp;lt;pathelement location=&amp;quot;${env.JC_HOME}/lib/scriptgen.jar&amp;quot; /&amp;gt;
    &amp;lt;pathelement location=&amp;quot;${env.JC_HOME}/lib/apdutool.jar&amp;quot; /&amp;gt;
    &amp;lt;pathelement location=&amp;quot;${env.JC_HOME}/lib/apduio.jar&amp;quot; /&amp;gt;
    &amp;lt;pathelement location=&amp;quot;${env.JC_HOME}/lib/tools.jar&amp;quot; /&amp;gt; &amp;lt;!-- 3.0 --&amp;gt;
  &amp;lt;/path&amp;gt;
....
    &amp;lt;java classname=&amp;quot;com.sun.javacard.converter.Converter&amp;quot; fork=&amp;quot;true&amp;quot; failonerror=&amp;quot;true&amp;quot;&amp;gt;
      &amp;lt;classpath refid=&amp;quot;classpath.jcapi&amp;quot; /&amp;gt;
      &amp;lt;classpath refid=&amp;quot;classpath.jctools&amp;quot; /&amp;gt;
      &amp;lt;arg value=&amp;quot;-verbose&amp;quot; /&amp;gt;
      &amp;lt;arg value=&amp;quot;-classdir&amp;quot; /&amp;gt;
      &amp;lt;arg value=&amp;quot;${build.dir}/bin/&amp;quot; /&amp;gt;
      &amp;lt;arg value=&amp;quot;-out&amp;quot; /&amp;gt;
      &amp;lt;arg value=&amp;quot;JCA&amp;quot; /&amp;gt;
      &amp;lt;arg value=&amp;quot;CAP&amp;quot; /&amp;gt;
      &amp;lt;arg value=&amp;quot;EXP&amp;quot; /&amp;gt;
      &amp;lt;arg value=&amp;quot;-applet&amp;quot; /&amp;gt;
      &amp;lt;arg value=&amp;quot;${javacard.applet.aid}&amp;quot; /&amp;gt;
      &amp;lt;arg value=&amp;quot;${javacard.applet.name}&amp;quot; /&amp;gt;
      &amp;lt;arg value=&amp;quot;${javacard.package.name}&amp;quot; /&amp;gt;
      &amp;lt;arg value=&amp;quot;${javacard.package.aid}&amp;quot; /&amp;gt;
      &amp;lt;arg value=&amp;quot;${javacard.major.version}.${javacard.minor.version}&amp;quot; /&amp;gt;
    &amp;lt;/java&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Aby uÅ‚atwiÄ‡ sobie robotÄ™ mam utworzony skrypt w ancie, ktÃ³ry odwala kompilacjÄ™, konwersjÄ™, wygenerowanie skryptÃ³w wgrywajÄ…cych czy teÅ¼ samo wgranie na kartÄ™ lub do emulatora (o emulatorze kiedy indziej).&lt;/p&gt;

&lt;p&gt;Aby wrzuciÄ‡ plik cap na kartÄ™ naleÅ¼y wydaÄ‡ kilka pojeceÅ„. Jak kilka to najlepiej opakowaÄ‡ to w skrypt, np taki&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;# gpshell script for jcop 2.4.1 applet load (default keys)
mode_211
enable_trace
establish_context
card_connect
select -AID A0000000030000
open_sc -security 1 -mac_key 404142434445464748494a4b4c4d4e4f -enc_key 404142434445464748494a4b4c4d4e4f
delete -AID bbbbccddee0101
delete -AID bbbbccddee01
install -file jcapp_1.cap -instParam 31323334 -sdAID a000000003000000 -priv 2
card_disconnect
card_connect
select -AID bbbbccddee0101
card_disconnect
release_context 
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Kilka uwag - klucz do makowania i szysforwania (404142434445464748494a4b4c4d4e4f) zostaÅ‚ dla karty ustalony podczas inicjalizacji. Najpierw wybieramy aplet JCOS (JavaCardOparatingSystem), czyli A0000000030000. Kasujemy stary applet (bbbbccddee01) i jego instancjÄ™ (bbbbccddee0101). NastÄ™pnie instalujemy plik jcapp_1.cap. Po rozÅ‚Ä…czeniu i ponownym poÅ‚Ä…czeniu wybieramy ten aplet aby go uruchomiÄ‡.&lt;/p&gt;

&lt;p&gt;No dobra, ale czy to dziaÅ‚a? Aby to sprawdziÄ‡ potrzebujemy kolejnego skryptu gpsh.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;mode_211
enable_trace
establish_context
card_connect

#Wybranie apletu
#send_apdu -sc 0 -APDU 00A4040007bbbbccddee010100
select -AID bbbbccddee0101

#WysÅ‚anie komendy CLA=B0, INS=01, P1=00, P2=00, brak danych, spodziewamy siÄ™ 13 bajtÃ³w
send_apdu -sc 0 -APDU B00100000D

card_disconnect
release_context
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;W tym skrypcie wybieramy aplet (zakomentowany jest drugi sposÃ³b) a nastÄ™pnie wywoÅ‚ujemy instrukcjÄ™ CLA=B0, INS=01.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;mode_211
enable_trace
establish_context
card_connect
select -AID bbbbccddee0101
Command --&amp;gt; 00A4040007BBBBCCDDEE0101
Wrapped command --&amp;gt; 00A4040007BBBBCCDDEE0101
Response &amp;lt;-- 9000
send_apdu -sc 0 -APDU B00100000D
Command --&amp;gt; B00100000D
Wrapped command --&amp;gt; B00100000D
Response &amp;lt;-- 48656C6C6F2C20776F726C64219000
send_APDU() returns 0x80209000 (9000: Success. No error.)
card_disconnect
release_context
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;DomyÅ›lnie gpshell ma wÅ‚Ä…czone echo wiÄ™c wszystkie polecenia sÄ… widoczne. NajwaÅ¼niejsza linia to&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;Response &amp;lt;-- 48656C6C6F2C20776F726C64219000
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Jest to zwrotna wartoÅ›Ä‡ APDU. Ta akurat ma 15 bajtÃ³w. Pierwsze 13 to &amp;ldquo;Hello, world!&amp;rdquo; z karty. NastÄ™pnie sÄ… dwa bajty kodu bÅ‚Ä™du. sÄ… to 90 00, co w przypadku kart oznacz brak bÅ‚Ä™du. Fajnie, dziaÅ‚a.&lt;/p&gt;

&lt;p&gt;W nastÄ™pnych czÄ™Å›ciach napiszÄ™ maÅ‚y program kliencki w javie oraz omÃ³wiÄ™ APDU.&lt;/p&gt;

&lt;p&gt;CaÅ‚y projekt dostÄ™pny na github &lt;a href=&#34;http://github.com/kamm/jcapp_1&#34;&gt;http://github.com/kamm/jcapp_1&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
    
    
    <item>
      <title>Programowanie kart inteligentnych - czÄ™Å›Ä‡ 0 - inicjalizacja</title>
      <link>https://kamm.github.io/2018/05/javacard-0/</link>
      <pubDate>Tue, 22 May 2018 11:02:15 &#43;0100</pubDate>
      <author>Kamil MÄ™trak</author>
      <guid>https://kamm.github.io/2018/05/javacard-0/</guid>
      <description>&lt;p&gt;Zaczynam naukÄ™ programowania kart inteligentnych. SÄ… to karty do przechowywania kluczy kryptograficznych, certyfikatÃ³w a takÅ¼e innych danych. Do tego celu potrzebowaÅ‚em zamÃ³wiÄ‡ kilka takich kart.&lt;/p&gt;

&lt;p&gt;&lt;/p&gt;

&lt;p&gt;Po wpisaniu na aliexpress J2A040 znajdziemy ich wiele i w kaÅ¼dym ogloszeniu jest coÅ› w stylu&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;We can only provide the TK default value (Transport key) ,like: .
Before you use JCOP Card,you need 2 commands for opening the JCOP21-40K card.
here is :
APDU:00A4040010( TK - KEY )
APDU:00F00000 ( open for Initialize )
If you donâ€™t know how to use it ,please donâ€™t order it! Otherwise, we will not be responsible for the return.
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Dobra, rozumiem, Å¼e tak siÄ™ zabezpieczajÄ… przed osobami, ktÃ³re myÅ›lÄ…, Å¼e to od razu bedzie dziaÅ‚aÄ‡ &amp;ldquo;automagicznie&amp;rdquo;. Nie ma tak Å‚atwo.&lt;/p&gt;

&lt;p&gt;Po pierwsze karta jest zabezpieczona kluczem transportowym. Jest on na doÅ‚Ä…czonej pÅ‚ycie CD. Fajnie, chociaÅ¼ poprawnie to klucz transportowy (dalej bÄ™dÄ™ go po prostu nazywaÅ‚ TK) powinien byÄ‡ wysÅ‚any innym kanaÅ‚em (np. mailem), ale mniejsza z tym - kart nie bÄ™dÄ™ uÅ¼ywaÅ‚ produkcyjnie, a bardziej do celÃ³w deweloperskich i testowych.&lt;/p&gt;

&lt;p&gt;Po drugie karta jest niezainicjalizowana - chociaÅ¼ tego nie jestem pewien, bo przedtawiaÅ‚a siÄ™ jako Nigerian ID. Mniejsza z tym - kasujemy wszystko.&lt;/p&gt;

&lt;p&gt;Do zabawy potrzebne sÄ…:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;czytnik kart - to akurat wiadome&lt;/li&gt;
&lt;li&gt;narzÄ™dzie gpshell &lt;a href=&#34;https://sourceforge.net/projects/globalplatform/&#34;&gt;https://sourceforge.net/projects/globalplatform/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;PeÅ‚ny skrypt do inicjalizacji:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;mode_211
enable_trace
establish_context
card_connect

#Oblokowanie z klucza transportowego
send_apdu -sc 0 -APDU 00A4040010&amp;lt;TK&amp;gt;

#Wyczyszczenie karty
send_apdu -sc 0 -APDU 00F00000

#Ustawienie protokoÅ‚u transmisji T=1
send_apdu -sc 0 -APDU C0D6012301DA
send_apdu -sc 0 -APDU C0D6014601DA
send_apdu -sc 0 -APDU C0D6012201FE
send_apdu -sc 0 -APDU C0D60124010F
send_apdu -sc 0 -APDU C0D60147010F

#Ustawienie ATR jako J 2 A 0 8 1 , T = 1
send_apdu -sc 0 -APDU c0d601370b0a4a32413038312C543D31
send_apdu -sc 0 -APDU c0d6015A0b0a4a32413038312C543D31

#Ustawienie klucza zarzÄ…dczego na domyÅ›lnÄ… wartoÅ›Ä‡ 404142434445464748494a4b4c4d4e4f (tylko na potrzebny testowe/deweloperskie)
send_apdu -sc 0 -APDU c0d6030510404142434445464748494a4b4c4d4e4f
send_apdu -sc 0 -APDU c0d6032110404142434445464748494a4b4c4d4e4f
send_apdu -sc 0 -APDU c0d6033D10404142434445464748494a4b4c4d4e4f
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Zapisujemy plik jako initialize.gpsh i uruchamiamy&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;gpshell initialize.gpsh
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Teraz moÅ¼na zaczÄ…Ä‡ siÄ™ bawiÄ‡. Taka karta nie zostanie zablokowana - zawsze moÅ¼na wsyztsko skasowaÄ‡ i wgraÄ‡ ponownie.&lt;/p&gt;

&lt;p&gt;Na podstawie &lt;a href=&#34;https://www.curriegrad2004.ca/2017/02/dealing-with-unfused-jcop-java-cards-sold-from-aliexpress-or-ebay/&#34;&gt;https://www.curriegrad2004.ca/2017/02/dealing-with-unfused-jcop-java-cards-sold-from-aliexpress-or-ebay/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;W nastÄ™pnym wpisie bÄ™dzie prosty aplet na kartÄ™, a pÃ³Åºniej trochÄ™ kodu w &amp;ldquo;normalnej&amp;rdquo; javie - czyli komunikacja z apletem.&lt;/p&gt;</description>
    </item>
    
    
    
    <item>
      <title>ack</title>
      <link>https://kamm.github.io/2016/12/ack/</link>
      <pubDate>Tue, 27 Dec 2016 21:10:15 CET</pubDate>
      <author>Kamil MÄ™trak</author>
      <guid>https://kamm.github.io/2016/12/ack/</guid>
      <description>&lt;p&gt;Przeszukiwanie kodu z konsoli jest problemem. Ja najczÄ™Å›ciej uÅ¼ywaÅ‚em dziwnej skÅ‚adni&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;find . -type f | while read l; do grep -Ri &amp;quot;System.err&amp;quot; $l &amp;amp;&amp;amp; echo $l; done
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;DziaÅ‚aÄ‡ dziaÅ‚a, ale jest nieeleganckie, nieefektywne, ma brzydkie wyjÅ›cie, duÅ¼o bÅ‚Ä™dnych wystÄ…pieÅ„ (pliki binarne, pliki gita/svna). SÅ‚owem - szybki hack.&lt;/p&gt;

&lt;p&gt;Ze wzglÄ™du na moje lenistwo nie chciaÅ‚o mi siÄ™ szukaÄ‡ niczego innego, a okazaÅ‚o siÄ™ Å¼e byÅ‚o warto. O acku dowiedziaÅ‚em siÄ™ z prezentacji babuna.&lt;/p&gt;

&lt;p&gt;Teraz kilka krÃ³tkich informacji:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;pomija pliki niebÄ™dÄ…ce kodem (jak np. pliki gita czy svna)&lt;/li&gt;
&lt;li&gt;jest szybki&lt;/li&gt;
&lt;li&gt;jest nastawiony na przeszukiwanie kodu - ale nie &amp;ldquo;promuje&amp;rdquo; Å¼adnego jÄ™zyka&lt;/li&gt;
&lt;li&gt;jest przenoÅ›ny - napisany w perlu, ja go uzywam na linuksie i widzie i nie mam problemu&lt;/li&gt;
&lt;li&gt;uÅ‚atwia przeszukiwanie tylko okreÅ›lonych zasobÃ³w - tu moÅ¼e kilka sÅ‚Ã³w wiÄ™cej.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Generalnie - rzadko kiedy mamy projekt robiony tylko uÅ¼ywajÄ…c jednej technologii. Do projektu javowego dodany SQL czy teÅ¼ moje najczÄ™stsze poÅ‚Ä…czenie ostatnimi czasy czyli xsl + xsl. Do tego wystarczy dodaÄ‡ prarametr&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;ack --java System.err
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;CoÅ› takiego znajdzie wystÄ…pienia System.err w plikach java, ale juÅ¼ pliki tekstowe odrzuci.&lt;/p&gt;

&lt;p&gt;W razie czego - wiem Å¼e istnieje silver searcher (ag), ale jeszcze nie miaÅ‚em czasu go sprawdziÄ‡ :)&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://beyondgrep.com/&#34;&gt;http://beyondgrep.com/&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
    
    
    <item>
      <title>Babun - windowsowy shell w ktÃ³rym siÄ™ zakochasz</title>
      <link>https://kamm.github.io/2016/11/babun-shell-w-ktorym-sie-zakochasz/</link>
      <pubDate>Tue, 29 Nov 2016 19:30:51 CET</pubDate>
      <author>Kamil MÄ™trak</author>
      <guid>https://kamm.github.io/2016/11/babun-shell-w-ktorym-sie-zakochasz/</guid>
      <description>&lt;p&gt;Shell jest narzÄ™dziem potrzebnym w pracy chyba kaÅ¼demu programiÅ›cie. OczywiÅ›cie, wiele IDE juÅ¼ prÃ³bowaÅ‚o zmieniÄ‡ to podejÅ›cie integrujÄ…c narzÄ™dzia do postaci klikanych rozwiÄ…zaÅ„, integracji gita czy mavena do edytora, ale nadal stary, poczciwy shell ma siÄ™ dobrze. Jednak pojawia siÄ™ pewne &amp;ldquo;ale&amp;rdquo;. UÅ¼ywanie w windowsie cmd jest problematyczne - kopiowanie i wklejanie jest bardzo utrudnione, zaznaczenie tekstu jeszcze bardziej a obsÅ‚uga historii wywoÅ‚aÅ„ jest na szczÄ…tkowym poziomie. Podobno powershell wiele z tych rzeczy rozwiÄ…zuje, ale i tak - unixowy shell jest tym, co programiÅ›ci lubiÄ….&lt;/p&gt;

&lt;p&gt;Od czasu mojego powrotu do Å›wiata windowsa minÄ™Å‚o juÅ¼ 11 lat - wczÄ™sniej przez kilka lat uÅ¼ywaÅ‚em tylko linuksa. MiaÅ‚em epizod na macu, ale to inna sprawa. PoczÄ…tkowo uÅ¼ywaÅ‚em kilku narzÄ™dzi przeniesionych do Å›wita windowsowego, czyli miaÅ‚em ls, wget i takie tam pod windowsem. PÃ³Åºniej odkryÅ‚em cygwina. ByÅ‚o lepiej, ale nadal ograniczaÅ‚ mnie sam emulator terminala - bo w koÅ„cu miaÅ‚em wszystkie narzÄ™dzia, ale samo okienko byÅ‚o nadal toporne. UÅ¼ywaÅ‚em przez pewien czas console2, aÅ¼ trafiÅ‚em na puttycyg, czyli fork putty&amp;rsquo;iego, ale z moÅ¼liwoÅ›ciÄ… dziaÅ‚ania jako emulator terminala do cygwina. Niestety, projekt przestaÅ‚ byÄ‡ rozwijany, ale i tak uÅ¼ywaÅ‚em go przez kilka lat.&lt;/p&gt;

&lt;p&gt;Ostatnio trafiÅ‚em w firmie na szkolenie. Jednym z elementÃ³w byÅ‚ git. To co prawda znam (moÅ¼e nei rewelacyjnie, ale i tak poziom byÅ‚ podstawowy) i uÅ¼ywam, ale byÅ‚o kilka osÃ³b &amp;ldquo;Å›wieÅ¼ych&amp;rdquo;. PotrzebowaÅ‚y one zainstalowaÄ‡ sibie gita na windowsie. ProwadzÄ…cy poleciÅ‚ babuna. Sam teÅ¼ siÄ™ nim zainteresowaÅ‚em i po instalacji zakochaÅ‚em siÄ™ w nim. Ale po kolei.&lt;/p&gt;

&lt;p&gt;Czym jest babun? Jest to cygwin instalowany w katalogu uÅ¼ytkownika (nie wymaga nawet uprawnieÅ„ administracyjnych) z masÄ… dodatkÃ³w. Przychodzi domyÅ›lnie z zainstalowanÄ… juÅ¼ duÅ¼Ä… liczbÄ… pakietÃ³w, jak chociaÅ¼by git, wget, curl. Z domyÅ›lnie zainstalowanym zsh razem z oh-my-zsh. Z menedÅ¼erem pakietÃ³w obsÅ‚ugiwanym z wiersza poleceÅ„. KrÃ³tko mÃ³wiÄ…c jest to cygwin na sterydach.&lt;/p&gt;

&lt;p&gt;Najlepiej obejrzeÄ‡ sobie filmy&lt;/p&gt;

&lt;p&gt;
&lt;div style=&#34;position: relative; padding-bottom: 56.25%; padding-top: 30px; height: 0; overflow: hidden;&#34;&gt;
  &lt;iframe src=&#34;//player.vimeo.com/video/95045348&#34; style=&#34;position: absolute; top: 0; left: 0; width: 100%; height: 100%;&#34; webkitallowfullscreen mozallowfullscreen allowfullscreen&gt;&lt;/iframe&gt;
 &lt;/div&gt;


&lt;div style=&#34;position: relative; padding-bottom: 56.25%; padding-top: 30px; height: 0; overflow: hidden;&#34;&gt;
  &lt;iframe src=&#34;//www.youtube.com/embed/5YbE07aDDDc&#34; style=&#34;position: absolute; top: 0; left: 0; width: 100%; height: 100%;&#34; allowfullscreen frameborder=&#34;0&#34; title=&#34;YouTube Video&#34;&gt;&lt;/iframe&gt;
 &lt;/div&gt;
&lt;/p&gt;

&lt;p&gt;Jeszcze jedna sprawa - Projekt jest stworzony przez polakÃ³w, co przynajmniej dla mnie jest jego kolejnym plusem :)&lt;/p&gt;
</description>
    </item>
    
    
    
    
    
    <item>
      <title>Deweloperski Datapower</title>
      <link>https://kamm.github.io/2016/11/deweloperski-datapower/</link>
      <pubDate>Wed, 23 Nov 2016 22:35:52 CET</pubDate>
      <author>Kamil MÄ™trak</author>
      <guid>https://kamm.github.io/2016/11/deweloperski-datapower/</guid>
      <description>&lt;p&gt;Datapower to XML Appliance. ZresztÄ… mniejsza z tym co to jest, bo sam pewnie nie ogarniam wszystkich jego zastosowaÅ„ i moÅ¼liwoÅ›ci. Z mojej strony jest wykorzystywany jako Å›rodowisko do tworzenia wydajnych usÅ‚ug w oparciu o XSLT. Wszystko fajnie, ale pozostaje kwestia uruchomienia. Na maszynie fizycznej? Marnie - tam jest m. in. produkcja i nikt mi nie pozwoli robiÄ‡ tam developmentu. Na maszynie wirtualnej - spoko, mamy jednÄ… sztukÄ™ licencji na wirtualkÄ™. Ale - juÅ¼ parÄ™ razy miaÅ‚em problem z innymi osobami. A to ktoÅ› zmieniÅ‚ mi w czasie testÃ³w datasource&amp;rsquo;a, a to ktoÅ› wywaliÅ‚ port http.&lt;/p&gt;

&lt;p&gt;Ze wzglÄ™du na licencjÄ™ nie mogÅ‚em sobie postawiÄ‡ lokalnego DP na lapku. A nawet gdybym postawiÅ‚ - to maszyna wirtualna startowaÅ‚a kilka minut, zajmowaÅ‚a sporo ramu i nie moÅ¼na na niej byÅ‚o zrobiÄ‡ i tak nic innego.&lt;/p&gt;

&lt;p&gt;I tak siÄ™ mÄ™czyÅ‚em aÅ¼ poszedÅ‚em na szkolenie :) Szkolenie byÅ‚o nt. devops - co to jest, z czym to siÄ™ je, jakie sÄ… uÅ¼ywane narzÄ™dzia itp. Jednym z pokazanych narzÄ™dzi byÅ‚ docker. Nie rozumiaÅ‚em jak on dziaÅ‚aÅ‚ i generalnie nie miaÅ‚em do niego przekonania - jestem zawsze sceptycznie nastawiony do &amp;ldquo;nowinek&amp;rdquo;. W pewnej chwili kumpel wpisaÅ‚ sobie w konsoli&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ docker search datapower
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;i pojawiÅ‚a siÄ™ lista.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;NAME                              DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED
ibmcom/datapower                  IBM DataPower Gateway                           36
ramakrishnasanku/datapower_demo                                                   1
garytu/datapower                  Enable WebGUI for ibmcom/datapower              0
patrocinio/datapower                                                              0

&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Nie do koÅ„ca rozumiaÅ‚em co to ma byÄ‡. Po chwili zostaÅ‚em wyrwany ze szkolenia i musiaÅ‚em coÅ› z kimÅ› pogadaÄ‡. TrafiÅ‚em do nowych architektÃ³w i tam dziewczyna mi pokazuje odpalonego u siebie datapowera. Z dockera. ZebraÅ‚em szczÄ™kÄ™ z podÅ‚ogi, wrÃ³ciÅ‚Ä™m na szkolenie, tym razem dajÄ…c dockerowi szansÄ™. Wszystko piÄ™knie - jest ostÄ™pny na dockerze obraz zawierajÄ…cy datapowera. NajnowszÄ… wersjÄ™ - nowszÄ… niÅ¼ aktualnie mamy na produkcji.&lt;/p&gt;

&lt;p&gt;Pierwszy raz od lat przeczytaÅ‚em licencjÄ™ - obraz jest typowo do zastosowaÅ„ deweloperskich i testÃ³w jednostkowych - czyli wszystko co mi jest potrzebne.&lt;/p&gt;

&lt;p&gt;OczywiÅ›cie, jako Å¼e pracujÄ™ na window$ie to docker mi nie zadziaÅ‚a bezpoÅ›rednio - muszÄ™ mieÄ‡ wirtualkÄ™ z linuksem - jednak w takim rozwiÄ…zaniu ejst to znacznie lÅ¼ejsze niÅ¼ wirtualny DP. Nie jest to juÅ¼ wirtualka tylko na DP, ale teÅ¼ na wszystko co wymaga linuksa, a nie wystarcza tu cygwin.&lt;/p&gt;

&lt;p&gt;TakÅ¼e jest to dosyÄ‡ prosta i szybka opcja na postawienie sobie deweloperskiego datapowera na ktÃ³rym moÅ¼na sobie psuÄ‡ do woli. Na dodatek nie mogÄ™ popsuÄ‡ za duÅ¼o - w koÅ„cu gdy coÅ› za bardzo napsujÄ™ to po prostu stawiam obraz od nowa. Z wirtualnymi jest trochÄ™ wiÄ™cej zabawy i z reguÅ‚y wpÅ‚ywa to na innych dewÃ³w, a wrÄ™cz dotyka admina Å›rodowiska dev. Na fizycznych to bojÄ™ siÄ™ myÅ›leÄ‡ - podobno byÅ‚ juÅ¼ przypadek, Å¼e jeden goÅ›Ä‡ tak napsuÅ‚, Å¼e trzeba byÅ‚o wzywaÄ‡ serwis z IBMa. Zatem bezpieczniej mieÄ‡ swoje Å›rodowisko u siebie :)&lt;/p&gt;
</description>
    </item>
    
    
    
    <item>
      <title>Zaczynamy</title>
      <link>https://kamm.github.io/2016/11/zaczynamy/</link>
      <pubDate>Wed, 23 Nov 2016 21:06:00 UTC</pubDate>
      <author>Kamil MÄ™trak</author>
      <guid>https://kamm.github.io/2016/11/zaczynamy/</guid>
      <description>&lt;p&gt;A w zasadzie to ponownie zaczynam. PostanowiÅ‚em ponownie utworzyÄ‡ tego bloga i zaczÄ…Ä‡ wreszcie coÅ› pisaÄ‡. BrakowaÅ‚o mi miejsca gdzie mÃ³gÅ‚bym coÅ› napisaÄ‡, a miaÅ‚em co wiÄ™c tak wyszÅ‚o. BÄ™dÄ™ staraÅ‚ siÄ™ pisaÄ‡ technicznie, ale nie mogÄ™ tego zagwarantowaÄ‡ - czasem moÅ¼e wyjÅ›Ä‡ coÅ› z Å¼ycia innego niÅ¼ tylko kodowanie :)&lt;/p&gt;
</description>
    </item>
    
    
    
    
    
    
  </channel>
</rss>